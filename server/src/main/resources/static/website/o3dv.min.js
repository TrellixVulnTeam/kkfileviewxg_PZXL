var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};
$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(a){var b=function(){};b.prototype=a;return new b};
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};
$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var g=0;g<e.length-1;g++){var f=e[g];if(!(f in d))return;d=d[f]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&($jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(e):
$jscomp.POLYFILL_PREFIX+e),$jscomp.defineProperty(d,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:b})))};
$jscomp.getConstructImplementation=function(){function a(){function c(){}new c;Reflect.construct(c,[],function(){});return new c instanceof c}if($jscomp.TRUST_ES6_POLYFILLS&&"undefined"!=typeof Reflect&&Reflect.construct){if(a())return Reflect.construct;var b=Reflect.construct;return function(c,d,e){c=b(c,d);e&&Reflect.setPrototypeOf(c,e.prototype);return c}}return function(c,d,e){void 0===e&&(e=c);e=$jscomp.objectCreate(e.prototype||Object.prototype);return Function.prototype.apply.call(c,e,d)||
e}};$jscomp.construct={valueOf:$jscomp.getConstructImplementation}.valueOf();$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;
$jscomp.inherits=function(a,b){a.prototype=$jscomp.objectCreate(b.prototype);a.prototype.constructor=a;if($jscomp.setPrototypeOf){var c=$jscomp.setPrototypeOf;c(a,b)}else for(c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.superClass_=b.prototype};$jscomp.generator={};
$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};
$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};
$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};
$jscomp.generator.Context.prototype.yieldAll=function(a,b){a=$jscomp.makeIterator(a);var c=a.next();$jscomp.generator.ensureIteratorResultIsObject_(c);if(c.done)this.yieldResult=c.value,this.nextAddress=b;else return this.yieldAllIterator_=a,this.yield(c.value,b)};$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};
$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();void 0!=b.jumpTo&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(c){return{value:c,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,c){try{var d=a.call(this.context_.yieldAllIterator_,b);$jscomp.generator.ensureIteratorResultIsObject_(d);if(!d.done)return this.context_.stop_(),d;var e=d.value}catch(g){return this.context_.yieldAllIterator_=null,this.context_.throw_(g),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,e);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this.throw=function(b){return a.throw_(b)};this.return=function(b){return a.return_(b)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,b){b=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b));$jscomp.setPrototypeOf&&a.prototype&&$jscomp.setPrototypeOf(b,a.prototype);return b};
$jscomp.asyncExecutePromiseGenerator=function(a){function b(d){return a.next(d)}function c(d){return a.throw(d)}return new Promise(function(d,e){function g(f){f.done?d(f.value):Promise.resolve(f.value).then(b,c).then(g,e)}g(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};
$jscomp.polyfill("Reflect",function(a){return a?a:{}},"es6","es3");$jscomp.polyfill("Reflect.construct",function(a){return $jscomp.construct},"es6","es3");$jscomp.polyfill("Reflect.setPrototypeOf",function(a){if(a)return a;if($jscomp.setPrototypeOf){var b=$jscomp.setPrototypeOf;return function(c,d){try{return b(c,d),!0}catch(e){return!1}}}return null},"es6","es5");$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(a){if(a)return a;var b=function(e,g){this.$jscomp$symbol$id_=e;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:g})};b.prototype.toString=function(){return this.$jscomp$symbol$id_};var c=0,d=function(e){if(this instanceof d)throw new TypeError("Symbol is not a constructor");return new b("jscomp_symbol_"+(e||"")+"_"+c++,e)};return d},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=$jscomp.global[b[c]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&$jscomp.defineProperty(d.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return a},"es6",
"es3");$jscomp.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function c(f){return f instanceof e?f:new e(function(h,k){h(f)})}if(a&&(!($jscomp.FORCE_POLYFILL_PROMISE||$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION&&"undefined"===typeof $jscomp.global.PromiseRejectionEvent)||!$jscomp.global.Promise||-1===$jscomp.global.Promise.toString().indexOf("[native code]")))return a;b.prototype.asyncExecute=function(f){if(null==this.batch_){this.batch_=[];var h=this;this.asyncExecuteFunction(function(){h.executeBatch_()})}this.batch_.push(f)};
var d=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(f){d(f,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var f=this.batch_;this.batch_=[];for(var h=0;h<f.length;++h){var k=f[h];f[h]=null;try{k()}catch(l){this.asyncThrow_(l)}}}this.batch_=null};b.prototype.asyncThrow_=function(f){this.asyncExecuteFunction(function(){throw f;})};var e=function(f){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];this.isRejectionHandled_=!1;var h=this.createResolveAndReject_();
try{f(h.resolve,h.reject)}catch(k){h.reject(k)}};e.prototype.createResolveAndReject_=function(){function f(l){return function(m){k||(k=!0,l.call(h,m))}}var h=this,k=!1;return{resolve:f(this.resolveTo_),reject:f(this.reject_)}};e.prototype.resolveTo_=function(f){if(f===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(f instanceof e)this.settleSameAsPromise_(f);else{a:switch(typeof f){case "object":var h=null!=f;break a;case "function":h=!0;break a;default:h=!1}h?this.resolveToNonPromiseObj_(f):
this.fulfill_(f)}};e.prototype.resolveToNonPromiseObj_=function(f){var h=void 0;try{h=f.then}catch(k){this.reject_(k);return}"function"==typeof h?this.settleSameAsThenable_(h,f):this.fulfill_(f)};e.prototype.reject_=function(f){this.settle_(2,f)};e.prototype.fulfill_=function(f){this.settle_(1,f)};e.prototype.settle_=function(f,h){if(0!=this.state_)throw Error("Cannot settle("+f+", "+h+"): Promise already settled in state"+this.state_);this.state_=f;this.result_=h;2===this.state_&&this.scheduleUnhandledRejectionCheck_();
this.executeOnSettledCallbacks_()};e.prototype.scheduleUnhandledRejectionCheck_=function(){var f=this;d(function(){if(f.notifyUnhandledRejection_()){var h=$jscomp.global.console;"undefined"!==typeof h&&h.error(f.result_)}},1)};e.prototype.notifyUnhandledRejection_=function(){if(this.isRejectionHandled_)return!1;var f=$jscomp.global.CustomEvent,h=$jscomp.global.Event,k=$jscomp.global.dispatchEvent;if("undefined"===typeof k)return!0;"function"===typeof f?f=new f("unhandledrejection",{cancelable:!0}):
"function"===typeof h?f=new h("unhandledrejection",{cancelable:!0}):(f=$jscomp.global.document.createEvent("CustomEvent"),f.initCustomEvent("unhandledrejection",!1,!0,f));f.promise=this;f.reason=this.result_;return k(f)};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var f=0;f<this.onSettledCallbacks_.length;++f)g.asyncExecute(this.onSettledCallbacks_[f]);this.onSettledCallbacks_=null}};var g=new b;e.prototype.settleSameAsPromise_=function(f){var h=this.createResolveAndReject_();
f.callWhenSettled_(h.resolve,h.reject)};e.prototype.settleSameAsThenable_=function(f,h){var k=this.createResolveAndReject_();try{f.call(h,k.resolve,k.reject)}catch(l){k.reject(l)}};e.prototype.then=function(f,h){function k(p,r){return"function"==typeof p?function(t){try{l(p(t))}catch(v){m(v)}}:r}var l,m,n=new e(function(p,r){l=p;m=r});this.callWhenSettled_(k(f,l),k(h,m));return n};e.prototype.catch=function(f){return this.then(void 0,f)};e.prototype.callWhenSettled_=function(f,h){function k(){switch(l.state_){case 1:f(l.result_);
break;case 2:h(l.result_);break;default:throw Error("Unexpected state: "+l.state_);}}var l=this;null==this.onSettledCallbacks_?g.asyncExecute(k):this.onSettledCallbacks_.push(k);this.isRejectionHandled_=!0};e.resolve=c;e.reject=function(f){return new e(function(h,k){k(f)})};e.race=function(f){return new e(function(h,k){for(var l=$jscomp.makeIterator(f),m=l.next();!m.done;m=l.next())c(m.value).callWhenSettled_(h,k)})};e.all=function(f){var h=$jscomp.makeIterator(f),k=h.next();return k.done?c([]):new e(function(l,
m){function n(t){return function(v){p[t]=v;r--;0==r&&l(p)}}var p=[],r=0;do p.push(void 0),r++,c(k.value).callWhenSettled_(n(p.length-1),m),k=h.next();while(!k.done)})};return e},"es6","es3");$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(b,c){var d=$jscomp.checkStringArgs(this,b,"startsWith");b+="";var e=d.length,g=b.length;c=Math.max(0,Math.min(c|0,d.length));for(var f=0;f<g&&c<e;)if(d[c++]!=b[f++])return!1;return f>=g}},"es6","es3");$jscomp.checkEs6ConformanceViaProxy=function(){try{var a={},b=Object.create(new $jscomp.global.Proxy(a,{get:function(c,d,e){return c==a&&"q"==d&&e==b}}));return!0===b.q}catch(c){return!1}};
$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
$jscomp.polyfill("WeakMap",function(a){function b(){if(!a||!Object.seal)return!1;try{var l=Object.seal({}),m=Object.seal({}),n=new a([[l,2],[m,3]]);if(2!=n.get(l)||3!=n.get(m))return!1;n.delete(l);n.set(m,4);return!n.has(l)&&4==n.get(m)}catch(p){return!1}}function c(){}function d(l){var m=typeof l;return"object"===m&&null!==l||"function"===m}function e(l){if(!$jscomp.owns(l,f)){var m=new c;$jscomp.defineProperty(l,f,{value:m})}}function g(l){if(!$jscomp.ISOLATE_POLYFILLS){var m=Object[l];m&&(Object[l]=
function(n){if(n instanceof c)return n;Object.isExtensible(n)&&e(n);return m(n)})}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;var f="$jscomp_hidden_"+Math.random();g("freeze");g("preventExtensions");g("seal");var h=0,k=function(l){this.id_=(h+=Math.random()+1).toString();if(l){l=$jscomp.makeIterator(l);for(var m;!(m=l.next()).done;)m=m.value,this.set(m[0],m[1])}};k.prototype.set=function(l,m){if(!d(l))throw Error("Invalid WeakMap key");
e(l);if(!$jscomp.owns(l,f))throw Error("WeakMap key fail: "+l);l[f][this.id_]=m;return this};k.prototype.get=function(l){return d(l)&&$jscomp.owns(l,f)?l[f][this.id_]:void 0};k.prototype.has=function(l){return d(l)&&$jscomp.owns(l,f)&&$jscomp.owns(l[f],this.id_)};k.prototype.delete=function(l){return d(l)&&$jscomp.owns(l,f)&&$jscomp.owns(l[f],this.id_)?delete l[f][this.id_]:!1};return k},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(a){function b(){if($jscomp.ASSUME_NO_NATIVE_MAP||!a||"function"!=typeof a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var k=Object.seal({x:4}),l=new a($jscomp.makeIterator([[k,"s"]]));if("s"!=l.get(k)||1!=l.size||l.get({x:4})||l.set({x:4},"t")!=l||2!=l.size)return!1;var m=l.entries(),n=m.next();if(n.done||n.value[0]!=k||"s"!=n.value[1])return!1;n=m.next();return n.done||4!=n.value[0].x||"t"!=n.value[1]||!m.next().done?!1:!0}catch(p){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(b())return a;var c=new WeakMap,d=function(k){this.data_={};this.head_=f();this.size=0;if(k){k=$jscomp.makeIterator(k);for(var l;!(l=k.next()).done;)l=l.value,this.set(l[0],l[1])}};d.prototype.set=function(k,l){k=0===k?0:k;var m=e(this,k);m.list||(m.list=this.data_[m.id]=[]);m.entry?m.entry.value=l:(m.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:k,value:l},m.list.push(m.entry),
this.head_.previous.next=m.entry,this.head_.previous=m.entry,this.size++);return this};d.prototype.delete=function(k){k=e(this,k);return k.entry&&k.list?(k.list.splice(k.index,1),k.list.length||delete this.data_[k.id],k.entry.previous.next=k.entry.next,k.entry.next.previous=k.entry.previous,k.entry.head=null,this.size--,!0):!1};d.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=f();this.size=0};d.prototype.has=function(k){return!!e(this,k).entry};d.prototype.get=function(k){return(k=
e(this,k).entry)&&k.value};d.prototype.entries=function(){return g(this,function(k){return[k.key,k.value]})};d.prototype.keys=function(){return g(this,function(k){return k.key})};d.prototype.values=function(){return g(this,function(k){return k.value})};d.prototype.forEach=function(k,l){for(var m=this.entries(),n;!(n=m.next()).done;)n=n.value,k.call(l,n[1],n[0],this)};d.prototype[Symbol.iterator]=d.prototype.entries;var e=function(k,l){var m=l&&typeof l;"object"==m||"function"==m?c.has(l)?m=c.get(l):
(m=""+ ++h,c.set(l,m)):m="p_"+l;var n=k.data_[m];if(n&&$jscomp.owns(k.data_,m))for(k=0;k<n.length;k++){var p=n[k];if(l!==l&&p.key!==p.key||l===p.key)return{id:m,list:n,index:k,entry:p}}return{id:m,list:n,index:-1,entry:void 0}},g=function(k,l){var m=k.head_;return $jscomp.iteratorPrototype(function(){if(m){for(;m.head!=k.head_;)m=m.previous;for(;m.next!=m.head;)return m=m.next,{done:!1,value:l(m)};m=null}return{done:!0,value:void 0}})},f=function(){var k={};return k.previous=k.next=k.head=k},h=0;
return d},"es6","es3");$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(b,c){var d=$jscomp.checkStringArgs(this,b,"endsWith");b+="";void 0===c&&(c=d.length);c=Math.max(0,Math.min(c|0,d.length));for(var e=b.length;0<e&&0<c;)if(d[--c]!=b[--e])return!1;return 0>=e}},"es6","es3");
$jscomp.iteratorFromArray=function(a,b){a instanceof String&&(a+="");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var g=c++;return{value:b(g,a[g]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e};$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(b,c){return c})}},"es8","es3");
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(b){var c=$jscomp.checkStringArgs(this,null,"repeat");if(0>b||1342177279<b)throw new RangeError("Invalid count value");b|=0;for(var d="";b;)if(b&1&&(d+=c),b>>>=1)c+=c;return d}},"es6","es3");
$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(b,c,d){var e=this.length||0;0>c&&(c=Math.max(0,e+c));if(null==d||d>e)d=e;d=Number(d);0>d&&(d=Math.max(0,e+d));for(c=Number(c||0);c<d;c++)this[c]=b;return this}},"es6","es3");$jscomp.typedArrayFill=function(a){return a?a:Array.prototype.fill};$jscomp.polyfill("Int8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint8Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");
$jscomp.polyfill("Uint8ClampedArray.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Int16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint16Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Int32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Uint32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Float32Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");
$jscomp.polyfill("Float64Array.prototype.fill",$jscomp.typedArrayFill,"es6","es5");$jscomp.polyfill("Promise.prototype.finally",function(a){return a?a:function(b){return this.then(function(c){return Promise.resolve(b()).then(function(){return c})},function(c){return Promise.resolve(b()).then(function(){throw c;})})}},"es9","es3");$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var g=a[e];if(b.call(c,g,e,a))return{i:e,v:g}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.findIndex",function(a){return a?a:function(b,c){return $jscomp.findInternal(this,b,c).i}},"es6","es3");OV={IsDefined:function(a){return void 0!==a&&null!==a},ValueOrDefault:function(a,b){return void 0===a||null===a?b:a}};OV.TaskRunner=function(){this.callbacks=this.current=this.count=null};OV.TaskRunner.prototype.Run=function(a,b){this.count=a;this.current=0;this.callbacks=b;0===a?this.TaskReady():this.RunOnce()};OV.TaskRunner.prototype.RunBatch=function(a,b,c){var d=0;0<a&&(d=parseInt((a-1)/b,10)+1);this.Run(d,{runTask:function(e,g){c.runTask(e*b,Math.min((e+1)*b,a)-1,g)},onReady:c.onReady})};
OV.TaskRunner.prototype.RunOnce=function(){var a=this;setTimeout(function(){a.callbacks.runTask(a.current,a.TaskReady.bind(a))},0)};OV.TaskRunner.prototype.TaskReady=function(){this.current+=1;if(this.current<this.count)this.RunOnce();else if(this.callbacks.onReady)this.callbacks.onReady()};OV.RunTaskAsync=function(a){setTimeout(function(){a()},0)};OV.RunTasks=function(a,b){(new OV.TaskRunner).Run(a,b)};OV.RunTasksBatch=function(a,b,c){(new OV.TaskRunner).RunBatch(a,b,c)};OV.Eps=1E-8;OV.RadDeg=57.29577951308232;OV.DegRad=.017453292519943;OV.IsZero=function(a){return Math.abs(a)<OV.Eps};OV.IsLower=function(a,b){return b-a>OV.Eps};OV.IsGreater=function(a,b){return a-b>OV.Eps};OV.IsLowerOrEqual=function(a,b){return b-a>-OV.Eps};OV.IsGreaterOrEqual=function(a,b){return a-b>-OV.Eps};OV.IsEqual=function(a,b){return Math.abs(b-a)<OV.Eps};OV.IsEqualEps=function(a,b,c){return Math.abs(b-a)<c};OV.IsPositive=function(a){return a>OV.Eps};OV.IsNegative=function(a){return a<-OV.Eps};
OV.Direction={X:1,Y:2,Z:3};OV.Coord2D=function(a,b){this.x=a;this.y=b};OV.Coord2D.prototype.Clone=function(){return new OV.Coord2D(this.x,this.y)};OV.CoordIsEqual2D=function(a,b){return OV.IsEqual(a.x,b.x)&&OV.IsEqual(a.y,b.y)};OV.AddCoord2D=function(a,b){return new OV.Coord2D(a.x+b.x,a.y+b.y)};OV.SubCoord2D=function(a,b){return new OV.Coord2D(a.x-b.x,a.y-b.y)};OV.CoordDistance2D=function(a,b){return Math.sqrt((a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y))};OV.Coord3D=function(a,b,c){this.x=a;this.y=b;this.z=c};OV.Coord3D.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};OV.Coord3D.prototype.MultiplyScalar=function(a){this.x*=a;this.y*=a;this.z*=a;return this};OV.Coord3D.prototype.Normalize=function(){var a=this.Length();0<a&&this.MultiplyScalar(1/a);return this};OV.Coord3D.prototype.Offset=function(a,b){a=a.Clone().Normalize();this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;return this};
OV.Coord3D.prototype.Rotate=function(a,b,c){var d=a.Clone().Normalize();a=d.x;var e=d.y;d=d.z;var g=this.x-c.x,f=this.y-c.y,h=this.z-c.z,k=Math.sin(b);b=Math.cos(b);this.x=-a*(-a*g-e*f-d*h)*(1-b)+g*b+(-d*f+e*h)*k;this.y=-e*(-a*g-e*f-d*h)*(1-b)+f*b+(d*g-a*h)*k;this.z=-d*(-a*g-e*f-d*h)*(1-b)+h*b+(-e*g+a*f)*k;this.x+=c.x;this.y+=c.y;this.z+=c.z;return this};OV.Coord3D.prototype.Clone=function(){return new OV.Coord3D(this.x,this.y,this.z)};
OV.CoordIsEqual3D=function(a,b){return OV.IsEqual(a.x,b.x)&&OV.IsEqual(a.y,b.y)&&OV.IsEqual(a.z,b.z)};OV.AddCoord3D=function(a,b){return new OV.Coord3D(a.x+b.x,a.y+b.y,a.z+b.z)};OV.SubCoord3D=function(a,b){return new OV.Coord3D(a.x-b.x,a.y-b.y,a.z-b.z)};OV.CoordDistance3D=function(a,b){return Math.sqrt((a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y)+(a.z-b.z)*(a.z-b.z))};
OV.VectorAngle3D=function(a,b){a=a.Clone().Normalize();b=b.Clone().Normalize();if(OV.CoordIsEqual3D(a,b))return 0;b=OV.DotVector3D(a,b);return Math.acos(b)};OV.DotVector3D=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z};OV.CrossVector3D=function(a,b){var c=new OV.Coord3D(0,0,0);c.x=a.y*b.z-a.z*b.y;c.y=a.z*b.x-a.x*b.z;c.z=a.x*b.y-a.y*b.x;return c};OV.VectorLength3D=function(a,b,c){return Math.sqrt(a*a+b*b+c*c)};OV.ArrayToCoord3D=function(a){return new OV.Coord3D(a[0],a[1],a[2])};OV.Quaternion=function(a,b,c,d){this.x=a;this.y=b;this.z=c;this.w=d};OV.ArrayToQuaternion=function(a){return new OV.Quaternion(a[0],a[1],a[2],a[3])};OV.QuaternionFromAxisAngle=function(a,b){b/=2;var c=Math.sin(b);return new OV.Quaternion(a.x*c,a.y*c,a.z*c,Math.cos(b))};OV.Box3D=function(a,b){this.min=a;this.max=b};OV.Box3D.prototype.GetMin=function(){return this.min};OV.Box3D.prototype.GetMax=function(){return this.max};OV.Box3D.prototype.GetCenter=function(){return new OV.Coord3D((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,(this.min.z+this.max.z)/2)};OV.BoundingBoxCalculator3D=function(){this.box=new OV.Box3D(new OV.Coord3D(Infinity,Infinity,Infinity),new OV.Coord3D(-Infinity,-Infinity,-Infinity))};OV.BoundingBoxCalculator3D.prototype.GetBox=function(){return this.box};
OV.BoundingBoxCalculator3D.prototype.AddPoint=function(a){this.box.min.x=Math.min(this.box.min.x,a.x);this.box.min.y=Math.min(this.box.min.y,a.y);this.box.min.z=Math.min(this.box.min.z,a.z);this.box.max.x=Math.max(this.box.max.x,a.x);this.box.max.y=Math.max(this.box.max.y,a.y);this.box.max.z=Math.max(this.box.max.z,a.z)};OV.OctreeNode=function(a,b){this.boundingBox=a;this.level=b;this.pointItems=[];this.childNodes=[]};OV.OctreeNode.prototype.AddPoint=function(a,b,c){var d=this.FindNodeForPoint(a);if(null===d||null!==d.FindPointDirectly(a))return!1;if(d.pointItems.length<c.maxPointsPerNode||d.level>=c.maxTreeDepth)return d.AddPointDirectly(a,b),!0;d.CreateChildNodes();var e=d.pointItems;d.pointItems=[];for(var g=0;g<e.length;g++){var f=e[g];if(!d.AddPoint(f.point,f.data,c))return!1}return d.AddPoint(a,b,c)};
OV.OctreeNode.prototype.FindPoint=function(a){var b=this.FindNodeForPoint(a);return null===b?null:b.FindPointDirectly(a)};OV.OctreeNode.prototype.AddPointDirectly=function(a,b){this.pointItems.push({point:a,data:b})};OV.OctreeNode.prototype.FindPointDirectly=function(a){for(var b=0;b<this.pointItems.length;b++){var c=this.pointItems[b];if(OV.CoordIsEqual3D(a,c.point))return c.data}return null};
OV.OctreeNode.prototype.FindNodeForPoint=function(a){if(!this.IsPointInBounds(a))return null;if(0===this.childNodes.length)return this;for(var b=0;b<this.childNodes.length;b++){var c=this.childNodes[b].FindNodeForPoint(a);if(null!==c)return c}return null};
OV.OctreeNode.prototype.CreateChildNodes=function(){function a(f,h,k,l,m,n,p){h=new OV.Box3D(new OV.Coord3D(h,k,l),new OV.Coord3D(h+m,k+n,l+p));f.childNodes.push(new OV.OctreeNode(h,f.level+1,f.options))}var b=this.boundingBox.min,c=this.boundingBox.GetCenter(),d=(this.boundingBox.max.x-this.boundingBox.min.x)/2,e=(this.boundingBox.max.y-this.boundingBox.min.y)/2,g=(this.boundingBox.max.z-this.boundingBox.min.z)/2;a(this,b.x,b.y,b.z,d,e,g);a(this,c.x,b.y,b.z,d,e,g);a(this,b.x,c.y,b.z,d,e,g);a(this,
c.x,c.y,b.z,d,e,g);a(this,b.x,b.y,c.z,d,e,g);a(this,c.x,b.y,c.z,d,e,g);a(this,b.x,c.y,c.z,d,e,g);a(this,c.x,c.y,c.z,d,e,g)};OV.OctreeNode.prototype.IsPointInBounds=function(a){return OV.IsGreaterOrEqual(a.x,this.boundingBox.min.x)&&OV.IsGreaterOrEqual(a.y,this.boundingBox.min.y)&&OV.IsGreaterOrEqual(a.z,this.boundingBox.min.z)&&OV.IsLowerOrEqual(a.x,this.boundingBox.max.x)&&OV.IsLowerOrEqual(a.y,this.boundingBox.max.y)&&OV.IsLowerOrEqual(a.z,this.boundingBox.max.z)};
OV.Octree=function(a,b){this.options={maxPointsPerNode:10,maxTreeDepth:10};void 0!==b&&(void 0!==b.maxPointsPerNode&&(this.options.maxPointsPerNode=b.maxPointsPerNode),void 0!==b.maxTreeDepth&&(this.options.maxTreeDepth=b.maxTreeDepth));this.rootNode=new OV.OctreeNode(a,0,this.options)};OV.Octree.prototype.AddPoint=function(a,b){return this.rootNode.AddPoint(a,b,this.options)};OV.Octree.prototype.FindPoint=function(a){return this.rootNode.FindPoint(a)};OV.Matrix=function(a){this.matrix=null;void 0!==a&&null!==a&&(this.matrix=a)};OV.Matrix.prototype.IsValid=function(){return null!==this.matrix};OV.Matrix.prototype.Set=function(a){this.matrix=a;return this};OV.Matrix.prototype.Get=function(){return this.matrix};
OV.Matrix.prototype.Clone=function(){return new OV.Matrix([this.matrix[0],this.matrix[1],this.matrix[2],this.matrix[3],this.matrix[4],this.matrix[5],this.matrix[6],this.matrix[7],this.matrix[8],this.matrix[9],this.matrix[10],this.matrix[11],this.matrix[12],this.matrix[13],this.matrix[14],this.matrix[15]])};OV.Matrix.prototype.CreateIdentity=function(){this.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return this};
OV.Matrix.prototype.IsIdentity=function(){for(var a=(new OV.Matrix).CreateIdentity().Get(),b=0;16>b;b++)if(!OV.IsEqual(this.matrix[b],a[b]))return!1;return!0};OV.Matrix.prototype.CreateTranslation=function(a,b,c){this.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,a,b,c,1];return this};OV.Matrix.prototype.CreateRotation=function(a,b,c,d){var e=a+a,g=b+b,f=c+c,h=a*e,k=a*g;a*=f;var l=b*g;b*=f;c*=f;e*=d;g*=d;d*=f;this.matrix=[1-(l+c),k+d,a-g,0,k-d,1-(h+c),b+e,0,a+g,b-e,1-(h+l),0,0,0,0,1];return this};
OV.Matrix.prototype.CreateScale=function(a,b,c){this.matrix=[a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1];return this};OV.Matrix.prototype.ComposeTRS=function(a,b,c){var d=b.x,e=b.y,g=b.z,f=b.w;b=c.x;var h=c.y;c=c.z;var k=d+d,l=e+e,m=g+g,n=d*k,p=d*l;d*=m;var r=e*l;e*=m;g*=m;k*=f;l*=f;f*=m;this.matrix=[(1-(r+g))*b,(p+f)*b,(d-l)*b,0,(p-f)*h,(1-(n+g))*h,(e+k)*h,0,(d+l)*c,(e-k)*c,(1-(n+r))*c,0,a.x,a.y,a.z,1];return this};
OV.Matrix.prototype.DecomposeTRS=function(){var a=new OV.Coord3D(this.matrix[12],this.matrix[13],this.matrix[14]),b=OV.VectorLength3D(this.matrix[0],this.matrix[1],this.matrix[2]),c=OV.VectorLength3D(this.matrix[4],this.matrix[5],this.matrix[6]),d=OV.VectorLength3D(this.matrix[8],this.matrix[9],this.matrix[10]),e=this.Determinant();OV.IsNegative(e)&&(b*=-1);e=new OV.Coord3D(b,c,d);var g=this.matrix[0]/b,f=this.matrix[4]/c,h=this.matrix[8]/d,k=this.matrix[1]/b,l=this.matrix[5]/c,m=this.matrix[9]/d;
b=this.matrix[2]/b;c=this.matrix[6]/c;d=this.matrix[10]/d;var n=g+l+d;0<n?(g=2*Math.sqrt(n+1),f=new OV.Quaternion((c-m)/g,(h-b)/g,(k-f)/g,.25*g)):g>l&&g>d?(g=2*Math.sqrt(1+g-l-d),f=new OV.Quaternion(.25*g,(f+k)/g,(h+b)/g,(c-m)/g)):l>d?(g=2*Math.sqrt(1+l-g-d),f=new OV.Quaternion((f+k)/g,.25*g,(m+c)/g,(h-b)/g)):(g=2*Math.sqrt(1+d-g-l),f=new OV.Quaternion((h+b)/g,(m+c)/g,.25*g,(k-f)/g));return{translation:a,rotation:f,scale:e}};
OV.Matrix.prototype.Determinant=function(){var a=this.matrix[0],b=this.matrix[1],c=this.matrix[2],d=this.matrix[3],e=this.matrix[4],g=this.matrix[5],f=this.matrix[6],h=this.matrix[7],k=this.matrix[8],l=this.matrix[9],m=this.matrix[10],n=this.matrix[11],p=this.matrix[12],r=this.matrix[13],t=this.matrix[14],v=this.matrix[15];return(a*g-b*e)*(m*v-n*t)-(a*f-c*e)*(l*v-n*r)+(a*h-d*e)*(l*t-m*r)+(b*f-c*g)*(k*v-n*p)-(b*h-d*g)*(k*t-m*p)+(c*h-d*f)*(k*r-l*p)};
OV.Matrix.prototype.Invert=function(){var a=this.matrix[0],b=this.matrix[1],c=this.matrix[2],d=this.matrix[3],e=this.matrix[4],g=this.matrix[5],f=this.matrix[6],h=this.matrix[7],k=this.matrix[8],l=this.matrix[9],m=this.matrix[10],n=this.matrix[11],p=this.matrix[12],r=this.matrix[13],t=this.matrix[14],v=this.matrix[15],u=a*g-b*e,q=a*f-c*e,w=a*h-d*e,x=b*f-c*g,C=b*h-d*g,y=c*h-d*f,z=k*r-l*p,B=k*t-m*p,A=k*v-n*p,E=l*t-m*r,F=l*v-n*r,G=m*v-n*t,D=u*G-q*F+w*E+x*A-C*B+y*z;return OV.IsEqual(D,0)?null:new OV.Matrix([(g*
G-f*F+h*E)/D,(c*F-b*G-d*E)/D,(r*y-t*C+v*x)/D,(m*C-l*y-n*x)/D,(f*A-e*G-h*B)/D,(a*G-c*A+d*B)/D,(t*w-p*y-v*q)/D,(k*y-m*w+n*q)/D,(e*F-g*A+h*z)/D,(b*A-a*F-d*z)/D,(p*C-r*w+v*u)/D,(l*w-k*C-n*u)/D,(g*B-e*E-f*z)/D,(a*E-b*B+c*z)/D,(r*q-p*x-t*u)/D,(k*x-l*q+m*u)/D])};
OV.Matrix.prototype.MultiplyVector=function(a){var b=a[0],c=a[1],d=a[2];a=a[3];return[b*this.matrix[0]+c*this.matrix[4]+d*this.matrix[8]+a*this.matrix[12],b*this.matrix[1]+c*this.matrix[5]+d*this.matrix[9]+a*this.matrix[13],b*this.matrix[2]+c*this.matrix[6]+d*this.matrix[10]+a*this.matrix[14],b*this.matrix[3]+c*this.matrix[7]+d*this.matrix[11]+a*this.matrix[15]]};
OV.Matrix.prototype.MultiplyMatrix=function(a){var b=this.matrix[0],c=this.matrix[1],d=this.matrix[2],e=this.matrix[3],g=this.matrix[4],f=this.matrix[5],h=this.matrix[6],k=this.matrix[7],l=this.matrix[8],m=this.matrix[9],n=this.matrix[10],p=this.matrix[11],r=this.matrix[12],t=this.matrix[13],v=this.matrix[14],u=this.matrix[15],q=a.matrix[0],w=a.matrix[1],x=a.matrix[2],C=a.matrix[3],y=a.matrix[4],z=a.matrix[5],B=a.matrix[6],A=a.matrix[7],E=a.matrix[8],F=a.matrix[9],G=a.matrix[10],D=a.matrix[11],I=
a.matrix[12],H=a.matrix[13],J=a.matrix[14];a=a.matrix[15];return new OV.Matrix([b*q+c*y+d*E+e*I,b*w+c*z+d*F+e*H,b*x+c*B+d*G+e*J,b*C+c*A+d*D+e*a,g*q+f*y+h*E+k*I,g*w+f*z+h*F+k*H,g*x+f*B+h*G+k*J,g*C+f*A+h*D+k*a,l*q+m*y+n*E+p*I,l*w+m*z+n*F+p*H,l*x+m*B+n*G+p*J,l*C+m*A+n*D+p*a,r*q+t*y+v*E+u*I,r*w+t*z+v*F+u*H,r*x+t*B+v*G+u*J,r*C+t*A+v*D+u*a])};OV.MatrixIsEqual=function(a,b){a=a.Get();b=b.Get();for(var c=0;16>c;c++)if(!OV.IsEqual(a[c],b[c]))return!1;return!0};OV.Transformation=function(a){void 0!==a&&null!==a?this.matrix=a:(this.matrix=new OV.Matrix,this.matrix.CreateIdentity())};OV.Transformation.prototype.SetMatrix=function(a){this.matrix=a;return this};OV.Transformation.prototype.GetMatrix=function(){return this.matrix};OV.Transformation.prototype.IsIdentity=function(){return this.matrix.IsIdentity()};OV.Transformation.prototype.AppendMatrix=function(a){this.matrix=this.matrix.MultiplyMatrix(a);return this};
OV.Transformation.prototype.Append=function(a){this.AppendMatrix(a.GetMatrix());return this};OV.Transformation.prototype.TransformCoord3D=function(a){a=this.matrix.MultiplyVector([a.x,a.y,a.z,1]);return new OV.Coord3D(a[0],a[1],a[2])};OV.Transformation.prototype.Clone=function(){var a=this.matrix.Clone();return new OV.Transformation(a)};OV.TransformationIsEqual=function(a,b){return OV.MatrixIsEqual(a.GetMatrix(),b.GetMatrix())};OV.BezierTweenFunction=function(a,b,c){b/=c;return a*b*b*(3-2*b)};OV.LinearTweenFunction=function(a,b,c){return b*a/c};OV.ParabolicTweenFunction=function(a,b,c){b/=c;c=b*b;return c/(2*(c-b)+1)*a};OV.TweenCoord3D=function(a,b,c,d){var e=OV.SubCoord3D(b,a).Normalize();b=OV.CoordDistance3D(a,b);for(var g=[],f=0;f<c;f++){var h=d(b,f,c-1);g.push(a.Clone().Offset(e,h))}return g};OV.BinaryReader=function(a,b){this.arrayBuffer=a;this.dataView=new DataView(a);this.isLittleEndian=b;this.position=0};OV.BinaryReader.prototype.GetPosition=function(){return this.position};OV.BinaryReader.prototype.SetPosition=function(a){this.position=a};OV.BinaryReader.prototype.GetByteLength=function(){return this.arrayBuffer.byteLength};OV.BinaryReader.prototype.Skip=function(a){this.position+=a};OV.BinaryReader.prototype.End=function(){return this.position>=this.arrayBuffer.byteLength};
OV.BinaryReader.prototype.ReadArrayBuffer=function(a){var b=new Uint8Array(this.arrayBuffer),c=new ArrayBuffer(a),d=new Uint8Array(c);b=b.subarray(this.position,this.position+a);d.set(b,0);this.position+=a;return c};OV.BinaryReader.prototype.ReadBoolean8=function(){var a=this.dataView.getInt8(this.position);this.position+=1;return a?!0:!1};OV.BinaryReader.prototype.ReadCharacter8=function(){var a=this.dataView.getInt8(this.position);this.position+=1;return a};
OV.BinaryReader.prototype.ReadUnsignedCharacter8=function(){var a=this.dataView.getUint8(this.position);this.position+=1;return a};OV.BinaryReader.prototype.ReadInteger16=function(){var a=this.dataView.getInt16(this.position,this.isLittleEndian);this.position+=2;return a};OV.BinaryReader.prototype.ReadUnsignedInteger16=function(){var a=this.dataView.getUint16(this.position,this.isLittleEndian);this.position+=2;return a};
OV.BinaryReader.prototype.ReadInteger32=function(){var a=this.dataView.getInt32(this.position,this.isLittleEndian);this.position+=4;return a};OV.BinaryReader.prototype.ReadUnsignedInteger32=function(){var a=this.dataView.getUint32(this.position,this.isLittleEndian);this.position+=4;return a};OV.BinaryReader.prototype.ReadFloat32=function(){var a=this.dataView.getFloat32(this.position,this.isLittleEndian);this.position+=4;return a};
OV.BinaryReader.prototype.ReadDouble64=function(){var a=this.dataView.getFloat64(this.position,this.isLittleEndian);this.position+=8;return a};OV.BinaryWriter=function(a,b){this.arrayBuffer=new ArrayBuffer(a);this.dataView=new DataView(this.arrayBuffer);this.isLittleEndian=b;this.position=0};OV.BinaryWriter.prototype.GetPosition=function(){return this.position};OV.BinaryWriter.prototype.SetPosition=function(a){this.position=a};OV.BinaryWriter.prototype.End=function(){return this.position>=this.arrayBuffer.byteLength};OV.BinaryWriter.prototype.GetBuffer=function(){return this.arrayBuffer};
OV.BinaryWriter.prototype.WriteArrayBuffer=function(a){var b=new Uint8Array(a);(new Uint8Array(this.arrayBuffer)).set(b,this.position);this.position+=a.byteLength};OV.BinaryWriter.prototype.WriteBoolean8=function(a){this.dataView.setInt8(this.position,a?1:0);this.position+=1};OV.BinaryWriter.prototype.WriteCharacter8=function(a){this.dataView.setInt8(this.position,a);this.position+=1};
OV.BinaryWriter.prototype.WriteUnsignedCharacter8=function(a){this.dataView.setUint8(this.position,a);this.position+=1};OV.BinaryWriter.prototype.WriteInteger16=function(a){this.dataView.setInt16(this.position,a,this.isLittleEndian);this.position+=2};OV.BinaryWriter.prototype.WriteUnsignedInteger16=function(a){this.dataView.setUint16(this.position,a,this.isLittleEndian);this.position+=2};
OV.BinaryWriter.prototype.WriteInteger32=function(a){this.dataView.setInt32(this.position,a,this.isLittleEndian);this.position+=4};OV.BinaryWriter.prototype.WriteUnsignedInteger32=function(a){this.dataView.setUint32(this.position,a,this.isLittleEndian);this.position+=4};OV.BinaryWriter.prototype.WriteFloat32=function(a){this.dataView.setFloat32(this.position,a,this.isLittleEndian);this.position+=4};
OV.BinaryWriter.prototype.WriteDouble64=function(a){this.dataView.setFloat64(this.position,a,this.isLittleEndian);this.position+=8};OV.TextWriter=function(){this.text="";this.indentation=0};OV.TextWriter.prototype.GetText=function(){return this.text};OV.TextWriter.prototype.Indent=function(a){this.indentation+=a};OV.TextWriter.prototype.WriteArrayLine=function(a){this.WriteLine(a.join(" "))};OV.TextWriter.prototype.WriteLine=function(a){this.WriteIndentation();this.Write(a+"\n")};OV.TextWriter.prototype.WriteIndentation=function(){for(var a=0;a<this.indentation;a++)this.Write("  ")};
OV.TextWriter.prototype.Write=function(a){this.text+=a};OV.ArrayBufferToUtf8String=function(a){return(new TextDecoder("utf-8")).decode(a)};OV.ArrayBufferToAsciiString=function(a){var b="";a=new Uint8Array(a);for(var c=0;c<a.byteLength;c++)b+=String.fromCharCode(a[c]);return b};OV.AsciiStringToArrayBuffer=function(a){for(var b=new ArrayBuffer(a.length),c=new Uint8Array(b),d=0;d<a.length;d++)c[d]=a.charCodeAt(d);return b};OV.Utf8StringToArrayBuffer=function(a){return(new TextEncoder).encode(a).buffer};
OV.Base64DataURIToArrayBuffer=function(a){if(!a.startsWith("data:"))return null;var b=a.indexOf(";");if(-1===b)return null;var c=a.indexOf(",");if(-1===c)return null;b=a.substr(5,b-5);a=atob(a.substr(c+1));c=new ArrayBuffer(a.length);for(var d=new Uint8Array(c),e=0;e<a.length;e++)d[e]=a.charCodeAt(e);return{mimeType:b,buffer:c}};OV.GetFileExtensionFromMimeType=function(a){if(void 0===a||null===a)return"";a=a.split("/");return 0===a.length?"":a[a.length-1]};
OV.CreateObjectUrl=function(a){a=new Blob([a]);return URL.createObjectURL(a)};OV.CreateObjectUrlWithMimeType=function(a,b){a=new Blob([a],{type:b});return URL.createObjectURL(a)};OV.RevokeObjectUrl=function(a){URL.revokeObjectURL(a)};OV.FileSource={Url:1,File:2,Decompressed:3};OV.FileFormat={Text:1,Binary:2};OV.GetFileName=function(a){var b=a.lastIndexOf("/");-1===b&&(b=a.lastIndexOf("\\"));var c=a;-1!==b&&(c=a.substr(b+1));a=c.indexOf("?");-1!==a&&(c=c.substr(0,a));return decodeURI(c)};OV.GetFileExtension=function(a){a=OV.GetFileName(a);var b=a.lastIndexOf(".");return-1===b?"":a.substr(b+1).toLowerCase()};
OV.RequestUrl=function(a,b){return new Promise(function(c,d){var e=new XMLHttpRequest;e.open("GET",a,!0);if(b===OV.FileFormat.Text)e.responseType="text";else if(b===OV.FileFormat.Binary)e.responseType="arraybuffer";else{d();return}e.onload=function(){200===e.status?c(e.response):d()};e.onerror=function(){d()};e.send(null)})};
OV.ReadFile=function(a,b){return new Promise(function(c,d){var e=new FileReader;e.onloadend=function(g){g.target.readyState===FileReader.DONE&&c(g.target.result)};e.onerror=function(){d()};b===OV.FileFormat.Text?e.readAsText(a):b===OV.FileFormat.Binary?e.readAsArrayBuffer(a):d()})};OV.ExternalLibLocation=null;OV.LoadedExternalLibs={};OV.LoadExternalLibrary=function(a){return new Promise(function(b,c){if(null===OV.ExternalLibLocation)c();else if(void 0!==OV.LoadedExternalLibs[a])b();else{var d=document.createElement("script");d.type="text/javascript";d.src=OV.ExternalLibLocation+"/"+a;d.onload=function(){OV.LoadedExternalLibs[a]=!0;b()};d.onerror=function(){c()};document.head.appendChild(d)}})};OV.Color=function(a,b,c){this.r=a;this.g=b;this.b=c};OV.Color.prototype.Set=function(a,b,c){this.r=a;this.g=b;this.b=c};OV.Color.prototype.Clone=function(){return new OV.Color(this.r,this.g,this.b)};OV.TextureMap=function(){this.buffer=this.url=this.name=null;this.offset=new OV.Coord2D(0,0);this.scale=new OV.Coord2D(1,1);this.rotation=0};OV.TextureMap.prototype.IsValid=function(){return null!==this.name&&null!==this.url&&null!==this.buffer};
OV.TextureMap.prototype.HasTransformation=function(){return OV.CoordIsEqual2D(this.offset,new OV.Coord2D(0,0))&&OV.CoordIsEqual2D(this.scale,new OV.Coord2D(1,1))&&OV.IsEqual(this.rotation,0)?!1:!0};OV.TextureMap.prototype.Clone=function(){var a=new OV.TextureMap;a.name=this.name;a.url=this.url;a.buffer=this.buffer;a.offset=this.offset.Clone();a.scale=this.scale.Clone();a.rotation=this.rotation;return a};OV.MaterialType={Phong:1,Physical:2};
OV.Material=function(a){this.type=a;this.name="";this.color=new OV.Color(0,0,0);this.ambient=new OV.Color(0,0,0);this.specular=new OV.Color(0,0,0);this.emissive=new OV.Color(0,0,0);this.metalness=0;this.roughness=1;this.shininess=0;this.opacity=1;this.metalnessMap=this.emissiveMap=this.normalMap=this.bumpMap=this.specularMap=this.diffuseMap=null;this.alphaTest=0;this.isDefault=this.multiplyMetallicMap=this.multiplyDiffuseMap=this.transparent=!1};
OV.Material.prototype.Clone=function(){var a=new OV.Material(this.type);a.name=this.name;a.color=this.color.Clone();a.ambient=this.ambient.Clone();a.specular=this.specular.Clone();a.emissive=this.emissive.Clone();a.metalness=this.metalness;a.roughness=this.roughness;a.shininess=this.shininess;a.opacity=this.opacity;a.diffuseMap=this.CloneTextureMap(this.diffuseMap);a.specularMap=this.CloneTextureMap(this.specularMap);a.bumpMap=this.CloneTextureMap(this.bumpMap);a.normalMap=this.CloneTextureMap(this.normalMap);
a.emissiveMap=this.CloneTextureMap(this.emissiveMap);a.metalnessMap=this.CloneTextureMap(this.metalnessMap);a.alphaTest=this.alphaTest;a.transparent=this.transparent;a.multiplyDiffuseMap=this.multiplyDiffuseMap;return a};OV.Material.prototype.CloneTextureMap=function(a){return null===a?null:a.Clone()};OV.SRGBToLinear=function(a){return.04045>a?.0773993808*a:Math.pow(.9478672986*a+.0521327014,2.4)};OV.LinearToSRGB=function(a){return.0031308>a?12.92*a:1.055*Math.pow(a,.41666)-.055};
OV.IntegerToHexString=function(a){for(a=parseInt(a,10).toString(16);2>a.length;)a="0"+a;return a};OV.ColorToHexString=function(a){var b=OV.IntegerToHexString(a.r),c=OV.IntegerToHexString(a.g);a=OV.IntegerToHexString(a.b);return b+c+a};OV.HexStringToColor=function(a){if(6!==a.length)return null;var b=parseInt(a.substr(0,2),16),c=parseInt(a.substr(2,2),16);a=parseInt(a.substr(4,2),16);return new OV.Color(b,c,a)};OV.ArrayToColor=function(a){return new OV.Color(a[0],a[1],a[2])};
OV.ColorIsEqual=function(a,b){return a.r===b.r&&a.g===b.g&&a.b===b.b};OV.TextureIsEqual=function(a,b){return a.name===b.name&&a.name===b.name&&a.url===b.url&&OV.CoordIsEqual2D(a.offset,b.offset)&&OV.CoordIsEqual2D(a.scale,b.scale)&&OV.IsEqual(a.rotation,b.rotation)?!0:!1};
OV.MaterialIsEqual=function(a,b){function c(d,e){return null===d&&null===e?!0:null===d||null===e?!1:OV.TextureIsEqual(d,e)}return a.type===b.type&&a.name===b.name&&OV.ColorIsEqual(a.color,b.color)&&OV.ColorIsEqual(a.ambient,b.ambient)&&OV.ColorIsEqual(a.specular,b.specular)&&OV.ColorIsEqual(a.emissive,b.emissive)&&OV.IsEqual(a.metalness,b.metalness)&&OV.IsEqual(a.roughness,b.roughness)&&OV.IsEqual(a.shininess,b.shininess)&&OV.IsEqual(a.opacity,b.opacity)&&c(a.diffuseMap,b.diffuseMap)&&c(a.specularMap,
b.specularMap)&&c(a.bumpMap,b.bumpMap)&&c(a.normalMap,b.normalMap)&&c(a.emissiveMap,b.emissiveMap)&&c(a.metalnessMap,b.metalnessMap)&&OV.IsEqual(a.alphaTest,b.alphaTest)&&a.transparent===b.transparent&&a.multiplyDiffuseMap===b.multiplyDiffuseMap&&a.multiplyMetallicMap===b.multiplyMetallicMap&&a.isDefault===b.isDefault?!0:!1};
OV.EnumerateMaterialTextureMaps=function(a,b){null!==a.diffuseMap&&b(a.diffuseMap);null!==a.specularMap&&b(a.specularMap);null!==a.bumpMap&&b(a.bumpMap);null!==a.normalMap&&b(a.normalMap);null!==a.emissiveMap&&b(a.emissiveMap);null!==a.metalnessMap&&b(a.metalnessMap)};OV.Triangle=function(a,b,c){this.v0=a;this.v1=b;this.v2=c;this.curve=this.mat=this.u2=this.u1=this.u0=this.n2=this.n1=this.n0=null};OV.Triangle.prototype.HasVertices=function(){return null!==this.v0&&null!==this.v1&&null!==this.v2};OV.Triangle.prototype.HasNormals=function(){return null!==this.n0&&null!==this.n1&&null!==this.n2};OV.Triangle.prototype.HasTextureUVs=function(){return null!==this.u0&&null!==this.u1&&null!==this.u2};
OV.Triangle.prototype.SetVertices=function(a,b,c){this.v0=a;this.v1=b;this.v2=c;return this};OV.Triangle.prototype.SetNormals=function(a,b,c){this.n0=a;this.n1=b;this.n2=c;return this};OV.Triangle.prototype.SetTextureUVs=function(a,b,c){this.u0=a;this.u1=b;this.u2=c;return this};OV.Triangle.prototype.SetMaterial=function(a){this.mat=a;return this};OV.Triangle.prototype.SetCurve=function(a){this.curve=a;return this};
OV.Triangle.prototype.Clone=function(){var a=new OV.Triangle(this.v0,this.v1,this.v2);a.SetNormals(this.n0,this.n1,this.n2);a.SetTextureUVs(this.u0,this.u1,this.u2);a.SetMaterial(this.mat);a.SetCurve(this.curve);return a};OV.PropertyType={Text:1,Integer:2,Number:3,Boolean:4,Percent:5,Color:6};OV.Property=function(a,b,c){this.type=a;this.name=b;this.value=c};OV.PropertyGroup=function(a){this.name=a;this.properties=[]};OV.PropertyGroup.prototype.PropertyCount=function(){return this.properties.length};OV.PropertyGroup.prototype.AddProperty=function(a){this.properties.push(a)};OV.PropertyGroup.prototype.GetProperty=function(a){return this.properties[a]};OV.Object3D=function(){};OV.Object3D.prototype.VertexCount=function(){return 0};OV.Object3D.prototype.NormalCount=function(){return 0};OV.Object3D.prototype.TextureUVCount=function(){return 0};OV.Object3D.prototype.TriangleCount=function(){return 0};OV.Object3D.prototype.EnumerateVertices=function(a){};OV.Object3D.prototype.EnumerateTriangleVertexIndices=function(a){};OV.Object3D.prototype.EnumerateTriangleVertices=function(a){};
OV.ModelObject3D=function(){OV.Object3D.call(this);this.name="";this.propertyGroups=[]};$jscomp.inherits(OV.ModelObject3D,OV.Object3D);OV.ModelObject3D.prototype.GetName=function(){return this.name};OV.ModelObject3D.prototype.SetName=function(a){this.name=a};OV.ModelObject3D.prototype.PropertyGroupCount=function(){return this.propertyGroups.length};OV.ModelObject3D.prototype.AddPropertyGroup=function(a){this.propertyGroups.push(a);return this.propertyGroups.length-1};
OV.ModelObject3D.prototype.GetPropertyGroup=function(a){return this.propertyGroups[a]};OV.Mesh=function(){OV.ModelObject3D.call(this);this.vertices=[];this.normals=[];this.uvs=[];this.triangles=[]};$jscomp.inherits(OV.Mesh,OV.ModelObject3D);OV.Mesh.prototype.VertexCount=function(){return this.vertices.length};OV.Mesh.prototype.NormalCount=function(){return this.normals.length};OV.Mesh.prototype.TextureUVCount=function(){return this.uvs.length};OV.Mesh.prototype.TriangleCount=function(){return this.triangles.length};
OV.Mesh.prototype.AddVertex=function(a){this.vertices.push(a);return this.vertices.length-1};OV.Mesh.prototype.SetVertex=function(a,b){this.vertices[a]=b};OV.Mesh.prototype.GetVertex=function(a){return this.vertices[a]};OV.Mesh.prototype.AddNormal=function(a){this.normals.push(a);return this.normals.length-1};OV.Mesh.prototype.SetNormal=function(a,b){this.normals[a]=b};OV.Mesh.prototype.GetNormal=function(a){return this.normals[a]};
OV.Mesh.prototype.AddTextureUV=function(a){this.uvs.push(a);return this.uvs.length-1};OV.Mesh.prototype.SetTextureUV=function(a,b){this.uvs[a]=b};OV.Mesh.prototype.GetTextureUV=function(a){return this.uvs[a]};OV.Mesh.prototype.AddTriangle=function(a){this.triangles.push(a);return this.triangles.length-1};OV.Mesh.prototype.GetTriangle=function(a){return this.triangles[a]};OV.Mesh.prototype.EnumerateVertices=function(a){for(var b=$jscomp.makeIterator(this.vertices),c=b.next();!c.done;c=b.next())a(c.value)};
OV.Mesh.prototype.EnumerateTriangleVertexIndices=function(a){for(var b=$jscomp.makeIterator(this.triangles),c=b.next();!c.done;c=b.next())c=c.value,a(c.v0,c.v1,c.v2)};OV.Mesh.prototype.EnumerateTriangleVertices=function(a){for(var b=$jscomp.makeIterator(this.triangles),c=b.next();!c.done;c=b.next())c=c.value,a(this.vertices[c.v0],this.vertices[c.v1],this.vertices[c.v2])};OV.MeshPrimitiveBuffer=function(){this.indices=[];this.vertices=[];this.normals=[];this.uvs=[];this.material=null};OV.MeshPrimitiveBuffer.prototype.GetBounds=function(){for(var a=[Infinity,Infinity,Infinity],b=[-Infinity,-Infinity,-Infinity],c=0;c<this.vertices.length/3;c++)for(var d=0;3>d;d++)a[d]=Math.min(a[d],this.vertices[3*c+d]),b[d]=Math.max(b[d],this.vertices[3*c+d]);return{min:a,max:b}};
OV.MeshPrimitiveBuffer.prototype.GetByteLength=function(a,b){return this.indices.length*a+(this.vertices.length+this.normals.length+this.uvs.length)*b};OV.MeshBuffer=function(){this.primitives=[]};OV.MeshBuffer.prototype.PrimitiveCount=function(){return this.primitives.length};OV.MeshBuffer.prototype.GetPrimitive=function(a){return this.primitives[a]};OV.MeshBuffer.prototype.GetByteLength=function(a,b){for(var c=0,d=0;d<this.primitives.length;d++)c+=this.primitives[d].GetByteLength(a,b);return c};
OV.ConvertMeshToMeshBuffer=function(a){function b(k,l,m,n,p,r){function t(q,w,x,C,y){var z=0<q.TextureUVCount();w=q.GetVertex(w);x=q.GetNormal(x);var B=y.vertices.length/3;y.indices.push(B);y.vertices.push(w.x,w.y,w.z);y.normals.push(x.x,x.y,x.z);q=null!==C?q.GetTextureUV(C):z?new OV.Coord2D(0,0):null;null!==q&&y.uvs.push(q.x,q.y);return{index:B,normal:x,uv:q}}function v(q,w,x,C){for(var y=0;y<w.length;y++){var z=w[y],B=q.GetNormal(x);B=OV.CoordIsEqual3D(z.normal,B);if(null===z.uv&&null===C)var A=
!0;else A=null!==C?q.GetTextureUV(C):new OV.Coord2D(0,0),A=OV.CoordIsEqual2D(z.uv,A);if(B&&A)return z}return null}var u=r[l];void 0===u?(u=t(k,l,m,n,p),r[l]=[u]):(r=v(k,u,m,n),null!==r?p.indices.push(r.index):(l=t(k,l,m,n,p),u.push(l)))}var c=new OV.MeshBuffer,d=a.TriangleCount();if(0===d)return null;for(var e=[],g=0;g<d;g++)e.push(g);e.sort(function(k,l){k=a.GetTriangle(k);l=a.GetTriangle(l);return k.mat-l.mat});g=d=null;for(var f=0;f<e.length;f++){var h=a.GetTriangle(e[f]);if(null===d||d.material!==
h.mat)d=new OV.MeshPrimitiveBuffer,d.material=h.mat,g={},c.primitives.push(d);b(a,h.v0,h.n0,h.u0,d,g);b(a,h.v1,h.n1,h.u1,d,g);b(a,h.v2,h.n2,h.u2,d,g)}return c};OV.NodeType={GroupNode:0,MeshNode:1};OV.NodeIdGenerator=function(){this.nextId=0};OV.NodeIdGenerator.prototype.GenerateId=function(){var a=this.nextId;this.nextId+=1;return a};OV.Node=function(){this.type=OV.NodeType.GroupNode;this.name="";this.parent=null;this.transformation=new OV.Transformation;this.childNodes=[];this.meshIndices=[];this.idGenerator=new OV.NodeIdGenerator;this.id=this.idGenerator.GenerateId()};OV.Node.prototype.IsEmpty=function(){return 0===this.childNodes.length&&0===this.meshIndices.length};
OV.Node.prototype.GetType=function(){return this.type};OV.Node.prototype.SetType=function(a){this.type=a};OV.Node.prototype.GetId=function(){return this.id};OV.Node.prototype.GetName=function(){return this.name};OV.Node.prototype.SetName=function(a){this.name=a};OV.Node.prototype.HasParent=function(){return null!==this.parent};OV.Node.prototype.GetParent=function(){return this.parent};OV.Node.prototype.GetTransformation=function(){return this.transformation};
OV.Node.prototype.GetWorldTransformation=function(){for(var a=this.transformation.Clone(),b=this.parent;null!==b;)a.Append(b.transformation),b=b.parent;return a};OV.Node.prototype.SetTransformation=function(a){this.transformation=a};OV.Node.prototype.AddChildNode=function(a){a.parent=this;a.idGenerator=this.idGenerator;a.id=a.idGenerator.GenerateId();this.childNodes.push(a);return this.childNodes.length-1};
OV.Node.prototype.RemoveChildNode=function(a){a.parent=null;a=this.childNodes.indexOf(a);this.childNodes.splice(a,1)};OV.Node.prototype.GetChildNodes=function(){return this.childNodes};OV.Node.prototype.ChildNodeCount=function(){return this.childNodes.length};OV.Node.prototype.GetChildNode=function(a){return this.childNodes[a]};OV.Node.prototype.AddMeshIndex=function(a){this.meshIndices.push(a);return this.meshIndices.length-1};OV.Node.prototype.MeshIndexCount=function(){return this.meshIndices.length};
OV.Node.prototype.GetMeshIndex=function(a){return this.meshIndices[a]};OV.Node.prototype.GetMeshIndices=function(){return this.meshIndices};OV.Node.prototype.Enumerate=function(a){a(this);for(var b=$jscomp.makeIterator(this.childNodes),c=b.next();!c.done;c=b.next())c.value.Enumerate(a)};OV.Node.prototype.EnumerateChildren=function(a){for(var b=$jscomp.makeIterator(this.childNodes),c=b.next();!c.done;c=b.next())c=c.value,a(c),c.EnumerateChildren(a)};
OV.Node.prototype.EnumerateMeshIndices=function(a){for(var b=$jscomp.makeIterator(this.meshIndices),c=b.next();!c.done;c=b.next())a(c.value);b=$jscomp.makeIterator(this.childNodes);for(c=b.next();!c.done;c=b.next())c.value.EnumerateMeshIndices(a)};OV.MeshInstanceId=function(a,b){this.nodeId=a;this.meshIndex=b};OV.MeshInstanceId.prototype.IsEqual=function(a){return this.nodeId===a.nodeId&&this.meshIndex===a.meshIndex};OV.MeshInstanceId.prototype.GetKey=function(){return this.nodeId.toString()+":"+this.meshIndex.toString()};OV.MeshInstance=function(a,b){OV.ModelObject3D.call(this);this.node=a;this.mesh=b};$jscomp.inherits(OV.MeshInstance,OV.ModelObject3D);OV.MeshInstance.prototype.VertexCount=function(){return this.mesh.VertexCount()};
OV.MeshInstance.prototype.NormalCount=function(){return this.mesh.NormalCount()};OV.MeshInstance.prototype.TextureUVCount=function(){return this.mesh.TextureUVCount()};OV.MeshInstance.prototype.TriangleCount=function(){return this.mesh.TriangleCount()};OV.MeshInstance.prototype.EnumerateVertices=function(a){var b=this.node.GetWorldTransformation();b.IsIdentity()?this.mesh.EnumerateVertices(a):this.mesh.EnumerateVertices(function(c){c=b.TransformCoord3D(c);a(c)})};
OV.MeshInstance.prototype.EnumerateTriangleVertexIndices=function(a){this.mesh.EnumerateTriangleVertexIndices(a)};OV.MeshInstance.prototype.EnumerateTriangleVertices=function(a){var b=this.node.GetWorldTransformation();b.IsIdentity()?this.mesh.EnumerateTriangleVertices(a):this.mesh.EnumerateTriangleVertices(function(c,d,e){c=b.TransformCoord3D(c);d=b.TransformCoord3D(d);e=b.TransformCoord3D(e);a(c,d,e)})};OV.MeshInstance.prototype.PropertyGroupCount=function(){return this.mesh.PropertyGroupCount()};
OV.MeshInstance.prototype.AddPropertyGroup=function(a){return this.mesh.AddPropertyGroup(a)};OV.MeshInstance.prototype.GetPropertyGroup=function(a){return this.mesh.GetPropertyGroup(a)};OV.MeshInstance.prototype.GetTransformedMesh=function(){var a=this.node.GetWorldTransformation(),b=OV.CloneMesh(this.mesh);OV.TransformMesh(b,a);return b};OV.Model=function(){OV.ModelObject3D.call(this);this.root=new OV.Node;this.materials=[];this.meshes=[]};$jscomp.inherits(OV.Model,OV.ModelObject3D);OV.Model.prototype.GetRootNode=function(){return this.root};OV.Model.prototype.MaterialCount=function(){return this.materials.length};OV.Model.prototype.MeshCount=function(){return this.meshes.length};OV.Model.prototype.MeshInstanceCount=function(){var a=0;this.root.Enumerate(function(b){a+=b.MeshIndexCount()});return a};
OV.Model.prototype.VertexCount=function(){var a=0;this.EnumerateMeshInstances(function(b){a+=b.VertexCount()});return a};OV.Model.prototype.NormalCount=function(){var a=0;this.EnumerateMeshInstances(function(b){a+=b.NormalCount()});return a};OV.Model.prototype.TextureUVCount=function(){var a=0;this.EnumerateMeshInstances(function(b){a+=b.TextureUVCount()});return a};OV.Model.prototype.TriangleCount=function(){var a=0;this.EnumerateMeshInstances(function(b){a+=b.TriangleCount()});return a};
OV.Model.prototype.AddMaterial=function(a){this.materials.push(a);return this.materials.length-1};OV.Model.prototype.GetMaterial=function(a){return this.materials[a]};OV.Model.prototype.AddMesh=function(a){this.meshes.push(a);return this.meshes.length-1};OV.Model.prototype.AddMeshToRootNode=function(a){a=this.AddMesh(a);this.root.AddMeshIndex(a);return a};
OV.Model.prototype.RemoveMesh=function(a){this.meshes.splice(a,1);this.root.Enumerate(function(b){for(var c=0;c<b.meshIndices.length;c++)b.meshIndices[c]===a?(b.meshIndices.splice(c,1),--c):b.meshIndices[c]>a&&--b.meshIndices[c]})};OV.Model.prototype.GetMesh=function(a){return this.meshes[a]};
OV.Model.prototype.GetMeshInstance=function(a){var b=null;this.root.Enumerate(function(d){d.GetId()===a.nodeId&&(b=d)});if(null===b||-1===b.GetMeshIndices().indexOf(a.meshIndex))return null;var c=this.GetMesh(a.meshIndex);return new OV.MeshInstance(b,c)};OV.Model.prototype.EnumerateMeshes=function(a){for(var b=$jscomp.makeIterator(this.meshes),c=b.next();!c.done;c=b.next())a(c.value)};
OV.Model.prototype.EnumerateMeshInstances=function(a){var b=this;this.root.Enumerate(function(c){for(var d=$jscomp.makeIterator(c.GetMeshIndices()),e=d.next();!e.done;e=d.next())e=b.GetMesh(e.value),e=new OV.MeshInstance(c,e),a(e)})};OV.Model.prototype.EnumerateTransformedMeshes=function(a){this.EnumerateMeshInstances(function(b){b=b.GetTransformedMesh();a(b)})};OV.Model.prototype.EnumerateVertices=function(a){this.EnumerateMeshInstances(function(b){b.EnumerateVertices(a)})};
OV.Model.prototype.EnumerateTriangleVertexIndices=function(a){this.EnumerateMeshInstances(function(b){b.EnumerateTriangleVertexIndices(a)})};OV.Model.prototype.EnumerateTriangleVertices=function(a){this.EnumerateMeshInstances(function(b){b.EnumerateTriangleVertices(a)})};OV.TopologyVertex=function(){this.edges=[];this.triangles=[]};OV.TopologyEdge=function(a,b){this.vertex1=a;this.vertex2=b;this.triangles=[]};OV.TopologyTriangleEdge=function(a,b){this.edge=a;this.reversed=b};OV.TopologyTriangle=function(){this.triEdge3=this.triEdge2=this.triEdge1=null};OV.Topology=function(){this.vertices=[];this.edges=[];this.triangleEdges=[];this.triangles=[];this.edgeStartToEndVertexMap={}};
OV.Topology.prototype.AddVertex=function(){this.vertices.push(new OV.TopologyVertex);return this.vertices.length-1};
OV.Topology.prototype.AddTriangle=function(a,b,c){var d=this.triangles.length,e=new OV.TopologyTriangle;e.triEdge1=this.AddTriangleEdge(a,b);e.triEdge2=this.AddTriangleEdge(b,c);e.triEdge3=this.AddTriangleEdge(c,a);this.vertices[a].triangles.push(d);this.vertices[b].triangles.push(d);this.vertices[c].triangles.push(d);this.vertices[a].edges.push(this.triangleEdges[e.triEdge1].edge);this.vertices[b].edges.push(this.triangleEdges[e.triEdge2].edge);this.vertices[c].edges.push(this.triangleEdges[e.triEdge3].edge);
this.edges[this.triangleEdges[e.triEdge1].edge].triangles.push(d);this.edges[this.triangleEdges[e.triEdge2].edge].triangles.push(d);this.edges[this.triangleEdges[e.triEdge3].edge].triangles.push(d);this.triangles.push(e)};OV.Topology.prototype.AddTriangleEdge=function(a,b){var c=a,d=b,e=!1;b<a&&(c=b,d=a,e=!0);a=this.AddEdge(c,d);this.triangleEdges.push(new OV.TopologyTriangleEdge(a,e));return this.triangleEdges.length-1};
OV.Topology.prototype.AddEdge=function(a,b){void 0===this.edgeStartToEndVertexMap[a]&&(this.edgeStartToEndVertexMap[a]=[]);for(var c=this.edgeStartToEndVertexMap[a],d=0;d<c.length;d++){var e=c[d];if(e.endVertex===b)return e.edgeIndex}d=this.edges.length;c.push({endVertex:b,edgeIndex:d});this.edges.push(new OV.TopologyEdge(a,b));return d};OV.CalculateTriangleNormal=function(a,b,c){b=OV.SubCoord3D(b,a);a=OV.SubCoord3D(c,a);a=OV.CrossVector3D(b,a);a.Normalize();return a};
OV.TransformMesh=function(a,b){if(!b.IsIdentity()){for(var c=0;c<a.VertexCount();c++){var d=a.GetVertex(c),e=b.TransformCoord3D(d);d.x=e.x;d.y=e.y;d.z=e.z}if(0<a.NormalCount())for(b=b.GetMatrix().DecomposeTRS(),b=(new OV.Matrix).ComposeTRS(new OV.Coord3D(0,0,0),b.rotation,new OV.Coord3D(1,1,1)),b=new OV.Transformation(b),c=0;c<a.NormalCount();c++)d=a.GetNormal(c),e=b.TransformCoord3D(d),d.x=e.x,d.y=e.y,d.z=e.z}};
OV.FlipMeshTrianglesOrientation=function(a){for(var b=0;b<a.TriangleCount();b++){var c=a.GetTriangle(b),d=c.v1;c.v1=c.v2;c.v2=d}};OV.IsModelEmpty=function(a){var b=!0;a.EnumerateMeshInstances(function(c){0<c.TriangleCount()&&(b=!1)});return b};
OV.CloneMesh=function(a){var b=new OV.Mesh;b.SetName(a.GetName());for(var c=0;c<a.VertexCount();c++){var d=a.GetVertex(c);b.AddVertex(d.Clone())}for(c=0;c<a.NormalCount();c++)d=a.GetNormal(c),b.AddNormal(d.Clone());for(c=0;c<a.TextureUVCount();c++)d=a.GetTextureUV(c),b.AddTextureUV(d.Clone());for(c=0;c<a.TriangleCount();c++)d=a.GetTriangle(c),b.AddTriangle(d.Clone());return b};
OV.EnumerateModelVerticesAndTriangles=function(a,b){a.EnumerateMeshInstances(function(d){d.EnumerateVertices(function(e){b.onVertex(e.x,e.y,e.z)})});var c=0;a.EnumerateMeshInstances(function(d){d.EnumerateTriangleVertexIndices(function(e,g,f){b.onTriangle(e+c,g+c,f+c)});c+=d.VertexCount()})};OV.EnumerateTrianglesWithNormals=function(a,b){a.EnumerateTriangleVertices(function(c,d,e){var g=OV.CalculateTriangleNormal(c,d,e);b(c,d,e,g)})};
OV.GetBoundingBox=function(a){var b=new OV.BoundingBoxCalculator3D;a.EnumerateVertices(function(c){b.AddPoint(c)});return b.GetBox()};OV.GetTopology=function(a){function b(g,f,h){var k=f.FindPoint(g);null===k&&(k=h.AddVertex(),f.AddPoint(g,k));return k}var c=OV.GetBoundingBox(a),d=new OV.Octree(c),e=new OV.Topology;a.EnumerateTriangleVertices(function(g,f,h){g=b(g,d,e);f=b(f,d,e);h=b(h,d,e);e.AddTriangle(g,f,h)});return e};
OV.IsSolid=function(a){a=OV.GetTopology(a);for(var b=0;b<a.edges.length;b++){var c=a.edges[b],d=c.triangles.length;if(0===d||0!==d%2)return!1;for(var e=d=0;e<c.triangles.length;e++){var g=a.triangles[c.triangles[e]];var f=a.triangleEdges[g.triEdge1];var h=a.triangleEdges[g.triEdge2];g=a.triangleEdges[g.triEdge3];f=f.edge===b?f.reversed:h.edge===b?h.reversed:g.edge===b?g.reversed:null;d=f?d+1:d-1}if(0!==d)return!1}return!0};
OV.HasDefaultMaterial=function(a){for(var b=0;b<a.MaterialCount();b++)if(a.GetMaterial(b).isDefault)return!0;return!1};OV.ReplaceDefaultMaterialColor=function(a,b){for(var c=0;c<a.MaterialCount();c++){var d=a.GetMaterial(c);d.isDefault&&(d.color=b)}};OV.GetRepresentativeMaterialType=function(a){for(var b=OV.MaterialType.Phong,c=0,d=new Map,e=0;e<a.MaterialCount();e++){var g=a.GetMaterial(e);d.has(g.type)||d.set(g.type,0);var f=d.get(g.type)+1;d.set(g.type,f);f>c&&(b=g.type,c=f)}return b};OV.FinalizeModel=function(a,b){function c(k,l){function m(t){function v(B,A,E,F,G){var D=[];E=G[E];for(G=0;G<E.length;G++){var I=E[G],H=B.GetTriangle(I);if(A.curve===H.curve){I=F[I];a:{H=D;for(var J=I,K=0;K<H.length;K++)if(OV.CoordIsEqual3D(H[K],J)){H=!0;break a}H=!1}H||D.push(I)}}A=new OV.Coord3D(0,0,0);for(F=0;F<D.length;F++)A=OV.AddCoord3D(A,D[F]);A.MultiplyScalar(1/D.length);A.Normalize();return B.AddNormal(A)}for(var u=[],q={},w=0;w<t.VertexCount();w++)q[w]=[];for(w=0;w<t.TriangleCount();w++){var x=
t.GetTriangle(w),C=t.GetVertex(x.v0),y=t.GetVertex(x.v1),z=t.GetVertex(x.v2);C=OV.CalculateTriangleNormal(C,y,z);u.push(C);q[x.v0].push(w);q[x.v1].push(w);q[x.v2].push(w)}for(w=0;w<t.TriangleCount();w++)x=t.GetTriangle(w),x.HasNormals()||(C=v(t,x,x.v0,u,q),y=v(t,x,x.v1,u,q),z=v(t,x,x.v2,u,q),x.SetNormals(C,y,z))}function n(t,v,u){if(!v.HasNormals())if(null===v.curve||0===v.curve){var q=t.GetVertex(v.v0),w=t.GetVertex(v.v1),x=t.GetVertex(v.v2);q=OV.CalculateTriangleNormal(q,w,x);t=t.AddNormal(q);v.SetNormals(t,
t,t)}else u.calculateCurveNormals=!0;null===v.mat&&(v.mat=u.getDefaultMaterialIndex());null===v.curve&&(v.curve=0)}l={getDefaultMaterialIndex:l,calculateCurveNormals:!1};for(var p=0;p<k.TriangleCount();p++){var r=k.GetTriangle(p);n(k,r,l)}l.calculateCurveNormals&&m(k)}for(var d=null,e=function(){if(null===d){var k=b();k.isDefault=!0;d=a.AddMaterial(k)}return d},g=0;g<a.MeshCount();g++){var f=a.GetMesh(g);0===f.TriangleCount()?(a.RemoveMesh(g),--g):c(f,e)}var h=[];a.GetRootNode().EnumerateChildren(function(k){k.IsEmpty()&&
h.push(k)});for(e=0;e<h.length;e++)g=h[e],f=g.GetParent(),null!==f&&(f.RemoveChildNode(g),f.IsEmpty()&&h.push(f))};
OV.CheckModel=function(a){function b(f){return void 0===f||null===f||isNaN(f)?!1:!0}function c(f,h){return!b(f)||0>f||f>=h?!1:!0}function d(f,h){for(var k=0;k<h.VertexCount();k++){var l=h.GetVertex(k);if(!b(l.x)||!b(l.y)||!b(l.z))return!1}for(k=0;k<h.NormalCount();k++)if(l=h.GetNormal(k),!b(l.x)||!b(l.y)||!b(l.z))return!1;for(k=0;k<h.TextureUVCount();k++)if(l=h.GetTextureUV(k),!b(l.x)||!b(l.y))return!1;for(k=0;k<h.TriangleCount();k++){var m=h.GetTriangle(k);l=f;var n=h;if(!(c(m.v0,n.VertexCount())&&
c(m.v1,n.VertexCount())&&c(m.v2,n.VertexCount())&&c(m.n0,n.NormalCount())&&c(m.n1,n.NormalCount())&&c(m.n2,n.NormalCount())&&(!m.HasTextureUVs()||c(m.u0,n.TextureUVCount())&&c(m.u1,n.TextureUVCount())&&c(m.u2,n.TextureUVCount()))&&c(m.mat,l.MaterialCount())&&b(m.curve)))return!1}return!0}for(var e=0;e<a.MeshCount();e++){var g=a.GetMesh(e);if(!d(a,g))return!1}return!0};OV.GetTriangleArea=function(a,b,c){var d=OV.CoordDistance3D(a,b);b=OV.CoordDistance3D(b,c);a=OV.CoordDistance3D(a,c);c=(d+b+a)/2;d=c*(c-d)*(c-b)*(c-a);return 0>d?0:Math.sqrt(d)};OV.GetTetrahedronSignedVolume=function(a,b,c){return OV.DotVector3D(a,OV.CrossVector3D(b,c))/6};OV.CalculateVolume=function(a){if(!OV.IsSolid(a))return null;var b=0;a.EnumerateTriangleVertices(function(c,d,e){b+=OV.GetTetrahedronSignedVolume(c,d,e)});return b};
OV.CalculateSurfaceArea=function(a){var b=0;a.EnumerateTriangleVertices(function(c,d,e){b+=OV.GetTriangleArea(c,d,e)});return b};OV.GeneratorParams=function(){this.material=this.name=null};OV.GeneratorParams.prototype.SetName=function(a){this.name=a;return this};OV.GeneratorParams.prototype.SetMaterial=function(a){this.material=a;return this};OV.Generator=function(a){this.params=a||new OV.GeneratorParams;this.mesh=new OV.Mesh;null!==this.params.name&&this.mesh.SetName(this.params.name);this.curve=null};OV.Generator.prototype.GetMesh=function(){return this.mesh};
OV.Generator.prototype.AddVertex=function(a,b,c){a=new OV.Coord3D(a,b,c);return this.mesh.AddVertex(a)};OV.Generator.prototype.AddVertices=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];b.push(this.AddVertex(d.x,d.y,d.z))}return b};OV.Generator.prototype.SetCurve=function(a){this.curve=a};OV.Generator.prototype.ResetCurve=function(){this.curve=null};
OV.Generator.prototype.AddTriangle=function(a,b,c){a=new OV.Triangle(a,b,c);null!==this.params.material&&a.SetMaterial(this.params.material);null!==this.curve&&a.SetCurve(this.curve);return this.mesh.AddTriangle(a)};OV.Generator.prototype.AddTriangleInverted=function(a,b,c){this.AddTriangle(a,c,b)};OV.Generator.prototype.AddConvexPolygon=function(a){for(var b=0;b<a.length-2;b++)this.AddTriangle(a[0],a[b+1],a[b+2])};
OV.Generator.prototype.AddConvexPolygonInverted=function(a){for(var b=0;b<a.length-2;b++)this.AddTriangleInverted(a[0],a[b+1],a[b+2])};OV.GeneratorHelper=function(a){this.generator=a};
OV.GeneratorHelper.prototype.GenerateExtrude=function(a,b,c){for(var d=[],e=[],g=0;g<a.length;g++){var f=a[g];e.push(this.generator.AddVertex(f.x,f.y,0));d.push(this.generator.AddVertex(f.x,f.y,b))}this.generator.SetCurve(c);this.GenerateSurfaceBetweenPolygons(e,d);this.generator.ResetCurve();this.generator.AddConvexPolygonInverted(e);this.generator.AddConvexPolygon(d)};
OV.GeneratorHelper.prototype.GenerateSurfaceBetweenPolygons=function(a,b){if(a.length===b.length)for(var c=a.length,d=0;d<c;d++){var e=d,g=d<c-1?e+1:0;this.generator.AddConvexPolygon([a[e],a[g],b[g],b[e]])}};OV.GeneratorHelper.prototype.GenerateTriangleFan=function(a,b){for(var c=a.length,d=0;d<c;d++){var e=d;this.generator.AddTriangle(b,a[e],a[d<c-1?e+1:0])}};
OV.GenerateCuboid=function(a,b,c,d){a=new OV.Generator(a);b=[new OV.Coord2D(0,0),new OV.Coord2D(b,0),new OV.Coord2D(b,c),new OV.Coord2D(0,c)];(new OV.GeneratorHelper(a)).GenerateExtrude(b,d,null);return a.GetMesh()};OV.GenerateCylinder=function(a,b,c,d,e){if(3>d)return null;a=new OV.Generator(a);for(var g=[],f=2*Math.PI/d,h=0;h<d;h++){var k=h*f;k=new OV.Coord2D(b*Math.cos(k),b*Math.sin(k));g.push(k)}(new OV.GeneratorHelper(a)).GenerateExtrude(g,c,e?1:null);return a.GetMesh()};
OV.GenerateSphere=function(a,b,c,d){if(3>c)return null;a=new OV.Generator(a);var e=new OV.GeneratorHelper(a);a.SetCurve(d?1:null);d=[];for(var g=c+1,f=Math.PI/c,h=2*Math.PI/c,k=1;k<g-1;k++){for(var l=[],m=k*f,n=0;n<c;n++){var p=-(n*h);p=new OV.Coord3D(b*Math.sin(m)*Math.cos(p),b*Math.sin(m)*Math.sin(p),b*Math.cos(m));l.push(a.AddVertex(p.x,p.y,p.z))}1<k&&e.GenerateSurfaceBetweenPolygons(d[d.length-1],l);d.push(l)}c=a.AddVertex(0,0,b);b=a.AddVertex(0,0,-b);e.GenerateTriangleFan(d[0].slice().reverse(),
c);e.GenerateTriangleFan(d[d.length-1],b);a.ResetCurve();return a.GetMesh()};
OV.GeneratePlatonicSolid=function(a,b,c){function d(g,f,h,k,l){h=new OV.Coord3D(h,k,l);h.MultiplyScalar(f/h.Length());g.AddVertex(h.x,h.y,h.z)}if(OV.IsZero(c))return null;a=new OV.Generator(a);if("tetrahedron"===b)d(a,c,1,1,1),d(a,c,-1,-1,1),d(a,c,-1,1,-1),d(a,c,1,-1,-1),a.AddTriangle(0,1,3),a.AddTriangle(0,2,1),a.AddTriangle(0,3,2),a.AddTriangle(1,2,3);else if("hexahedron"===b)d(a,c,1,1,1),d(a,c,1,1,-1),d(a,c,1,-1,1),d(a,c,1,-1,-1),d(a,c,-1,1,1),d(a,c,-1,1,-1),d(a,c,-1,-1,1),d(a,c,-1,-1,-1),a.AddConvexPolygon([0,
1,5,4]),a.AddConvexPolygon([0,2,3,1]),a.AddConvexPolygon([0,4,6,2]),a.AddConvexPolygon([1,3,7,5]),a.AddConvexPolygon([2,6,7,3]),a.AddConvexPolygon([4,5,7,6]);else if("octahedron"===b)d(a,c,1,0,0),d(a,c,-1,0,0),d(a,c,0,1,0),d(a,c,0,-1,0),d(a,c,0,0,1),d(a,c,0,0,-1),a.AddTriangle(0,2,4),a.AddTriangle(0,3,5),a.AddTriangle(0,4,3),a.AddTriangle(0,5,2),a.AddTriangle(1,2,5),a.AddTriangle(1,3,4),a.AddTriangle(1,4,2),a.AddTriangle(1,5,3);else if("dodecahedron"===b){b=(1+Math.sqrt(5))/2;var e=1/b;d(a,c,1,1,
1);d(a,c,1,1,-1);d(a,c,1,-1,1);d(a,c,-1,1,1);d(a,c,1,-1,-1);d(a,c,-1,1,-1);d(a,c,-1,-1,1);d(a,c,-1,-1,-1);d(a,c,0,+e,+b);d(a,c,0,+e,-b);d(a,c,0,-e,+b);d(a,c,0,-e,-b);d(a,c,+e,+b,0);d(a,c,+e,-b,0);d(a,c,-e,+b,0);d(a,c,-e,-b,0);d(a,c,+b,0,+e);d(a,c,-b,0,+e);d(a,c,+b,0,-e);d(a,c,-b,0,-e);a.AddConvexPolygon([0,8,10,2,16]);a.AddConvexPolygon([0,16,18,1,12]);a.AddConvexPolygon([0,12,14,3,8]);a.AddConvexPolygon([1,9,5,14,12]);a.AddConvexPolygon([1,18,4,11,9]);a.AddConvexPolygon([2,10,6,15,13]);a.AddConvexPolygon([2,
13,4,18,16]);a.AddConvexPolygon([3,14,5,19,17]);a.AddConvexPolygon([3,17,6,10,8]);a.AddConvexPolygon([4,13,15,7,11]);a.AddConvexPolygon([5,9,11,7,19]);a.AddConvexPolygon([6,17,19,7,15])}else"icosahedron"===b&&(b=(1+Math.sqrt(5))/2,d(a,c,0,1,+b),d(a,c,0,1,-b),d(a,c,0,-1,+b),d(a,c,0,-1,-b),d(a,c,1,+b,0),d(a,c,1,-b,0),d(a,c,-1,+b,0),d(a,c,-1,-b,0),d(a,c,+b,0,1),d(a,c,+b,0,-1),d(a,c,-b,0,1),d(a,c,-b,0,-1),a.AddTriangle(0,2,8),a.AddTriangle(0,4,6),a.AddTriangle(0,6,10),a.AddTriangle(0,8,4),a.AddTriangle(0,
10,2),a.AddTriangle(1,3,11),a.AddTriangle(1,4,9),a.AddTriangle(1,6,4),a.AddTriangle(1,9,3),a.AddTriangle(1,11,6),a.AddTriangle(2,5,8),a.AddTriangle(2,7,5),a.AddTriangle(2,10,7),a.AddTriangle(3,5,7),a.AddTriangle(3,7,11),a.AddTriangle(3,9,5),a.AddTriangle(4,8,9),a.AddTriangle(5,9,8),a.AddTriangle(6,11,10),a.AddTriangle(7,10,11));return a.GetMesh()};OV.NameFromLine=function(a,b,c){a=a.substr(b);c=a.indexOf(c);-1!==c&&(a=a.substr(0,c));return a.trim()};OV.ParametersFromLine=function(a,b){null!==b&&(b=a.indexOf(b),-1!==b&&(a=a.substr(0,b).trim()));return a.split(/\s+/u)};OV.ReadLines=function(a,b){for(var c=0,d=a.indexOf("\n",c);-1!==d;){var e=a.substr(c,d-c);c=b;e=e.trim();0<e.length&&c(e);c=d+1;d=a.indexOf("\n",c)}a=a.substr(c).trim();0<a.length&&b(a)};OV.IsPowerOfTwo=function(a){return 0===(a&a-1)};
OV.NextPowerOfTwo=function(a){return OV.IsPowerOfTwo(a)?a:parseInt(Math.pow(2,Math.ceil(Math.log(a)/Math.log(2))),10)};OV.UpdateMaterialTransparency=function(a){a.transparent=!1;OV.IsLower(a.opacity,1)&&(a.transparent=!0)};OV.ImporterBase=function(){this.message=this.error=this.model=this.callbacks=this.extension=this.name=null};OV.ImporterBase.prototype.Import=function(a,b,c,d){var e=this;this.Clear();this.name=a;this.extension=b;this.callbacks=d;this.model=new OV.Model;this.error=!1;this.message=null;this.ResetContent();this.ImportContent(c,function(){e.CreateResult(d)})};OV.ImporterBase.prototype.Clear=function(){this.message=this.error=this.model=this.callbacks=this.extension=this.name=null;this.ClearContent()};
OV.ImporterBase.prototype.CreateResult=function(a){if(this.error)a.onError();else OV.IsModelEmpty(this.model)?(this.error=!0,a.onError()):(OV.FinalizeModel(this.model,this.callbacks.getDefaultMaterial),a.onSuccess());a.onComplete()};OV.ImporterBase.prototype.CanImportExtension=function(a){return!1};OV.ImporterBase.prototype.GetUpDirection=function(){return OV.Direction.Z};OV.ImporterBase.prototype.ClearContent=function(){};OV.ImporterBase.prototype.ResetContent=function(){};
OV.ImporterBase.prototype.ImportContent=function(a,b){};OV.ImporterBase.prototype.GetModel=function(){return this.model};OV.ImporterBase.prototype.SetError=function(a){this.error=!0;void 0!==a&&null!==a&&(this.message=a)};OV.ImporterBase.prototype.WasError=function(){return this.error};OV.ImporterBase.prototype.GetErrorMessage=function(){return this.message};OV.ObjMeshData=function(a){this.mesh=a;this.globalToCurrentVertices=new Map;this.globalToCurrentNormals=new Map;this.globalToCurrentUvs=new Map};OV.ObjMeshData.prototype.GetLocalVertexIndex=function(a,b){var c=this;return this.GetLocalIndex(a,b,this.globalToCurrentVertices,function(d){return c.mesh.AddVertex(new OV.Coord3D(d.x,d.y,d.z))})};
OV.ObjMeshData.prototype.GetLocalNormalIndex=function(a,b){var c=this;return this.GetLocalIndex(a,b,this.globalToCurrentNormals,function(d){return c.mesh.AddNormal(new OV.Coord3D(d.x,d.y,d.z))})};OV.ObjMeshData.prototype.GetLocalUVIndex=function(a,b){var c=this;return this.GetLocalIndex(a,b,this.globalToCurrentUvs,function(d){return c.mesh.AddTextureUV(new OV.Coord2D(d.x,d.y))})};OV.ObjMeshData.prototype.AddTriangle=function(a){this.mesh.AddTriangle(a)};
OV.ObjMeshData.prototype.GetLocalIndex=function(a,b,c,d){if(isNaN(a)||0>a||a>=b.length)return null;if(c.has(a))return c.get(a);b=d(b[a]);c.set(a,b);return b};OV.ImporterObj=function(){OV.ImporterBase.call(this)};$jscomp.inherits(OV.ImporterObj,OV.ImporterBase);OV.ImporterObj.prototype.CanImportExtension=function(a){return"obj"===a};OV.ImporterObj.prototype.GetUpDirection=function(){return OV.Direction.Y};
OV.ImporterObj.prototype.ClearContent=function(){this.materialNameToIndex=this.meshNameToMeshData=this.currentMaterialIndex=this.currentMaterial=this.currentMeshData=this.globalUvs=this.globalNormals=this.globalVertices=null};OV.ImporterObj.prototype.ResetContent=function(){this.globalVertices=[];this.globalNormals=[];this.globalUvs=[];this.currentMaterialIndex=this.currentMaterial=this.currentMeshData=null;this.meshNameToMeshData=new Map;this.materialNameToIndex=new Map};
OV.ImporterObj.prototype.ImportContent=function(a,b){var c=this;a=OV.ArrayBufferToUtf8String(a);OV.ReadLines(a,function(d){c.WasError()||c.ProcessLine(d)});b()};OV.ImporterObj.prototype.ProcessLine=function(a){if("#"!==a[0]){var b=OV.ParametersFromLine(a,"#");if(0!==b.length){var c=b[0].toLowerCase();b.shift();this.ProcessMeshParameter(c,b,a)||this.ProcessMaterialParameter(c,b,a)}}};
OV.ImporterObj.prototype.AddNewMesh=function(a){if(this.meshNameToMeshData.has(a))this.currentMeshData=this.meshNameToMeshData.get(a);else{var b=new OV.Mesh;b.SetName(a);this.model.AddMeshToRootNode(b);this.currentMeshData=new OV.ObjMeshData(b);this.meshNameToMeshData.set(a,this.currentMeshData)}};
OV.ImporterObj.prototype.ProcessMeshParameter=function(a,b,c){if("g"===a||"o"===a){if(0===b.length)return!0;a=OV.NameFromLine(c,a.length,"#");this.AddNewMesh(a);return!0}if("v"===a){if(3>b.length)return!0;this.globalVertices.push(new OV.Coord3D(parseFloat(b[0]),parseFloat(b[1]),parseFloat(b[2])));return!0}if("vn"===a){if(3>b.length)return!0;this.globalNormals.push(new OV.Coord3D(parseFloat(b[0]),parseFloat(b[1]),parseFloat(b[2])));return!0}if("vt"===a){if(2>b.length)return!0;this.globalUvs.push(new OV.Coord2D(parseFloat(b[0]),
parseFloat(b[1])));return!0}if("f"===a){if(3>b.length)return!0;this.ProcessFace(b);return!0}return!1};
OV.ImporterObj.prototype.ProcessMaterialParameter=function(a,b,c){function d(f){return new OV.Color(parseInt(parseFloat(255*f[0]),10),parseInt(parseFloat(255*f[1]),10),parseInt(parseFloat(255*f[2]),10))}function e(f,h,k){var l=new OV.TextureMap;f=OV.NameFromLine(h,f.length,"#");k=k.getTextureBuffer(f);l.name=f;null!==k&&(l.url=k.url,l.buffer=k.buffer);return l}var g=this;if("newmtl"===a){if(0===b.length)return!0;b=new OV.Material(OV.MaterialType.Phong);a=OV.NameFromLine(c,a.length,"#");c=this.model.AddMaterial(b);
b.name=a;this.currentMaterial=b;this.materialNameToIndex.set(a,c);return!0}if("usemtl"===a){if(0===b.length)return!0;b=OV.NameFromLine(c,a.length,"#");this.materialNameToIndex.has(b)&&(this.currentMaterialIndex=this.materialNameToIndex.get(b));return!0}if("mtllib"===a){if(0===b.length)return!0;b=OV.NameFromLine(c,a.length,"#");b=this.callbacks.getFileBuffer(b);null!==b&&(b=OV.ArrayBufferToUtf8String(b),OV.ReadLines(b,function(f){g.WasError()||g.ProcessLine(f)}));return!0}if("map_kd"===a){if(null===
this.currentMaterial||0===b.length)return!0;this.currentMaterial.diffuseMap=e(a,c,this.callbacks);OV.UpdateMaterialTransparency(this.currentMaterial);return!0}if("map_ks"===a){if(null===this.currentMaterial||0===b.length)return!0;this.currentMaterial.specularMap=e(a,c,this.callbacks);return!0}if("map_bump"===a||"bump"===a){if(null===this.currentMaterial||0===b.length)return!0;this.currentMaterial.bumpMap=e(a,c,this.callbacks);return!0}if("ka"===a){if(null===this.currentMaterial||3>b.length)return!0;
this.currentMaterial.ambient=d(b);return!0}if("kd"===a){if(null===this.currentMaterial||3>b.length)return!0;this.currentMaterial.color=d(b);return!0}if("ks"===a){if(null===this.currentMaterial||3>b.length)return!0;this.currentMaterial.specular=d(b);return!0}if("ns"===a){if(null===this.currentMaterial||1>b.length)return!0;this.currentMaterial.shininess=parseFloat(b[0])/1E3;return!0}if("tr"===a){if(null===this.currentMaterial||1>b.length)return!0;this.currentMaterial.opacity=1-parseFloat(b[0]);OV.UpdateMaterialTransparency(this.currentMaterial);
return!0}if("d"===a){if(null===this.currentMaterial||1>b.length)return!0;this.currentMaterial.opacity=parseFloat(b[0]);OV.UpdateMaterialTransparency(this.currentMaterial);return!0}return!1};
OV.ImporterObj.prototype.ProcessFace=function(a){function b(l,m){return 0<l?l-1:m+l}for(var c=[],d=[],e=[],g=0;g<a.length;g++){var f=a[g].split("/");c.push(b(parseInt(f[0],10),this.globalVertices.length));1<f.length&&0<f[1].length&&e.push(b(parseInt(f[1],10),this.globalUvs.length));2<f.length&&0<f[2].length&&d.push(b(parseInt(f[2],10),this.globalNormals.length))}null===this.currentMeshData&&this.AddNewMesh("");for(a=0;a<c.length-2;a++){g=this.currentMeshData.GetLocalVertexIndex(c[0],this.globalVertices);
f=this.currentMeshData.GetLocalVertexIndex(c[a+1],this.globalVertices);var h=this.currentMeshData.GetLocalVertexIndex(c[a+2],this.globalVertices);if(null===g||null===f||null===h){this.SetError("Invalid vertex index.");break}g=new OV.Triangle(g,f,h);if(d.length===c.length){f=this.currentMeshData.GetLocalNormalIndex(d[0],this.globalNormals);h=this.currentMeshData.GetLocalNormalIndex(d[a+1],this.globalNormals);var k=this.currentMeshData.GetLocalNormalIndex(d[a+2],this.globalNormals);if(null===f||null===
h||null===k){this.SetError("Invalid normal index.");break}g.SetNormals(f,h,k)}if(e.length===c.length){f=this.currentMeshData.GetLocalUVIndex(e[0],this.globalUvs);h=this.currentMeshData.GetLocalUVIndex(e[a+1],this.globalUvs);k=this.currentMeshData.GetLocalUVIndex(e[a+2],this.globalUvs);if(null===f||null===h||null===k){this.SetError("Invalid uv index.");break}g.SetTextureUVs(f,h,k)}null!==this.currentMaterialIndex&&(g.mat=this.currentMaterialIndex);this.currentMeshData.AddTriangle(g)}};OV.ImporterStl=function(){OV.ImporterBase.call(this)};$jscomp.inherits(OV.ImporterStl,OV.ImporterBase);OV.ImporterStl.prototype.CanImportExtension=function(a){return"stl"===a};OV.ImporterStl.prototype.GetUpDirection=function(){return OV.Direction.Z};OV.ImporterStl.prototype.ClearContent=function(){this.triangle=this.mesh=null};OV.ImporterStl.prototype.ResetContent=function(){this.mesh=new OV.Mesh;this.model.AddMeshToRootNode(this.mesh);this.triangle=null};
OV.ImporterStl.prototype.ImportContent=function(a,b){var c=this;this.IsBinaryStlFile(a)?this.ProcessBinary(a):(a=OV.ArrayBufferToUtf8String(a),OV.ReadLines(a,function(d){c.WasError()||c.ProcessLine(d)}));b()};OV.ImporterStl.prototype.IsBinaryStlFile=function(a){var b=a.byteLength;if(84>b)return!1;a=new OV.BinaryReader(a,!0);a.Skip(80);a=a.ReadUnsignedInteger32();return b!==50*a+84?!1:!0};
OV.ImporterStl.prototype.ProcessLine=function(a){if("#"!==a[0]){var b=OV.ParametersFromLine(a,"#");if(0!==b.length){var c=b[0];"solid"===c?1<b.length&&(a=OV.NameFromLine(a,c.length,"#"),this.mesh.SetName(a)):"facet"===c?(this.triangle=new OV.Triangle(-1,-1,-1),5<=b.length&&"normal"===b[1]&&(a=new OV.Coord3D(parseFloat(b[2]),parseFloat(b[3]),parseFloat(b[4])),OV.IsPositive(a.Length())&&(a=this.mesh.AddNormal(a),this.triangle.SetNormals(a,a,a)))):"vertex"===c&&null!==this.triangle?4<=b.length&&(a=this.mesh.AddVertex(new OV.Coord3D(parseFloat(b[1]),
parseFloat(b[2]),parseFloat(b[3]))),-1===this.triangle.v0?this.triangle.v0=a:-1===this.triangle.v1?this.triangle.v1=a:-1===this.triangle.v2&&(this.triangle.v2=a)):"endfacet"===c&&null!==this.triangle&&(-1!==this.triangle.v0&&-1!==this.triangle.v1&&null!==this.triangle.v2&&this.mesh.AddTriangle(this.triangle),this.triangle=null)}}};
OV.ImporterStl.prototype.ProcessBinary=function(a){function b(l){var m=new OV.Coord3D;m.x=l.ReadFloat32();m.y=l.ReadFloat32();m.z=l.ReadFloat32();return m}function c(l,m){m=b(m);return l.AddVertex(m)}a=new OV.BinaryReader(a,!0);a.Skip(80);for(var d=a.ReadUnsignedInteger32(),e=0;e<d;e++){var g=b(a),f=c(this.mesh,a),h=c(this.mesh,a),k=c(this.mesh,a);a.Skip(2);f=new OV.Triangle(f,h,k);OV.IsPositive(g.Length())&&(g=this.mesh.AddNormal(g),f.SetNormals(g,g,g));this.mesh.AddTriangle(f)}};OV.ImporterOff=function(){OV.ImporterBase.call(this)};$jscomp.inherits(OV.ImporterOff,OV.ImporterBase);OV.ImporterOff.prototype.CanImportExtension=function(a){return"off"===a};OV.ImporterOff.prototype.GetUpDirection=function(){return OV.Direction.Y};OV.ImporterOff.prototype.ClearContent=function(){this.status=this.mesh=null};OV.ImporterOff.prototype.ResetContent=function(){this.mesh=new OV.Mesh;this.model.AddMeshToRootNode(this.mesh);this.status={vertexCount:0,faceCount:0,foundVertex:0,foundFace:0}};
OV.ImporterOff.prototype.ImportContent=function(a,b){var c=this;a=OV.ArrayBufferToUtf8String(a);OV.ReadLines(a,function(d){c.WasError()||c.ProcessLine(d)});b()};
OV.ImporterOff.prototype.ProcessLine=function(a){if("#"!==a[0]&&(a=OV.ParametersFromLine(a,"#"),0!==a.length&&"OFF"!==a[0]))if(0===this.status.vertexCount&&0===this.status.faceCount)1<a.length&&(this.status.vertexCount=parseInt(a[0],10),this.status.faceCount=parseInt(a[1],10));else if(this.status.foundVertex<this.status.vertexCount)3<=a.length&&(this.mesh.AddVertex(new OV.Coord3D(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2]))),this.status.foundVertex+=1);else if(this.status.foundFace<this.status.faceCount&&
4<=a.length){var b=parseInt(a[0],10);if(!(a.length<b+1)){for(var c=0;c<b-2;c++){var d=parseInt(a[1]),e=parseInt(a[c+2]),g=parseInt(a[c+3]);d=new OV.Triangle(d,e,g);this.mesh.AddTriangle(d)}this.status.foundFace+=1}}};OV.PlyHeaderCheckResult={Ok:1,NoVertices:2,NoFaces:3,UnknownError:4};OV.PlyHeader=function(){this.format=null;this.elements=[]};OV.PlyHeader.prototype.SetFormat=function(a){this.format=a};OV.PlyHeader.prototype.AddElement=function(a,b){this.elements.push({name:a,count:b,format:[]})};OV.PlyHeader.prototype.GetElements=function(){return this.elements};OV.PlyHeader.prototype.AddSingleFormat=function(a,b){this.elements[this.elements.length-1].format.push({name:b,isSingle:!0,elemType:a})};
OV.PlyHeader.prototype.AddListFormat=function(a,b,c){this.elements[this.elements.length-1].format.push({name:c,isSingle:!1,countType:a,elemType:b})};OV.PlyHeader.prototype.GetElement=function(a){for(var b=0;b<this.elements.length;b++){var c=this.elements[b];if(c.name===a)return c}return null};
OV.PlyHeader.prototype.Check=function(){var a=this.GetElement("vertex");if(null===a||0===a.length||3>a.format.length)return OV.PlyHeaderCheckResult.NoVertices;a=this.GetElement("face");if("ascii"===this.format){if(null===a||0===a.count||0>a.format.length)return OV.PlyHeaderCheckResult.NoFaces}else if("binary_little_endian"===this.format||"binary_big_endian"===this.format){var b=this.GetElement("tristrips");b=null!==b&&0<b.count&&0<b.format.length;if(!(null!==a&&0<a.count&&0<a.format.length||b))return OV.PlyHeaderCheckResult.NoFaces}else return OV.PlyHeaderCheckResult.UnknownError;
return OV.PlyHeaderCheckResult.Ok};OV.PlyMaterialHandler=function(a){this.model=a;this.vertexColors=[];this.colorToMaterial={}};OV.PlyMaterialHandler.prototype.AddVertexColor=function(a){this.vertexColors.push(a)};OV.PlyMaterialHandler.prototype.GetTriangleColor=function(a,b,c){var d=this.vertexColors.length;return a>=d||b>=d||c>=d?null:this.vertexColors[a]};OV.PlyMaterialHandler.prototype.GetTriangleFaceMaterialIndex=function(a){return this.GetMaterialIndexByColor(a)};
OV.PlyMaterialHandler.prototype.GetTriangleVertexMaterialIndex=function(a,b,c){a=this.GetTriangleColor(a,b,c);return null===a?null:this.GetMaterialIndexByColor(a)};
OV.PlyMaterialHandler.prototype.GetMaterialIndexByColor=function(a){var b="Color "+OV.IntegerToHexString(a[0])+OV.IntegerToHexString(a[1])+OV.IntegerToHexString(a[2])+OV.IntegerToHexString(a[3]),c=this.colorToMaterial[b];void 0===c&&(c=new OV.Material(OV.MaterialType.Phong),c.name=b,c.color=new OV.Color(a[0],a[1],a[2]),c.opacity=a[3]/255,OV.UpdateMaterialTransparency(c),c=this.model.AddMaterial(c),this.colorToMaterial[b]=c);return c};OV.ImporterPly=function(){OV.ImporterBase.call(this)};
$jscomp.inherits(OV.ImporterPly,OV.ImporterBase);OV.ImporterPly.prototype.CanImportExtension=function(a){return"ply"===a};OV.ImporterPly.prototype.GetUpDirection=function(){return OV.Direction.Y};OV.ImporterPly.prototype.ClearContent=function(){this.mesh=null};OV.ImporterPly.prototype.ResetContent=function(){this.mesh=new OV.Mesh;this.model.AddMeshToRootNode(this.mesh)};
OV.ImporterPly.prototype.ImportContent=function(a,b){var c=this.GetHeaderContent(a),d=this.ReadHeader(c),e=d.Check();e===OV.PlyHeaderCheckResult.Ok?"ascii"===d.format?(a=OV.ArrayBufferToUtf8String(a),a=a.substr(c.length),this.ReadAsciiContent(d,a)):"binary_little_endian"!==d.format&&"binary_big_endian"!==d.format||this.ReadBinaryContent(d,a,c.length):e===OV.PlyHeaderCheckResult.NoVertices?this.SetError("The model contains no vertices."):e===OV.PlyHeaderCheckResult.NoFaces?this.SetError("The model contains no faces."):
this.SetError("Invalid header information.");b()};OV.ImporterPly.prototype.GetHeaderContent=function(a){var b="",c=new Uint8Array(a),d;for(d=0;d<a.byteLength&&(b+=String.fromCharCode(c[d]),!b.endsWith("end_header"));d++);for(d+=1;d<a.byteLength;){var e=String.fromCharCode(c[d]);b+=e;d+=1;if("\n"===e)break}return b};
OV.ImporterPly.prototype.ReadHeader=function(a){var b=new OV.PlyHeader;OV.ReadLines(a,function(c){c=OV.ParametersFromLine(c,null);0!==c.length&&"comment"!==c[0]&&"ply"!==c[0]&&("format"===c[0]&&2<=c.length?b.SetFormat(c[1]):"element"===c[0]&&3<=c.length?b.AddElement(c[1],parseInt(c[2],10)):"property"===c[0]&&3<=c.length&&("list"===c[1]&&5<=c.length?b.AddListFormat(c[2],c[3],c[4]):b.AddSingleFormat(c[1],c[2])))});return b};
OV.ImporterPly.prototype.ReadAsciiContent=function(a,b){var c=this,d=a.GetElement("vertex"),e=a.GetElement("face"),g=0,f=0;OV.ReadLines(b,function(h){if(!c.WasError()&&(h=OV.ParametersFromLine(h,null),0!==h.length&&"comment"!==h[0]))if(g<d.count)3<=h.length&&(c.mesh.AddVertex(new OV.Coord3D(parseFloat(h[0]),parseFloat(h[1]),parseFloat(h[2]))),g+=1);else if(f<e.count&&4<=h.length){var k=parseInt(h[0],10);if(!(h.length<k+1)){for(var l=0;l<k-2;l++){var m=parseInt(h[1]),n=parseInt(h[l+2]),p=parseInt(h[l+
3]);m=new OV.Triangle(m,n,p);c.mesh.AddTriangle(m)}f+=1}}})};
OV.ImporterPly.prototype.ReadBinaryContent=function(a,b,c){function d(u,q){function w(z,B){return"char"===B||"int8"===B?z.ReadCharacter8():"uchar"===B||"uint8"===B?z.ReadUnsignedCharacter8():"short"===B||"int16"===B?z.ReadInteger16():"ushort"===B||"uint16"===B?z.ReadUnsignedInteger16():"int"===B||"int32"===B?z.ReadInteger32():"uint"===B||"uint32"===B?z.ReadUnsignedInteger32():"float"===B||"float32"===B?z.ReadFloat32():"double"===B||"double64"===B?z.ReadDouble64():null}if(q.isSingle)return w(u,q.elemType);
for(var x=[],C=w(u,q.countType),y=0;y<C;y++)x.push(w(u,q.elemType));return x}function e(u,q,w){for(;w<q.length;w++)d(u,q[w])}function g(u,q,w){for(var x=null,C=null,y=null,z=255;w<q.length;w++){var B=q[w],A=d(u,B);"red"===B.name?x=A:"green"===B.name?C=A:"blue"===B.name?y=A:"alpha"===B.name&&(z=A)}return null!==x&&null!==C&&null!==y?[x,C,y,z]:null}var f=null;if("binary_little_endian"===a.format)f=new OV.BinaryReader(b,!0);else if("binary_big_endian"===a.format)f=new OV.BinaryReader(b,!1);else return;
f.Skip(c);b=new OV.PlyMaterialHandler(this.model);a=a.GetElements();for(c=0;c<a.length;c++){var h=a[c];if("vertex"===h.name)for(var k=0;k<h.count;k++){var l=d(f,h.format[0]),m=d(f,h.format[1]),n=d(f,h.format[2]),p=g(f,h.format,3);null!==p&&b.AddVertexColor(p);this.mesh.AddVertex(new OV.Coord3D(l,m,n))}else if("face"===h.name)for(k=0;k<h.count;k++)for(l=d(f,h.format[0]),m=g(f,h.format,1),n=0;n<l.length-2;n++){p=l[0];var r=l[n+1],t=l[n+2],v=new OV.Triangle(p,r,t);v.mat=null!==m?b.GetTriangleFaceMaterialIndex(m):
b.GetTriangleVertexMaterialIndex(p,r,t);this.mesh.AddTriangle(v)}else if("tristrips"===h.name)for(k=0;k<h.count;k++)for(l=d(f,h.format[0]),e(f,h.format,1),m=!0,n=0;n<l.length-2;n++)p=l[n],r=l[n+1],t=l[n+2],-1===t?(n+=2,m=!0):(m||(v=r,r=t,t=v),m=!m,p=new OV.Triangle(p,r,t),this.mesh.AddTriangle(p));else e(f,h.format,0)}};OV.CHUNK3DS={MAIN3DS:19789,EDIT3DS:15677,EDIT_MATERIAL:45055,MAT_NAME:40960,MAT_AMBIENT:40976,MAT_DIFFUSE:40992,MAT_SPECULAR:41008,MAT_SHININESS:41024,MAT_SHININESS_STRENGTH:41025,MAT_TRANSPARENCY:41040,MAT_COLOR_F:16,MAT_COLOR:17,MAT_LIN_COLOR:18,MAT_LIN_COLOR_F:19,MAT_TEXMAP:41472,MAT_TEXMAP_NAME:41728,MAT_TEXMAP_UOFFSET:41816,MAT_TEXMAP_VOFFSET:41818,MAT_TEXMAP_USCALE:41812,MAT_TEXMAP_VSCALE:41814,MAT_TEXMAP_ROTATION:41820,PERCENTAGE:48,PERCENTAGE_F:49,EDIT_OBJECT:16384,OBJ_TRIMESH:16640,OBJ_LIGHT:17920,
OBJ_CAMERA:18176,TRI_VERTEX:16656,TRI_TEXVERTEX:16704,TRI_FACE:16672,TRI_TRANSFORMATION:16736,TRI_MATERIAL:16688,TRI_SMOOTH:16720,KF3DS:45056,OBJECT_NODE:45058,OBJECT_HIERARCHY:45072,OBJECT_INSTANCE_NAME:45073,OBJECT_PIVOT:45075,OBJECT_POSITION:45088,OBJECT_ROTATION:45089,OBJECT_SCALE:45090,OBJECT_ID:45104};OV.Importer3dsNode=function(){this.id=-1;this.name="";this.parentId=this.flags=-1;this.instanceName="";this.pivot=[0,0,0];this.positions=[];this.rotations=[];this.scales=[]};
OV.Importer3dsNodeList=function(){this.nodes=[];this.nodeIdToNode=new Map};OV.Importer3dsNodeList.prototype.IsEmpty=function(){return 0===this.nodes.length};OV.Importer3dsNodeList.prototype.AddNode=function(a){this.nodes.push(a);this.nodeIdToNode.set(a.nodeId,a)};OV.Importer3dsNodeList.prototype.GetNodes=function(){return this.nodes};OV.Importer3ds=function(){OV.ImporterBase.call(this)};$jscomp.inherits(OV.Importer3ds,OV.ImporterBase);
OV.Importer3ds.prototype.CanImportExtension=function(a){return"3ds"===a};OV.Importer3ds.prototype.GetUpDirection=function(){return OV.Direction.Z};OV.Importer3ds.prototype.ClearContent=function(){this.nodeList=this.meshNameToIndex=this.materialNameToIndex=null};OV.Importer3ds.prototype.ResetContent=function(){this.materialNameToIndex=new Map;this.meshNameToIndex=new Map;this.nodeList=new OV.Importer3dsNodeList};OV.Importer3ds.prototype.ImportContent=function(a,b){this.ProcessBinary(a);b()};
OV.Importer3ds.prototype.ProcessBinary=function(a){var b=this,c=new OV.BinaryReader(a,!0);a=c.GetByteLength();this.ReadChunks(c,a,function(d,e){d===OV.CHUNK3DS.MAIN3DS?b.ReadMainChunk(c,e):b.SkipChunk(c,e)})};OV.Importer3ds.prototype.ReadMainChunk=function(a,b){var c=this;b=this.GetChunkEnd(a,b);this.ReadChunks(a,b,function(d,e){d===OV.CHUNK3DS.EDIT3DS?c.ReadEditorChunk(a,e):d===OV.CHUNK3DS.KF3DS?c.ReadKeyFrameChunk(a,e):c.SkipChunk(a,e)});this.BuildNodeHierarchy()};
OV.Importer3ds.prototype.ReadEditorChunk=function(a,b){var c=this;b=this.GetChunkEnd(a,b);this.ReadChunks(a,b,function(d,e){d===OV.CHUNK3DS.EDIT_MATERIAL?c.ReadMaterialChunk(a,e):d===OV.CHUNK3DS.EDIT_OBJECT?c.ReadObjectChunk(a,e):c.SkipChunk(a,e)})};
OV.Importer3ds.prototype.ReadMaterialChunk=function(a,b){var c=this,d=new OV.Material(OV.MaterialType.Phong);b=this.GetChunkEnd(a,b);var e=null,g=null;this.ReadChunks(a,b,function(f,h){f===OV.CHUNK3DS.MAT_NAME?d.name=c.ReadName(a):f===OV.CHUNK3DS.MAT_AMBIENT?d.ambient=c.ReadColorChunk(a,h):f===OV.CHUNK3DS.MAT_DIFFUSE?d.color=c.ReadColorChunk(a,h):f===OV.CHUNK3DS.MAT_SPECULAR?d.specular=c.ReadColorChunk(a,h):f===OV.CHUNK3DS.MAT_SHININESS?e=c.ReadPercentageChunk(a,h):f===OV.CHUNK3DS.MAT_SHININESS_STRENGTH?
g=c.ReadPercentageChunk(a,h):f===OV.CHUNK3DS.MAT_TRANSPARENCY?(d.opacity=1-c.ReadPercentageChunk(a,h),OV.UpdateMaterialTransparency(d)):f===OV.CHUNK3DS.MAT_TEXMAP?(d.diffuseMap=c.ReadTextureMapChunk(a,h),OV.UpdateMaterialTransparency(d)):c.SkipChunk(a,h)});null!==e&&null!==g&&(d.shininess=e*g/10);b=this.model.AddMaterial(d);this.materialNameToIndex.set(d.name,b)};
OV.Importer3ds.prototype.ReadTextureMapChunk=function(a,b){var c=this,d=new OV.TextureMap;b=this.GetChunkEnd(a,b);this.ReadChunks(a,b,function(e,g){e===OV.CHUNK3DS.MAT_TEXMAP_NAME?(e=c.ReadName(a),g=c.callbacks.getTextureBuffer(e),d.name=e,null!==g&&(d.url=g.url,d.buffer=g.buffer)):e===OV.CHUNK3DS.MAT_TEXMAP_UOFFSET?d.offset.x=a.ReadFloat32():e===OV.CHUNK3DS.MAT_TEXMAP_VOFFSET?d.offset.y=a.ReadFloat32():e===OV.CHUNK3DS.MAT_TEXMAP_USCALE?d.scale.x=a.ReadFloat32():e===OV.CHUNK3DS.MAT_TEXMAP_VSCALE?
d.scale.y=a.ReadFloat32():e===OV.CHUNK3DS.MAT_TEXMAP_ROTATION?d.rotation=a.ReadFloat32()*OV.DegRad:c.SkipChunk(a,g)});return d};
OV.Importer3ds.prototype.ReadColorChunk=function(a,b){var c=this,d=new OV.Color(0,0,0);b=this.GetChunkEnd(a,b);var e=!1;this.ReadChunks(a,b,function(g,f){g===OV.CHUNK3DS.MAT_COLOR?e||(d.r=a.ReadUnsignedCharacter8(),d.g=a.ReadUnsignedCharacter8(),d.b=a.ReadUnsignedCharacter8()):g===OV.CHUNK3DS.MAT_LIN_COLOR?(d.r=a.ReadUnsignedCharacter8(),d.g=a.ReadUnsignedCharacter8(),d.b=a.ReadUnsignedCharacter8(),e=!0):g===OV.CHUNK3DS.MAT_COLOR_F?e||(d.r=parseInt(255*a.ReadFloat32(),10),d.g=parseInt(255*a.ReadFloat32(),
10),d.b=parseInt(255*a.ReadFloat32(),10)):g===OV.CHUNK3DS.MAT_LIN_COLOR_F?(d.r=parseInt(255*a.ReadFloat32(),10),d.g=parseInt(255*a.ReadFloat32(),10),d.b=parseInt(255*a.ReadFloat32(),10),e=!0):c.SkipChunk(a,f)});return d};OV.Importer3ds.prototype.ReadPercentageChunk=function(a,b){var c=this,d=0;b=this.GetChunkEnd(a,b);this.ReadChunks(a,b,function(e,g){e===OV.CHUNK3DS.PERCENTAGE?d=a.ReadUnsignedInteger16()/100:e===OV.CHUNK3DS.PERCENTAGE_F?d=a.ReadFloat32():c.SkipChunk(a,g)});return d};
OV.Importer3ds.prototype.ReadObjectChunk=function(a,b){var c=this;b=this.GetChunkEnd(a,b);var d=this.ReadName(a);this.ReadChunks(a,b,function(e,g){e===OV.CHUNK3DS.OBJ_TRIMESH?c.ReadMeshChunk(a,g,d):c.SkipChunk(a,g)})};
OV.Importer3ds.prototype.ReadMeshChunk=function(a,b,c){var d=this,e=new OV.Mesh;e.SetName(c);b=this.GetChunkEnd(a,b);var g=null;this.ReadChunks(a,b,function(f,h){f===OV.CHUNK3DS.TRI_VERTEX?d.ReadVerticesChunk(e,a):f===OV.CHUNK3DS.TRI_TEXVERTEX?d.ReadTextureVerticesChunk(e,a):f===OV.CHUNK3DS.TRI_FACE?d.ReadFacesChunk(e,a,h):f===OV.CHUNK3DS.TRI_TRANSFORMATION?g=d.ReadTransformationChunk(a):d.SkipChunk(a,h)});if(e.VertexCount()===e.TextureUVCount())for(b=0;b<e.TriangleCount();b++)c=e.GetTriangle(b),
c.SetTextureUVs(c.v0,c.v1,c.v2);b=new OV.Matrix(g);(function(f,h){if(h.IsValid()){var k=h.Determinant();(k=OV.IsNegative(k))&&(h=(new OV.Matrix).CreateScale(-1,1,1).MultiplyMatrix(h));h=h.Invert();null!==h&&(h=new OV.Transformation(h),OV.TransformMesh(f,h),k&&OV.FlipMeshTrianglesOrientation(f))}})(e,b);b=this.model.AddMesh(e);this.meshNameToIndex.set(e.GetName(),b)};
OV.Importer3ds.prototype.ReadVerticesChunk=function(a,b){for(var c=b.ReadUnsignedInteger16(),d=0;d<c;d++){var e=b.ReadFloat32(),g=b.ReadFloat32(),f=b.ReadFloat32();a.AddVertex(new OV.Coord3D(e,g,f))}};OV.Importer3ds.prototype.ReadTextureVerticesChunk=function(a,b){for(var c=b.ReadUnsignedInteger16(),d=0;d<c;d++){var e=b.ReadFloat32(),g=b.ReadFloat32();a.AddTextureUV(new OV.Coord2D(e,g))}};
OV.Importer3ds.prototype.ReadFacesChunk=function(a,b,c){var d=this;c=this.GetChunkEnd(b,c);for(var e=b.ReadUnsignedInteger16(),g=0;g<e;g++){var f=b.ReadUnsignedInteger16(),h=b.ReadUnsignedInteger16(),k=b.ReadUnsignedInteger16();b.ReadUnsignedInteger16();a.AddTriangle(new OV.Triangle(f,h,k))}this.ReadChunks(b,c,function(l,m){l===OV.CHUNK3DS.TRI_MATERIAL?d.ReadFaceMaterialsChunk(a,b):l===OV.CHUNK3DS.TRI_SMOOTH?d.ReadFaceSmoothingGroupsChunk(a,e,b):d.SkipChunk(b,m)})};
OV.Importer3ds.prototype.ReadFaceMaterialsChunk=function(a,b){var c=this.ReadName(b);c=this.materialNameToIndex.get(c);for(var d=b.ReadUnsignedInteger16(),e=0;e<d;e++){var g=b.ReadUnsignedInteger16();g=a.GetTriangle(g);void 0!==c&&(g.mat=c)}};OV.Importer3ds.prototype.ReadFaceSmoothingGroupsChunk=function(a,b,c){for(var d=0;d<b;d++){var e=c.ReadUnsignedInteger32();a.GetTriangle(d).curve=e}};
OV.Importer3ds.prototype.ReadTransformationChunk=function(a){for(var b=[],c=0;4>c;c++){for(var d=0;3>d;d++)b.push(a.ReadFloat32());3>c?b.push(0):b.push(1)}return b};OV.Importer3ds.prototype.ReadKeyFrameChunk=function(a,b){var c=this;b=this.GetChunkEnd(a,b);this.ReadChunks(a,b,function(d,e){d===OV.CHUNK3DS.OBJECT_NODE?c.ReadObjectNodeChunk(a,e):c.SkipChunk(a,e)})};
OV.Importer3ds.prototype.BuildNodeHierarchy=function(){var a=this.model.GetRootNode();if(this.nodeList.IsEmpty())for(var b=0;b<this.model.MeshCount();b++)a.AddMeshIndex(b);else{b=new Map;for(var c=$jscomp.makeIterator(this.nodeList.GetNodes()),d=c.next();!d.done;d=c.next()){d=d.value;var e=new OV.Node;0<d.name.length&&"$$$DUMMY"!==d.name&&(e.SetName(d.name),0<d.instanceName.length&&e.SetName(e.GetName()+" "+d.instanceName));65535!==d.parentId&&b.has(d.parentId)?b.get(d.parentId).AddChildNode(e):a.AddChildNode(e);
b.set(d.id,e);var g=this.meshNameToIndex.has(d.name),f=e,h=f.SetTransformation,k,l=d,m=g,n=k=new OV.Matrix,p=n.ComposeTRS;var r=OV;var t=r.ArrayToCoord3D;var v=0===l.positions.length?[0,0,0]:l.positions[0];v=t.call(r,v);r=OV;t=r.ArrayToQuaternion;if(0===l.rotations.length)var u=[0,0,0,1];else{u=l.rotations[0];var q=[0,0,0,1],w=Math.sqrt(u[0]*u[0]+u[1]*u[1]+u[2]*u[2]);0<w&&(q=-.5*u[3],w=Math.sin(q)/w,q=[w*u[0],w*u[1],w*u[2],Math.cos(q)]);u=q}t=t.call(r,u);u=OV;w=u.ArrayToCoord3D;r=0===l.scales.length?
[1,1,1]:l.scales[0];p.call(n,v,t,w.call(u,r));m&&(l=l.pivot,k=(new OV.Matrix).CreateTranslation(-l[0],-l[1],-l[2]).MultiplyMatrix(k));k=new OV.Transformation(k);h.call(f,k);g&&(e.SetType(OV.NodeType.MeshNode),e.AddMeshIndex(this.meshNameToIndex.get(d.name)))}}};
OV.Importer3ds.prototype.ReadObjectNodeChunk=function(a,b){function c(g,f,h){var k=[];f.Skip(10);for(var l=f.ReadInteger32(),m=0;m<l;m++){f.ReadInteger32();0!==f.ReadUnsignedInteger16()&&f.ReadFloat32();if(h===OV.CHUNK3DS.OBJECT_ROTATION){var n=f.ReadFloat32();var p=g.ReadVector(f);p[3]=n}else p=g.ReadVector(f);k.push(p)}return k}var d=this,e=new OV.Importer3dsNode;b=this.GetChunkEnd(a,b);this.ReadChunks(a,b,function(g,f){g===OV.CHUNK3DS.OBJECT_HIERARCHY?(e.name=d.ReadName(a),e.flags=a.ReadUnsignedInteger32(),
e.parentId=a.ReadUnsignedInteger16()):g===OV.CHUNK3DS.OBJECT_INSTANCE_NAME?e.instanceName=d.ReadName(a):g===OV.CHUNK3DS.OBJECT_PIVOT?e.pivot=d.ReadVector(a):g===OV.CHUNK3DS.OBJECT_POSITION?e.positions=c(d,a,OV.CHUNK3DS.OBJECT_POSITION):g===OV.CHUNK3DS.OBJECT_ROTATION?e.rotations=c(d,a,OV.CHUNK3DS.OBJECT_ROTATION):g===OV.CHUNK3DS.OBJECT_SCALE?e.scales=c(d,a,OV.CHUNK3DS.OBJECT_SCALE):g===OV.CHUNK3DS.OBJECT_ID?e.id=a.ReadUnsignedInteger16():d.SkipChunk(a,f)});this.nodeList.AddNode(e)};
OV.Importer3ds.prototype.ReadName=function(a){for(var b="",c,d=0;64>d;){c=a.ReadCharacter8();if(0===c)break;b+=String.fromCharCode(c);d+=1}return b};OV.Importer3ds.prototype.ReadVector=function(a){return[a.ReadFloat32(),a.ReadFloat32(),a.ReadFloat32()]};OV.Importer3ds.prototype.ReadChunks=function(a,b,c){for(;a.GetPosition()<=b-6;){var d=a.ReadUnsignedInteger16(),e=a.ReadUnsignedInteger32();c(d,e)}};OV.Importer3ds.prototype.GetChunkEnd=function(a,b){return a.GetPosition()+b-6};
OV.Importer3ds.prototype.SkipChunk=function(a,b){a.Skip(b-6)};OV.GltfComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};OV.GltfDataType={SCALAR:0,VEC2:1,VEC3:2,VEC4:3,MAT2:4,MAT3:5,MAT4:6};OV.GltfRenderMode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};OV.GltfConstants={GLTF_STRING:1179937895,JSON_CHUNK_TYPE:1313821514,BINARY_CHUNK_TYPE:5130562};
OV.GltfBufferReader=function(a){this.reader=new OV.BinaryReader(a,!0);this.sparseReader=this.dataCount=this.byteStride=this.dataType=this.componentType=null};OV.GltfBufferReader.prototype.SetComponentType=function(a){this.componentType=a};
OV.GltfBufferReader.prototype.SetDataType=function(a){"SCALAR"===a?this.dataType=OV.GltfDataType.SCALAR:"VEC2"===a?this.dataType=OV.GltfDataType.VEC2:"VEC3"===a?this.dataType=OV.GltfDataType.VEC3:"VEC4"===a?this.dataType=OV.GltfDataType.VEC4:"MAT2"===a?this.dataType=OV.GltfDataType.MAT2:"MAT3"===a?this.dataType=OV.GltfDataType.MAT3:"MAT4"===a&&(this.dataType=OV.GltfDataType.MAT4)};OV.GltfBufferReader.prototype.SetByteStride=function(a){this.byteStride=a};
OV.GltfBufferReader.prototype.SetDataCount=function(a){this.dataCount=a};OV.GltfBufferReader.prototype.SetSparseReader=function(a,b){this.sparseReader={indexReader:a,valueReader:b}};OV.GltfBufferReader.prototype.ReadArrayBuffer=function(a){return this.reader.ReadArrayBuffer(a)};OV.GltfBufferReader.prototype.GetDataCount=function(){return this.dataCount};
OV.GltfBufferReader.prototype.ReadData=function(){if(null===this.dataType)return null;if(this.dataType===OV.GltfDataType.SCALAR){var a=this.ReadComponent();this.SkipBytesByStride(1);return a}if(this.dataType===OV.GltfDataType.VEC2){a=this.ReadComponent();var b=this.ReadComponent();this.SkipBytesByStride(2);return new OV.Coord2D(a,b)}if(this.dataType===OV.GltfDataType.VEC3){a=this.ReadComponent();b=this.ReadComponent();var c=this.ReadComponent();this.SkipBytesByStride(3);return new OV.Coord3D(a,b,
c)}return null};OV.GltfBufferReader.prototype.EnumerateData=function(a){if(null===this.sparseReader)for(var b=0;b<this.dataCount;b++)a(this.ReadData());else{b=[];for(var c=0;c<this.sparseReader.indexReader.GetDataCount();c++){var d=this.sparseReader.indexReader.ReadData(),e=this.sparseReader.valueReader.ReadData();b.push({index:d,value:e})}for(d=c=0;d<this.dataCount;d++)e=this.ReadData(),c<b.length&&b[c].index===d?(a(b[c].value),c+=1):a(e)}};OV.GltfBufferReader.prototype.SkipBytes=function(a){this.reader.Skip(a)};
OV.GltfBufferReader.prototype.ReadComponent=function(){return null===this.componentType?null:this.componentType===OV.GltfComponentType.BYTE?this.reader.ReadCharacter8():this.componentType===OV.GltfComponentType.UNSIGNED_BYTE?this.reader.ReadUnsignedCharacter8():this.componentType===OV.GltfComponentType.SHORT?this.reader.ReadInteger16():this.componentType===OV.GltfComponentType.UNSIGNED_SHORT?this.reader.ReadUnsignedInteger16():this.componentType===OV.GltfComponentType.UNSIGNED_INT?this.reader.ReadInteger32():
this.componentType===OV.GltfComponentType.FLOAT?this.reader.ReadFloat32():null};OV.GltfBufferReader.prototype.SkipBytesByStride=function(a){null!==this.byteStride&&(a*=this.GetComponentSize(),this.reader.Skip(this.byteStride-a))};
OV.GltfBufferReader.prototype.GetComponentSize=function(){return this.componentType===OV.GltfComponentType.BYTE||this.componentType===OV.GltfComponentType.UNSIGNED_BYTE?1:this.componentType===OV.GltfComponentType.SHORT||this.componentType===OV.GltfComponentType.UNSIGNED_SHORT?2:this.componentType===OV.GltfComponentType.UNSIGNED_INT||this.componentType===OV.GltfComponentType.FLOAT?4:0};
OV.GltfExtensions=function(){this.supportedExtensions=["KHR_draco_mesh_compression","KHR_materials_pbrSpecularGlossiness","KHR_texture_transform"];this.draco=null};OV.GltfExtensions.prototype.LoadLibraries=function(a,b){var c=this;if(void 0===a)b.onSuccess();else if(null===this.draco&&-1!==a.indexOf("KHR_draco_mesh_compression"))OV.LoadExternalLibrary("loaders/draco_decoder.js").then(function(){DracoDecoderModule().then(function(d){c.draco=d;b.onSuccess()})}).catch(function(){b.onError()});else b.onSuccess()};
OV.GltfExtensions.prototype.GetUnsupportedExtensions=function(a){var b=[];if(void 0===a)return b;for(var c=0;c<a.length;c++){var d=a[c];-1===this.supportedExtensions.indexOf(d)&&b.push(d)}return b};
OV.GltfExtensions.prototype.ProcessMaterial=function(a,b,c){function d(g){return parseInt(Math.round(255*OV.LinearToSRGB(g)),10)}if(void 0!==a.extensions&&(a=a.extensions.KHR_materials_pbrSpecularGlossiness,void 0!==a)){b.type=OV.MaterialType.Phong;var e=a.diffuseFactor;void 0!==e&&(b.color=new OV.Color(d(e[0]),d(e[1]),d(e[2])),b.opacity=e[3]);e=a.diffuseTexture;void 0!==e&&(b.diffuseMap=c(e));e=a.specularFactor;void 0!==e&&(b.specular=new OV.Color(d(e[0]),d(e[1]),d(e[2])));e=a.specularGlossinessTexture;
void 0!==e&&(b.specularMap=c(e));c=a.glossinessFactor;void 0!==c&&(b.shininess=c)}};OV.GltfExtensions.prototype.ProcessTexture=function(a,b){void 0!==a.extensions&&(a=a.extensions.KHR_texture_transform,void 0!==a&&(void 0!==a.offset&&(b.offset.x=a.offset[0],b.offset.y=-a.offset[1]),void 0!==a.scale&&(b.scale.x=a.scale[0],b.scale.y=a.scale[1]),void 0!==a.rotation&&(b.rotation=-a.rotation)))};
OV.GltfExtensions.prototype.ProcessPrimitive=function(a,b,c,d){function e(t,v,u,q,w){var x=v.GetAttributeByUniqueId(u,q),C=x.num_components(),y=u.num_points()*C,z=4*y;q=t._malloc(z);v.GetAttributeDataArrayForAllPoints(u,x,t.DT_FLOAT32,z,q);v=(new Float32Array(t.HEAPF32.buffer,q,y)).slice();if(2===C)for(u=0;u<v.length;u+=2)w(new OV.Coord2D(v[u+0],v[u+1]));else if(3===C)for(u=0;u<v.length;u+=3)w(new OV.Coord3D(v[u+0],v[u+1],v[u+2]));t._free(q)}if(null===this.draco||void 0===c.extensions||void 0===c.extensions.KHR_draco_mesh_compression)return!1;
var g=new this.draco.Decoder,f=new this.draco.DecoderBuffer,h=c.extensions.KHR_draco_mesh_compression;b=b.bufferViews[h.bufferView];b=a.GetReaderFromBufferView(b).ReadArrayBuffer(b.byteLength);f.Init(new Int8Array(b),b.byteLength);if(g.GetEncodedGeometryType(f)!==this.draco.TRIANGULAR_MESH)return!0;var k=new this.draco.Mesh;if(!g.DecodeBufferToMesh(f,k).ok())return!0;f=void 0!==h.attributes.NORMAL;b=void 0!==h.attributes.TEXCOORD_0;if(void 0===h.attributes.POSITION)return!0;var l=d.VertexCount(),
m=d.NormalCount(),n=d.TextureUVCount();e(this.draco,g,k,h.attributes.POSITION,function(t){d.AddVertex(t)});f&&e(this.draco,g,k,h.attributes.NORMAL,function(t){d.AddNormal(t)});b&&e(this.draco,g,k,h.attributes.TEXCOORD_0,function(t){t.y=-t.y;d.AddTextureUV(t)});var p=3*k.num_faces(),r=4*p;h=this.draco._malloc(r);g.GetTrianglesUInt32Array(k,r,h);g=(new Uint32Array(this.draco.HEAPU32.buffer,h,p)).slice();for(k=0;k<g.length;k+=3)a.AddTriangle(c,d,g[k],g[k+1],g[k+2],f,b,l,m,n);this.draco._free(h);return!0};
OV.ImporterGltf=function(){OV.ImporterBase.call(this);this.gltfExtensions=new OV.GltfExtensions};$jscomp.inherits(OV.ImporterGltf,OV.ImporterBase);OV.ImporterGltf.prototype.CanImportExtension=function(a){return"gltf"===a||"glb"===a};OV.ImporterGltf.prototype.GetUpDirection=function(){return OV.Direction.Y};OV.ImporterGltf.prototype.ClearContent=function(){this.imageIndexToTextureParams=this.bufferContents=null};
OV.ImporterGltf.prototype.ResetContent=function(){this.bufferContents=[];this.imageIndexToTextureParams={}};OV.ImporterGltf.prototype.ImportContent=function(a,b){"gltf"===this.extension?this.ProcessGltf(a,b):"glb"===this.extension&&this.ProcessBinaryGltf(a,b)};
OV.ImporterGltf.prototype.ProcessGltf=function(a,b){a=OV.ArrayBufferToUtf8String(a);a=JSON.parse(a);if("2.0"!==a.asset.version)this.SetError("Invalid glTF version."),b();else{for(var c=0;c<a.buffers.length;c++){var d=null,e=a.buffers[c],g=OV.Base64DataURIToArrayBuffer(e.uri);null!==g?d=g.buffer:(e=this.callbacks.getFileBuffer(e.uri),null!==e&&(d=e));if(null===d){this.SetError("One  of the requested buffers is missing.");b();return}this.bufferContents.push(d)}this.ProcessMainFile(a,b)}};
OV.ImporterGltf.prototype.ProcessBinaryGltf=function(a,b){a=new OV.BinaryReader(a,!0);if(a.ReadUnsignedInteger32()!==OV.GltfConstants.GLTF_STRING)this.SetError("Invalid glTF file."),b();else if(2!==a.ReadUnsignedInteger32())this.SetError("Invalid glTF version."),b();else if(a.ReadUnsignedInteger32()!==a.GetByteLength())this.SetError("Invalid glTF file."),b();else{for(var c=null;!a.End();){var d=a;var e=d.ReadUnsignedInteger32();var g=d.ReadUnsignedInteger32();d=d.ReadArrayBuffer(e);g===OV.GltfConstants.JSON_CHUNK_TYPE?
c=OV.ArrayBufferToUtf8String(d):g===OV.GltfConstants.BINARY_CHUNK_TYPE&&this.bufferContents.push(d)}null!==c&&(a=JSON.parse(c),this.ProcessMainFile(a,b))}};
OV.ImporterGltf.prototype.ProcessMainFile=function(a,b){var c=this,d=this.gltfExtensions.GetUnsupportedExtensions(a.extensionsRequired);0<d.length?(this.SetError("Unsupported extension: "+d.join(", ")+"."),b()):this.gltfExtensions.LoadLibraries(a.extensionsRequired,{onSuccess:function(){c.ImportModel(a);b()},onError:function(){c.SetError("Failed to load draco decoder.");b()}})};
OV.ImporterGltf.prototype.ImportModel=function(a){var b=a.materials;if(void 0!==b){b=$jscomp.makeIterator(b);for(var c=b.next();!c.done;c=b.next())this.ImportMaterial(a,c.value)}b=a.meshes;if(void 0!==b)for(b=$jscomp.makeIterator(b),c=b.next();!c.done;c=b.next())this.ImportMesh(a,c.value);this.ImportNodes(a);this.ImportModelProperties(a)};
OV.ImporterGltf.prototype.ImportModelProperties=function(a){function b(c,d,e){d=new OV.PropertyGroup(d);for(var g in e)if(Object.prototype.hasOwnProperty.call(e,g)&&"string"===typeof e[g]){var f=new OV.Property(OV.PropertyType.Text,g,e[g]);d.AddProperty(f)}0<d.PropertyCount()&&c.AddPropertyGroup(d);return d}b(this.model,"Asset properties",a.asset);a.asset.extras&&b(this.model,"Extras",a.asset.extras)};
OV.ImporterGltf.prototype.GetDefaultScene=function(a){var b=a.scene||0;return b>=a.scenes.length?null:a.scenes[b]};
OV.ImporterGltf.prototype.ImportMaterial=function(a,b){function c(f){return parseInt(Math.round(255*OV.LinearToSRGB(f)),10)}var d=this,e=new OV.Material(OV.MaterialType.Physical);void 0!==b.name&&(e.name=b.name);e.color=new OV.Color(c(1),c(1),c(1));if(void 0!==b.pbrMetallicRoughness){var g=b.pbrMetallicRoughness.baseColorFactor;void 0!==g&&(e.color=new OV.Color(c(g[0]),c(g[1]),c(g[2])),e.opacity=g[3]);g=b.pbrMetallicRoughness.metallicFactor;void 0!==g&&(e.metalness=g);g=b.pbrMetallicRoughness.roughnessFactor;
void 0!==g&&(e.roughness=g);g=b.emissiveFactor;void 0!==g&&(e.emissive=new OV.Color(c(g[0]),c(g[1]),c(g[2])));e.diffuseMap=this.ImportTexture(a,b.pbrMetallicRoughness.baseColorTexture);e.metalnessMap=this.ImportTexture(a,b.pbrMetallicRoughness.metallicRoughnessTexture);e.normalMap=this.ImportTexture(a,b.normalTexture);e.emissiveMap=this.ImportTexture(a,b.emissiveTexture);null!==e.diffuseMap&&(e.multiplyDiffuseMap=!0);g=b.alphaMode;void 0!==g&&("BLEND"===g?e.transparent=!0:"MASK"===g&&(e.transparent=
!0,e.alphaTest=b.alphaCutoff||.5))}this.gltfExtensions.ProcessMaterial(b,e,function(f){return d.ImportTexture(a,f)});this.model.AddMaterial(e)};
OV.ImporterGltf.prototype.ImportTexture=function(a,b){if(void 0===b||null===b)return null;var c=new OV.TextureMap,d=a.textures[b.index].source,e=a.images[d],g=this.imageIndexToTextureParams[d];if(void 0===g){g={name:null,url:null,buffer:null};var f=d.toString();if(void 0!==e.uri)a=OV.Base64DataURIToArrayBuffer(e.uri),null!==a?(g.name="Embedded_"+f+"."+OV.GetFileExtensionFromMimeType(a.mimeType),g.url=OV.CreateObjectUrlWithMimeType(a.buffer,a.mimeType),g.buffer=a.buffer):(f=this.callbacks.getTextureBuffer(e.uri),
g.name=e.uri,null!==f&&(g.url=f.url,g.buffer=f.buffer));else if(void 0!==e.bufferView){a=a.bufferViews[e.bufferView];var h=this.GetReaderFromBufferView(a);null!==h&&(a=h.ReadArrayBuffer(a.byteLength),g.name="Binary_"+f+"."+OV.GetFileExtensionFromMimeType(e.mimeType),g.url=OV.CreateObjectUrlWithMimeType(a,e.mimeType),g.buffer=a)}this.imageIndexToTextureParams[d]=g}c.name=g.name;c.url=g.url;c.buffer=g.buffer;this.gltfExtensions.ProcessTexture(b,c);return c};
OV.ImporterGltf.prototype.ImportMesh=function(a,b){var c=new OV.Mesh;this.model.AddMesh(c);void 0!==b.name&&c.SetName(b.name);for(var d=0;d<b.primitives.length;d++)this.ImportPrimitive(a,b.primitives[d],c)};
OV.ImporterGltf.prototype.ImportPrimitive=function(a,b,c){if(!this.gltfExtensions.ProcessPrimitive(this,a,b,c)&&void 0!==b.attributes){var d=void 0!==b.attributes.POSITION,e=void 0!==b.attributes.NORMAL,g=void 0!==b.attributes.TEXCOORD_0,f=void 0!==b.indices,h=OV.GltfRenderMode.TRIANGLES;void 0!==b.mode&&(h=b.mode);if(h===OV.GltfRenderMode.TRIANGLES||h===OV.GltfRenderMode.TRIANGLE_STRIP||h===OV.GltfRenderMode.TRIANGLE_FAN){var k=c.VertexCount(),l=c.NormalCount(),m=c.TextureUVCount();if(d&&(d=this.GetReaderFromAccessor(a,
a.accessors[b.attributes.POSITION]),null!==d)){d.EnumerateData(function(r){c.AddVertex(r)});if(e){d=this.GetReaderFromAccessor(a,a.accessors[b.attributes.NORMAL]);if(null===d)return;d.EnumerateData(function(r){c.AddNormal(r)})}if(g){d=this.GetReaderFromAccessor(a,a.accessors[b.attributes.TEXCOORD_0]);if(null===d)return;d.EnumerateData(function(r){r.y=-r.y;c.AddTextureUV(r)})}var n=[];if(f){a=this.GetReaderFromAccessor(a,a.accessors[b.indices]);if(null===a)return;a.EnumerateData(function(r){n.push(r)})}else for(a=
0;a<c.VertexCount();a++)n.push(a);if(h===OV.GltfRenderMode.TRIANGLES)for(h=0;h<n.length;h+=3)this.AddTriangle(b,c,n[h],n[h+1],n[h+2],e,g,k,l,m);else if(h===OV.GltfRenderMode.TRIANGLE_STRIP)for(h=0;h<n.length-2;h++){a=n[h];f=n[h+1];d=n[h+2];if(1===h%2){var p=f;f=d;d=p}this.AddTriangle(b,c,a,f,d,e,g,k,l,m)}else if(h===OV.GltfRenderMode.TRIANGLE_FAN)for(h=1;h<n.length-1;h++)this.AddTriangle(b,c,n[0],n[h],n[h+1],e,g,k,l,m)}}}};
OV.ImporterGltf.prototype.AddTriangle=function(a,b,c,d,e,g,f,h,k,l){h=new OV.Triangle(h+c,h+d,h+e);g&&h.SetNormals(k+c,k+d,k+e);f&&h.SetTextureUVs(l+c,l+d,l+e);void 0!==a.material&&(h.mat=a.material);b.AddTriangle(h)};OV.ImporterGltf.prototype.ImportNodes=function(a){var b=this.GetDefaultScene(a);if(null!==b){var c=this.model.GetRootNode();b=$jscomp.makeIterator(b.nodes);for(var d=b.next();!d.done;d=b.next())this.ImportNode(a,a.nodes[d.value],c)}};
OV.ImporterGltf.prototype.ImportNode=function(a,b,c){if(void 0!==b.children||void 0!==b.mesh){var d=new OV.Node;void 0!==b.name&&d.SetName(b.name);var e=d.SetTransformation;var g=(new OV.Matrix).CreateIdentity();if(void 0!==b.matrix)g.Set(b.matrix);else{var f=[0,0,0],h=[0,0,0,1],k=[1,1,1];void 0!==b.translation&&(f=b.translation);void 0!==b.rotation&&(h=b.rotation);void 0!==b.scale&&(k=b.scale);g.ComposeTRS(OV.ArrayToCoord3D(f),OV.ArrayToQuaternion(h),OV.ArrayToCoord3D(k))}g=new OV.Transformation(g);
e.call(d,g);c.AddChildNode(d);if(void 0!==b.children)for(c=$jscomp.makeIterator(b.children),e=c.next();!e.done;e=c.next())this.ImportNode(a,a.nodes[e.value],d);void 0!==b.mesh&&(void 0!==b.children&&0!==b.children.length||d.SetType(OV.NodeType.MeshNode),d.AddMeshIndex(b.mesh))}};
OV.ImporterGltf.prototype.GetReaderFromBufferView=function(a){var b=this.bufferContents[a.buffer||0];if(void 0===b||null===b)return null;b=new OV.GltfBufferReader(b);b.SkipBytes(a.byteOffset||0);a=a.byteStride;void 0!==a&&0!==a&&b.SetByteStride(a);return b};
OV.ImporterGltf.prototype.GetReaderFromAccessor=function(a,b){var c=this.GetReaderFromBufferView(a.bufferViews[b.bufferView||0]);if(null===c)return null;c.SetComponentType(b.componentType);c.SetDataType(b.type);c.SetDataCount(b.count);c.SkipBytes(b.byteOffset||0);if(void 0!==b.sparse){var d=this.GetReaderFromSparseAccessor(a,b.sparse.indices,b.sparse.indices.componentType,"SCALAR",b.sparse.count);a=this.GetReaderFromSparseAccessor(a,b.sparse.values,b.componentType,b.type,b.sparse.count);null!==d&&
null!==a&&c.SetSparseReader(d,a)}return c};OV.ImporterGltf.prototype.GetReaderFromSparseAccessor=function(a,b,c,d,e){if(void 0===b.bufferView)return null;a=this.GetReaderFromBufferView(a.bufferViews[b.bufferView]);if(null===a)return null;a.SetComponentType(c);a.SetDataType(d);a.SetDataCount(e);a.SkipBytes(b.byteOffset||0);return a};OV.ImporterO3dv=function(){OV.ImporterBase.call(this)};$jscomp.inherits(OV.ImporterO3dv,OV.ImporterBase);OV.ImporterO3dv.prototype.CanImportExtension=function(a){return"o3dv"===a};OV.ImporterO3dv.prototype.GetUpDirection=function(){return OV.Direction.Z};OV.ImporterO3dv.prototype.ClearContent=function(){};OV.ImporterO3dv.prototype.ResetContent=function(){};
OV.ImporterO3dv.prototype.ImportContent=function(a,b){a=OV.ArrayBufferToUtf8String(a);a=JSON.parse(a);if(void 0!==a.root){if(void 0!==a.materials)for(var c=0;c<a.materials.length;c++)this.ImportMaterial(a.materials[c]);if(void 0!==a.meshes)for(c=0;c<a.meshes.length;c++)this.ImportMesh(a.meshes[c]);this.ImportNode(a,a.nodes[a.root],this.model.GetRootNode());this.ImportProperties(this.model,a)}b()};
OV.ImporterO3dv.prototype.ImportMaterial=function(a){var b=new OV.Material(OV.MaterialType.Physical);b.color.Set(255,255,255);void 0!==a.name&&(b.name=a.name);void 0!==a.color&&(b.color=OV.ArrayToColor(a.color));b.metalness=OV.ValueOrDefault(a.metalness,0);b.roughness=OV.ValueOrDefault(a.roughness,1);this.model.AddMaterial(b)};
OV.ImporterO3dv.prototype.ImportMesh=function(a){var b=new OV.GeneratorParams;void 0!==a.name&&b.SetName(a.name);void 0!==a.material&&b.SetMaterial(a.material);var c=a.parameters;if(void 0!==c){var d=null;if("cuboid"===a.type){if(void 0===c.size_x||void 0===c.size_y||void 0===c.size_z)return;d=OV.GenerateCuboid(b,c.size_x,c.size_y,c.size_z)}else if("cylinder"===a.type){if(void 0===c.radius||void 0===c.height)return;d=OV.ValueOrDefault(c.segments,25);var e=OV.ValueOrDefault(c.smooth,!0);d=OV.GenerateCylinder(b,
c.radius,c.height,d,e)}else if("sphere"===a.type){if(void 0===c.radius)return;d=OV.ValueOrDefault(c.segments,20);e=OV.ValueOrDefault(c.smooth,!0);d=OV.GenerateSphere(b,c.radius,d,e)}else if("platonic"===a.type){if(void 0===c.solid_type)return;d=OV.ValueOrDefault(c.radius,1);d=OV.GeneratePlatonicSolid(b,c.solid_type,d)}null!==d&&(this.ImportProperties(d,a),this.model.AddMesh(d))}};
OV.ImporterO3dv.prototype.ImportNode=function(a,b,c){void 0!==b.name&&c.SetName(b.name);if(void 0!==b.transformation){var d=this.GetTransformation(b.transformation);c.SetTransformation(d)}if(void 0!==b.children){d=$jscomp.makeIterator(b.children);for(var e=d.next();!e.done;e=d.next()){e=a.nodes[e.value];var g=new OV.Node;c.AddChildNode(g);this.ImportNode(a,e,g)}}void 0!==b.mesh&&(void 0!==b.children&&0!==b.children.length||c.SetType(OV.NodeType.MeshNode),c.AddMeshIndex(b.mesh))};
OV.ImporterO3dv.prototype.ImportProperties=function(a,b){if(void 0!==b.properties){var c=new OV.PropertyGroup("Properties");a.AddPropertyGroup(c);a=$jscomp.makeIterator(b.properties);for(b=a.next();!b.done;b=a.next())b=b.value,b=new OV.Property(OV.PropertyType.Text,b.name,b.value),c.AddProperty(b)}};
OV.ImporterO3dv.prototype.GetTransformation=function(a){var b=new OV.Coord3D(0,0,0),c=new OV.Quaternion(0,0,0,1),d=new OV.Coord3D(1,1,1);void 0!==a.translation&&(b=OV.ArrayToCoord3D(a.translation));void 0!==a.rotation&&(c=OV.ArrayToQuaternion(a.rotation));void 0!==a.scale&&(d=OV.ArrayToCoord3D(a.scale));a=(new OV.Matrix).ComposeTRS(b,c,d);return new OV.Transformation(a)};OV.ImporterThreeBase=function(){OV.ImporterBase.call(this)};$jscomp.inherits(OV.ImporterThreeBase,OV.ImporterBase);OV.ImporterThreeBase.prototype.GetExternalLibraries=function(){return null};OV.ImporterThreeBase.prototype.CreateLoader=function(a){return null};OV.ImporterThreeBase.prototype.GetMainObject=function(a){return a};OV.ImporterThreeBase.prototype.IsMeshVisible=function(a){return!0};
OV.ImporterThreeBase.prototype.ClearContent=function(){this.objectUrlToFileName=this.materialIdToIndex=this.loader=null};OV.ImporterThreeBase.prototype.ResetContent=function(){this.loader=null;this.materialIdToIndex=new Map;this.objectUrlToFileName=new Map};
OV.ImporterThreeBase.prototype.ImportContent=function(a,b){var c=this,d=this.GetExternalLibraries();null===d?b():function(e,g,f){var h;return $jscomp.asyncExecutePromiseGeneratorProgram(function(k){switch(k.nextAddress){case 1:k.setCatchFinallyBlocks(2),h=0;case 4:if(!(h<e.length)){k.leaveTryBlock(3);break}return k.yield(OV.LoadExternalLibrary(e[h]),5);case 5:h++;k.jumpTo(4);break;case 2:k.enterCatchBlock(),f();case 3:g(),k.jumpToEnd()}})}(d,function(){c.LoadModel(a,b)},function(){b()})};
OV.ImporterThreeBase.prototype.LoadModel=function(a,b){var c=this,d=null,e=new THREE.LoadingManager(function(){null!==d&&c.OnThreeObjectsLoaded(d,b)}),g=OV.CreateObjectUrl(a);e.setURLModifier(function(f){if(f===g)return f;var h=OV.GetFileName(f);if(0<OV.GetFileExtension(f).length){var k=c.callbacks.getFileBuffer(f);if(null!==k)return f=OV.CreateObjectUrl(k),c.objectUrlToFileName.set(f,h),f}return f});a=this.CreateLoader(e);null===a?b():a.load(g,function(f){d=f},function(){},function(f){c.SetError(f);
b()})};
OV.ImporterThreeBase.prototype.OnThreeObjectsLoaded=function(a,b){function c(f){var h=(new OV.Matrix).CreateIdentity();f.updateMatrix();void 0!==f.matrix&&null!==f.matrix&&h.Set(f.matrix.elements);return new OV.Transformation(h)}function d(f,h,k,l){var m=new OV.Node;void 0!==k.name&&m.SetName(k.name);m.SetTransformation(c(k));l.AddChildNode(m);l=$jscomp.makeIterator(k.children);for(var n=l.next();!n.done;n=l.next())d(f,h,n.value,m);k.isMesh&&f.IsMeshVisible(k)&&(0===k.children.length&&m.SetType(OV.NodeType.MeshNode),f=
f.ConvertThreeMesh(k),h=h.AddMesh(f),m.AddMeshIndex(h))}var e=this.GetMainObject(a);a=this.model.GetRootNode();a.SetTransformation(c(e));e=$jscomp.makeIterator(e.children);for(var g=e.next();!g.done;g=e.next())d(this,this.model,g.value,a);b()};
OV.ImporterThreeBase.prototype.ConvertThreeMesh=function(a){if(Array.isArray(a.material)){var b=OV.ConvertThreeGeometryToMesh(a.geometry,null);if(void 0===a.geometry.attributes.color||null===a.geometry.attributes.color){for(var c=[],d=0;d<a.material.length;d++){var e=this.FindOrCreateMaterial(a.material[d]);c.push(e)}for(d=0;d<a.geometry.groups.length;d++){e=a.geometry.groups[d];for(var g=e.start/3;g<e.start/3+e.count/3;g++)b.GetTriangle(g).SetMaterial(c[e.materialIndex])}}}else b=this.FindOrCreateMaterial(a.material),
b=OV.ConvertThreeGeometryToMesh(a.geometry,b);void 0!==a.name&&null!==a.name&&b.SetName(a.name);return b};OV.ImporterThreeBase.prototype.FindOrCreateMaterial=function(a){if(this.materialIdToIndex.has(a.id))return this.materialIdToIndex.get(a.id);var b=this.ConvertThreeMaterial(a);b=this.model.AddMaterial(b);this.materialIdToIndex.set(a.id,b);return b};
OV.ImporterThreeBase.prototype.ConvertThreeMaterial=function(a){function b(e,g){e.Set(parseInt(255*g.r,10),parseInt(255*g.g,10),parseInt(255*g.b,10))}function c(e,g){if(void 0===e||null===e||void 0===e.image||null===e.image)return null;try{var f=e.image;if(void 0!==f.data&&null!==f.data){for(var h=new ImageData(f.width,f.height),k=f.width*f.height*4,l=0;l<k;l++)h.data[l]=f.data[l];var m=THREE.ImageUtils.getDataURL(h)}else m=THREE.ImageUtils.getDataURL(f);var n=OV.Base64DataURIToArrayBuffer(m),p=new OV.TextureMap;
f=null;f=g.has(e.image.src)?g.get(e.image.src):void 0!==e.name&&null!==e.name?e.name+"."+OV.GetFileExtensionFromMimeType(n.mimeType):"Embedded_"+e.id.toString()+"."+OV.GetFileExtensionFromMimeType(n.mimeType);p.name=f;p.url=m;p.buffer=n.buffer;p.rotation=e.rotation;p.offset.x=e.offset.x;p.offset.y=e.offset.y;p.scale.x=e.repeat.x;p.scale.y=e.repeat.y;return p}catch(r){return null}}var d=new OV.Material(OV.MaterialType.Phong);d.name=a.name;b(d.color,a.color);d.opacity=a.opacity;d.transparent=a.transparent;
d.alphaTest=a.alphaTest;"MeshPhongMaterial"===a.type&&(b(d.specular,a.specular),d.shininess=a.shininess/100);d.diffuseMap=c(a.map,this.objectUrlToFileName);d.normalMap=c(a.normalMap,this.objectUrlToFileName);d.bumpMap=c(a.bumpMap,this.objectUrlToFileName);return d};OV.ImporterThreeFbx=function(){OV.ImporterThreeBase.call(this)};$jscomp.inherits(OV.ImporterThreeFbx,OV.ImporterThreeBase);OV.ImporterThreeFbx.prototype.CanImportExtension=function(a){return"fbx"===a};
OV.ImporterThreeFbx.prototype.GetUpDirection=function(){return OV.Direction.Y};OV.ImporterThreeFbx.prototype.GetExternalLibraries=function(){return["loaders/fflate.min.js","three_loaders/TGALoader.js","three_loaders/FBXLoader.js"]};OV.ImporterThreeFbx.prototype.CreateLoader=function(a){a.addHandler(/\.tga$/i,new THREE.TGALoader(a));return new THREE.FBXLoader(a)};OV.ImporterThreeFbx.prototype.GetMainObject=function(a){return a};OV.ImporterThreeDae=function(){OV.ImporterThreeBase.call(this)};
$jscomp.inherits(OV.ImporterThreeDae,OV.ImporterThreeBase);OV.ImporterThreeDae.prototype.CanImportExtension=function(a){return"dae"===a};OV.ImporterThreeDae.prototype.GetUpDirection=function(){return OV.Direction.Y};OV.ImporterThreeDae.prototype.GetExternalLibraries=function(){return["three_loaders/TGALoader.js","three_loaders/ColladaLoader.js"]};OV.ImporterThreeDae.prototype.CreateLoader=function(a){a.addHandler(/\.tga$/i,new THREE.TGALoader(a));return new THREE.ColladaLoader(a)};
OV.ImporterThreeDae.prototype.GetMainObject=function(a){return a.scene};OV.ImporterThreeWrl=function(){OV.ImporterThreeBase.call(this)};$jscomp.inherits(OV.ImporterThreeWrl,OV.ImporterThreeBase);OV.ImporterThreeWrl.prototype.CanImportExtension=function(a){return"wrl"===a};OV.ImporterThreeWrl.prototype.GetUpDirection=function(){return OV.Direction.Y};OV.ImporterThreeWrl.prototype.GetExternalLibraries=function(){return["three_loaders/chevrotain.min.js","three_loaders/VRMLLoader.js"]};
OV.ImporterThreeWrl.prototype.CreateLoader=function(a){return new THREE.VRMLLoader(a)};OV.ImporterThreeWrl.prototype.GetMainObject=function(a){return a};OV.ImporterThreeWrl.prototype.IsMeshVisible=function(a){var b=!0;if(Array.isArray(a.material))for(var c=0;c<a.material.length;c++){if(a.material[c].side===THREE.BackSide){b=!1;break}}else b=a.material.side!==THREE.BackSide;return b};OV.ImporterThree3mf=function(){OV.ImporterThreeBase.call(this)};$jscomp.inherits(OV.ImporterThree3mf,OV.ImporterThreeBase);
OV.ImporterThree3mf.prototype.CanImportExtension=function(a){return"3mf"===a};OV.ImporterThree3mf.prototype.GetUpDirection=function(){return OV.Direction.Z};OV.ImporterThree3mf.prototype.GetExternalLibraries=function(){return["loaders/fflate.min.js","three_loaders/3MFLoader.js"]};OV.ImporterThree3mf.prototype.CreateLoader=function(a){return new THREE.ThreeMFLoader(a)};OV.ImporterThree3mf.prototype.GetMainObject=function(a){return a};OV.ImporterThreeSvg=function(){OV.ImporterThreeBase.call(this)};$jscomp.inherits(OV.ImporterThreeSvg,OV.ImporterThreeBase);OV.ImporterThreeSvg.prototype.CanImportExtension=function(a){return"svg"===a};OV.ImporterThreeSvg.prototype.GetUpDirection=function(){return OV.Direction.Z};OV.ImporterThreeSvg.prototype.GetExternalLibraries=function(){return["three_loaders/SVGLoader.js"]};OV.ImporterThreeSvg.prototype.CreateLoader=function(a){return new THREE.SVGLoader(a)};
OV.ImporterThreeSvg.prototype.GetMainObject=function(a){function b(l){l=l.userData.style;return void 0===l.fill||"none"===l.fill?!1:!0}function c(l,m,n){for(var p=null,r=$jscomp.makeIterator(l),t=r.next();!t.done;t=r.next())if(t=t.value,t.style===m&&t.opacity===n){p=t.material;break}null===p&&(p=new THREE.MeshPhongMaterial({color:(new THREE.Color).setStyle(m),opacity:n,transparent:1>n}),l.push({style:m,opacity:n,material:p}));return p}var d=[],e=new THREE.Object3D;e.rotation.x=Math.PI;a=$jscomp.makeIterator(a.paths);
for(var g=a.next();!g.done;g=a.next()){g=g.value;var f=THREE.SVGLoader.createShapes(g);if(b(g)){var h=g.userData.style;h=c(d,h.fill,h.opacity);f=$jscomp.makeIterator(f);for(var k=f.next();!k.done;k=f.next())k=new THREE.ExtrudeGeometry(k.value,{depth:10,bevelEnabled:!1}),k=new THREE.Mesh(k,h),k.name=g.userData.node.id,e.add(k)}}return e};OV.Importer3dm=function(){OV.ImporterBase.call(this);this.rhino=null};$jscomp.inherits(OV.Importer3dm,OV.ImporterBase);OV.Importer3dm.prototype.CanImportExtension=function(a){return"3dm"===a};OV.Importer3dm.prototype.GetUpDirection=function(){return OV.Direction.Z};OV.Importer3dm.prototype.ClearContent=function(){this.instanceDefinitions=this.instanceObjects=null};OV.Importer3dm.prototype.ResetContent=function(){this.instanceObjects={};this.instanceDefinitions={}};
OV.Importer3dm.prototype.ImportContent=function(a,b){var c=this;null===this.rhino?OV.LoadExternalLibrary("loaders/rhino3dm.min.js").then(function(){rhino3dm().then(function(d){c.rhino=d;c.ImportRhinoContent(a);b()})}).catch(function(){b()}):(this.ImportRhinoContent(a),b())};OV.Importer3dm.prototype.ImportRhinoContent=function(a){a=this.rhino.File3dm.fromByteArray(a);null===a?this.SetError("Failed to read Rhino file."):(this.ImportRhinoDocument(a),OV.IsModelEmpty(this.model)&&this.SetError("The model doesn't contain any 3D meshes. Try to save the model while you are in shaded view in Rhino."))};
OV.Importer3dm.prototype.ImportRhinoDocument=function(a){this.InitRhinoInstances(a);this.ImportRhinoUserStrings(a);this.ImportRhinoGeometry(a)};OV.Importer3dm.prototype.InitRhinoInstances=function(a){for(var b=a.objects(),c=0;c<b.count;c++){var d=b.get(c),e=d.attributes();e.isInstanceDefinitionObject&&(this.instanceObjects[e.id]=d)}a=a.instanceDefinitions();for(b=0;b<a.count();b++)c=a.get(b),this.instanceDefinitions[c.id]=c};
OV.Importer3dm.prototype.ImportRhinoUserStrings=function(a){a=a.strings();if(0<a.count()){for(var b=new OV.PropertyGroup("Document user texts"),c=0;c<a.count();c++){var d=a.get(c);b.AddProperty(new OV.Property(OV.PropertyType.Text,d[0],d[1]))}this.model.AddPropertyGroup(b)}};OV.Importer3dm.prototype.ImportRhinoGeometry=function(a){for(var b=a.objects(),c=0;c<b.count;c++){var d=b.get(c);this.ImportRhinoGeometryObject(a,d,[])}};
OV.Importer3dm.prototype.ImportRhinoGeometryObject=function(a,b,c){var d=b.geometry(),e=b.attributes(),g=d.objectType;if(!e.isInstanceDefinitionObject||0!==c.length){e=null;var f=!1;if(g===this.rhino.ObjectType.Mesh)e=d,f=!1;else if(g===this.rhino.ObjectType.Extrusion)e=d.getMesh(this.rhino.MeshType.Any),f=!0;else if(g===this.rhino.ObjectType.Brep){e=new this.rhino.Mesh;f=d.faces();for(d=0;d<f.count;d++){g=f.get(d);var h=g.getMesh(this.rhino.MeshType.Any);h&&(e.append(h),h.delete());g.delete()}f.delete();
e.compact();f=!0}else if(g===this.rhino.ObjectType.SubD)d.subdivide(3),e=this.rhino.Mesh.createFromSubDControlNet(d),f=!0;else if(g===this.rhino.ObjectType.InstanceReference&&(d=this.instanceDefinitions[d.parentIdefId],void 0!==d))for(d=d.getObjectIds(),g=0;g<d.length;g++)h=this.instanceObjects[d[g]],void 0!==h&&(c.push(b),this.ImportRhinoGeometryObject(a,h,c),c.pop());null!==e&&(this.ImportRhinoMesh(a,e,b,c),f&&e.delete())}};
OV.Importer3dm.prototype.ImportRhinoMesh=function(a,b,c,d){var e=c.attributes();a=this.GetMaterialIndex(a,c,d);b=b.toThreejsJSON();b=OV.ConvertThreeGeometryToMesh(b.data,a);b.SetName(e.name);e=e.getUserStrings();if(0<e.length){a=new OV.PropertyGroup("User texts");for(c=0;c<e.length;c++){var g=e[c];a.AddProperty(new OV.Property(OV.PropertyType.Text,g[0],g[1]))}b.AddPropertyGroup(a)}if(0!==d.length){e=(new OV.Matrix).CreateIdentity();for(a=d.length-1;0<=a;a--)c=d[a].geometry().xform.toFloatArray(!1),
c=new OV.Matrix(c),e=e.MultiplyMatrix(c);d=new OV.Transformation(e);OV.TransformMesh(b,d)}this.model.AddMeshToRootNode(b)};
OV.Importer3dm.prototype.GetMaterialIndex=function(a,b,c){function d(e,g,f){g=g.attributes();if(g.materialSource===e.ObjectMaterialSource.MaterialFromObject){if(e=g.materialIndex,-1<e)return a.materials().get(e)}else if(g.materialSource===e.ObjectMaterialSource.MaterialFromLayer){if(e=g.layerIndex,-1<e&&(e=a.layers().get(e).renderMaterialIndex,-1<e))return a.materials().get(e)}else if(g.materialSource===e.ObjectMaterialSource.MaterialFromParent&&0!==f.length)return d(e,f[0],[]);return null}b=d(this.rhino,
b,c);return function(e,g){function f(n,p){n.Set(p.r,p.g,p.b)}function h(n){return 0===n.r&&0===n.g&&0===n.b}function k(n){return 255===n.r&&255===n.g&&255===n.b}var l=null;if(null===g)l=new OV.Material(OV.MaterialType.Phong),l.color.Set(255,255,255);else{var m=g.physicallyBased();m.supported?(l=new OV.Material(OV.MaterialType.Physical),l.metalness=m.metallic?1:0,l.roughness=m.roughness):(l=new OV.Material(OV.MaterialType.Phong),f(l.ambient,g.ambientColor),f(l.specular,g.specularColor));l.name=g.name;
f(l.color,g.diffuseColor);l.opacity=1-g.transparency;OV.UpdateMaterialTransparency(l);h(l.color)&&!k(g.reflectionColor)&&f(l.color,g.reflectionColor);h(l.color)&&!k(g.transparentColor)&&f(l.color,g.transparentColor)}for(g=0;g<e.MaterialCount();g++)if(m=e.GetMaterial(g),OV.MaterialIsEqual(m,l))return g;return e.AddMaterial(l)}(this.model,b)};OV.ImporterIfc=function(){OV.ImporterBase.call(this);this.ifc=null};$jscomp.inherits(OV.ImporterIfc,OV.ImporterBase);OV.ImporterIfc.prototype.CanImportExtension=function(a){return"ifc"===a};OV.ImporterIfc.prototype.GetUpDirection=function(){return OV.Direction.Y};OV.ImporterIfc.prototype.ClearContent=function(){this.expressIDToMesh=this.materialNameToIndex=null};OV.ImporterIfc.prototype.ResetContent=function(){this.materialNameToIndex={};this.expressIDToMesh={}};
OV.ImporterIfc.prototype.ImportContent=function(a,b){var c=this;null===this.ifc?OV.LoadExternalLibrary("loaders/web-ifc-api.js").then(function(){c.ifc=new IfcAPI;c.ifc.Init().then(function(){c.ImportIfcContent(a);b()})}).catch(function(){b()}):(this.ImportIfcContent(a),b())};
OV.ImporterIfc.prototype.ImportIfcContent=function(a){a=new Uint8Array(a);a=this.ifc.OpenModel(a,{COORDINATE_TO_ORIGIN:!0});for(var b=this.ifc.LoadAllGeometry(a),c=0;c<b.size();c++){var d=b.get(c);0<d.geometries.size()&&this.ImportIfcMesh(a,d)}this.ImportProperties(a);this.ifc.CloseModel(a)};
OV.ImporterIfc.prototype.ImportIfcMesh=function(a,b){var c=new OV.Mesh;c.SetName("Mesh "+b.expressID.toString());for(var d=0,e=b.geometries,g=0;g<e.size();g++){var f=e.get(g),h=this.ifc.GetGeometry(a,f.geometryExpressID),k=this.ifc.GetVertexArray(h.GetVertexData(),h.GetVertexDataSize());h=this.ifc.GetIndexArray(h.GetIndexData(),h.GetIndexDataSize());var l=this.GetMaterialIndexByColor(f.color);f=new OV.Matrix(f.flatTransformation);f=new OV.Transformation(f);for(var m=0;m<k.length;m+=6){var n=new OV.Coord3D(k[m],
k[m+1],k[m+2]);n=f.TransformCoord3D(n);c.AddVertex(n)}for(f=0;f<h.length;f+=3)m=new OV.Triangle(d+h[f],d+h[f+1],d+h[f+2]),m.SetMaterial(l),c.AddTriangle(m);d+=k.length/6}this.expressIDToMesh[b.expressID]=c;this.model.AddMeshToRootNode(c)};
OV.ImporterIfc.prototype.ImportProperties=function(a){for(var b=this,c=this.ifc.GetLineIDsWithType(a,4186316022),d={},e=0;e<c.size();d={$jscomp$loop$prop$rel$109:d.$jscomp$loop$prop$rel$109},e++){var g=c.get(e);d.$jscomp$loop$prop$rel$109=this.ifc.GetLine(a,g);Array.isArray(d.$jscomp$loop$prop$rel$109.RelatingPropertyDefinition)||d.$jscomp$loop$prop$rel$109.RelatedObjects.forEach(function(f){return function(h){var k=b.expressIDToMesh[h.value];if(void 0===k)if(4031249490===b.ifc.GetLine(a,h.value,
!0).type)k=b.model;else return;if((h=b.ifc.GetLine(a,f.$jscomp$loop$prop$rel$109.RelatingPropertyDefinition.value,!0))&&h.HasProperties){var l=new OV.PropertyGroup(h.Name.value);h.HasProperties.forEach(function(m){if(m&&m.Name&&m.NominalValue){var n=null,p=b.GetIFCString(m.Name.value);switch(m.NominalValue.label){case "IFCTEXT":case "IFCLABEL":case "IFCIDENTIFIER":n=new OV.Property(OV.PropertyType.Text,p,b.GetIFCString(m.NominalValue.value));break;case "IFCBOOLEAN":case "IFCLOGICAL":n="Unknown";"T"===
m.NominalValue.value?n="True":"F"===m.NominalValue.value&&(n="False");n=new OV.Property(OV.PropertyType.Text,p,n);break;case "IFCINTEGER":case "IFCCOUNTMEASURE":n=new OV.Property(OV.PropertyType.Integer,p,m.NominalValue.value);break;case "IFCREAL":case "IFCLENGTHMEASURE":case "IFCPOSITIVELENGTHMEASURE":case "IFCAREAMEASURE":case "IFCVOLUMEMEASURE":case "IFCRATIOMEASURE":case "IFCPOSITIVERATIOMEASURE":case "IFCMASSMEASURE":case "IFCMASSPERLENGTHMEASURE":case "IFCPLANEANGLEMEASURE":case "IFCTHERMALTRANSMITTANCEMEASURE":n=
new OV.Property(OV.PropertyType.Number,p,m.NominalValue.value);break;default:console.log(m.NominalValue.label),console.log(m.NominalValue.value)}null!==n&&l.AddProperty(n)}});0<l.PropertyCount()&&k.AddPropertyGroup(l)}}}(d))}};
OV.ImporterIfc.prototype.GetMaterialIndexByColor=function(a){var b=new OV.Color(parseInt(255*a.x,10),parseInt(255*a.y,10),parseInt(255*a.z,10)),c="Color "+OV.IntegerToHexString(b.r)+OV.IntegerToHexString(b.g)+OV.IntegerToHexString(b.b)+OV.IntegerToHexString(parseInt(255*a.w,10)),d=this.materialNameToIndex[c];void 0===d&&(d=new OV.Material(OV.MaterialType.Phong),d.name=c,d.color=b,d.opacity=a.w,OV.UpdateMaterialTransparency(d),d=this.model.AddMaterial(d),this.materialNameToIndex[c]=d);return d};
OV.ImporterIfc.prototype.GetIFCString=function(a){a=this.DecodeIFCString(a);0===a.length&&(a="-");return a};OV.ImporterIfc.prototype.DecodeIFCString=function(a){for(var b=/\\X2\\(.*?)\\X0\\/uig,c=a,d=b.exec(a);d;){var e=String.fromCharCode(parseInt(d[1],16));c=c.replace(d[0],e);d=b.exec(a)}return c};OV.File=function(a,b){this.source=b;b===OV.FileSource.Url?(this.fileUrl=a,this.fileObject=null,this.name=OV.GetFileName(a),this.extension=OV.GetFileExtension(a)):b===OV.FileSource.File?(this.fileUrl=null,this.fileObject=a,this.name=OV.GetFileName(a.name),this.extension=OV.GetFileExtension(a.name)):b===OV.FileSource.Decompressed&&(this.fileObject=this.fileUrl=null,this.name=OV.GetFileName(a),this.extension=OV.GetFileExtension(a));this.content=null};
OV.File.prototype.SetContent=function(a){this.content=a};OV.FileList=function(){this.files=[]};OV.FileList.prototype.FillFromFileUrls=function(a){this.Fill(a,OV.FileSource.Url)};OV.FileList.prototype.FillFromFileObjects=function(a){this.Fill(a,OV.FileSource.File)};OV.FileList.prototype.ExtendFromFileList=function(a){for(var b=0;b<a.length;b++){var c=a[b];this.ContainsFileByPath(c.name)||this.files.push(c)}};OV.FileList.prototype.GetFiles=function(){return this.files};
OV.FileList.prototype.GetContent=function(a){var b=this;OV.RunTasks(this.files.length,{runTask:function(c,d){b.GetFileContent(b.files[c],d)},onReady:a})};OV.FileList.prototype.ContainsFileByPath=function(a){return null!==this.FindFileByPath(a)};OV.FileList.prototype.FindFileByPath=function(a){a=OV.GetFileName(a).toLowerCase();for(var b=0;b<this.files.length;b++){var c=this.files[b];if(c.name.toLowerCase()===a)return c}return null};
OV.FileList.prototype.IsOnlyUrlSource=function(){if(0===this.files.length)return!1;for(var a=0;a<this.files.length;a++){var b=this.files[a];if(b.source!==OV.FileSource.Url&&b.source!==OV.FileSource.Decompressed)return!1}return!0};OV.FileList.prototype.Fill=function(a,b){this.files=[];for(var c=0;c<a.length;c++){var d=new OV.File(a[c],b);this.AddFile(d)}};OV.FileList.prototype.AddFile=function(a){this.files.push(a)};
OV.FileList.prototype.GetFileContent=function(a,b){if(null!==a.content)b();else{var c=null;if(a.source===OV.FileSource.Url)c=OV.RequestUrl(a.fileUrl,OV.FileFormat.Binary);else if(a.source===OV.FileSource.File)c=OV.ReadFile(a.fileObject,OV.FileFormat.Binary);else{b();return}c.then(function(d){a.SetContent(d)}).catch(function(){}).finally(function(){b()})}};OV.ImportSettings=function(){this.defaultColor=new OV.Color(200,200,200)};OV.ImportErrorCode={NoImportableFile:1,ImportFailed:2,UnknownError:3};OV.ImportError=function(a,b){this.code=a;this.message=b};OV.ImportResult=function(){this.missingFiles=this.usedFiles=this.upVector=this.mainFile=this.model=null};OV.ImporterFileAccessor=function(a){this.getBufferCallback=a;this.fileBuffers=new Map;this.textureBuffers=new Map};
OV.ImporterFileAccessor.prototype.GetFileBuffer=function(a){a=OV.GetFileName(a);if(this.fileBuffers.has(a))return this.fileBuffers.get(a);var b=this.getBufferCallback(a);this.fileBuffers.set(a,b);return b};OV.ImporterFileAccessor.prototype.GetTextureBuffer=function(a){a=OV.GetFileName(a);if(this.textureBuffers.has(a))return this.textureBuffers.get(a);var b=null,c=this.getBufferCallback(a);null!==c&&(b={url:OV.CreateObjectUrl(c),buffer:c});this.textureBuffers.set(a,b);return b};
OV.Importer=function(){this.importers=[new OV.ImporterObj,new OV.ImporterStl,new OV.ImporterOff,new OV.ImporterPly,new OV.Importer3ds,new OV.ImporterGltf,new OV.ImporterO3dv,new OV.Importer3dm,new OV.ImporterIfc,new OV.ImporterThreeFbx,new OV.ImporterThreeDae,new OV.ImporterThreeWrl,new OV.ImporterThree3mf];this.fileList=new OV.FileList;this.model=null;this.usedFiles=[];this.missingFiles=[]};OV.Importer.prototype.AddImporter=function(a){this.importers.push(a)};
OV.Importer.prototype.ImportFiles=function(a,b,c,d){var e=this;this.LoadFiles(a,b,function(){d.onFilesLoaded();OV.RunTaskAsync(function(){e.ImportLoadedFiles(c,d)})})};
OV.Importer.prototype.LoadFiles=function(a,b,c){var d=this,e=new OV.FileList(this.importers);b===OV.FileSource.Url?e.FillFromFileUrls(a):b===OV.FileSource.File&&e.FillFromFileObjects(a);a=!1;if(this.HasImportableFile(e))a=!0;else{a=!1;for(b=0;b<this.missingFiles.length;b++)e.ContainsFileByPath(this.missingFiles[b])&&(a=!0);a?(a=e.GetFiles(),this.fileList.ExtendFromFileList(a),a=!1):a=!0}a&&(this.fileList=e);this.fileList.GetContent(function(){d.DecompressArchives(d.fileList,function(){c()})})};
OV.Importer.prototype.ImportLoadedFiles=function(a,b){var c=this,d=this.GetImportableFiles(this.fileList);if(0===d.length)b.onImportError(new OV.ImportError(OV.ImportErrorCode.NoImportableFile,null));else if(1!==d.length&&b.onSelectMainFile){var e=d.map(function(g){return g.file.name});b.onSelectMainFile(e,function(g){if(null===g)b.onImportError(new OV.ImportError(OV.ImportErrorCode.NoImportableFile,null));else c.ImportLoadedMainFile(d[g],a,b)})}else this.ImportLoadedMainFile(d[0],a,b)};
OV.Importer.prototype.ImportLoadedMainFile=function(a,b,c){var d=this;if(null===a||null===a.file||null===a.file.content)c.onImportError(new OV.ImportError(OV.ImportErrorCode.NoImportableFile,null));else{this.RevokeModelUrls();this.model=null;this.usedFiles=[];this.missingFiles=[];this.usedFiles.push(a.file.name);var e=a.importer,g=new OV.ImporterFileAccessor(function(f){var h=d.fileList.FindFileByPath(f);null===h||null===h.content?(d.missingFiles.push(f),f=null):(d.usedFiles.push(f),f=h.content);
return f});e.Import(a.file.name,a.file.extension,a.file.content,{getDefaultMaterial:function(){var f=new OV.Material(OV.MaterialType.Phong);f.color=b.defaultColor;return f},getFileBuffer:function(f){return g.GetFileBuffer(f)},getTextureBuffer:function(f){return g.GetTextureBuffer(f)},onSuccess:function(){d.model=e.GetModel();var f=new OV.ImportResult;f.mainFile=a.file.name;f.model=d.model;f.usedFiles=d.usedFiles;f.missingFiles=d.missingFiles;f.upVector=e.GetUpDirection();c.onImportSuccess(f)},onError:function(){var f=
e.GetErrorMessage();c.onImportError(new OV.ImportError(OV.ImportErrorCode.ImportFailed,f))},onComplete:function(){e.Clear()}})}};
OV.Importer.prototype.DecompressArchives=function(a,b){var c=a.GetFiles(),d=[];c=$jscomp.makeIterator(c);for(var e=c.next();!e.done;e=c.next())e=e.value,"zip"===e.extension&&d.push(e);0===d.length?b():OV.LoadExternalLibrary("loaders/fflate.min.js").then(function(){for(var g=0;g<d.length;g++){var f=new Uint8Array(d[g].content);f=fflate.unzipSync(f);for(var h in f)if(Object.prototype.hasOwnProperty.call(f,h)){var k=new OV.File(h,OV.FileSource.Decompressed);k.SetContent(f[h].buffer);a.AddFile(k)}}b()}).catch(function(){b()})};
OV.Importer.prototype.GetFileList=function(){return this.fileList};OV.Importer.prototype.HasImportableFile=function(a){return 0<this.GetImportableFiles(a).length};OV.Importer.prototype.GetImportableFiles=function(a){var b=[];a=a.GetFiles();for(var c=0;c<a.length;c++){var d=a[c];a:{var e=d;for(var g=this.importers,f=0;f<g.length;f++){var h=g[f];if(h.CanImportExtension(e.extension)){e=h;break a}}e=null}null!==e&&b.push({file:d,importer:e})}return b};
OV.Importer.prototype.RevokeModelUrls=function(){if(null!==this.model)for(var a=0;a<this.model.MaterialCount();a++){var b=this.model.GetMaterial(a);OV.EnumerateMaterialTextureMaps(b,function(c){null!==c.url&&OV.RevokeObjectUrl(c.url)})}};OV.ExportedFile=function(a){this.name=a;this.content=null};OV.ExportedFile.prototype.GetName=function(){return this.name};OV.ExportedFile.prototype.SetName=function(a){this.name=a};OV.ExportedFile.prototype.GetTextContent=function(){return OV.ArrayBufferToUtf8String(this.content)};OV.ExportedFile.prototype.GetBufferContent=function(){return this.content};OV.ExportedFile.prototype.SetTextContent=function(a){this.content=OV.Utf8StringToArrayBuffer(a)};
OV.ExportedFile.prototype.SetBufferContent=function(a){this.content=a};OV.ExporterBase=function(){};OV.ExporterBase.prototype.CanExport=function(a,b){return!1};OV.ExporterBase.prototype.Export=function(a,b,c){var d=[];this.ExportContent(a,b,d,function(){c(d)})};OV.ExporterBase.prototype.ExportContent=function(a,b,c,d){};OV.ExporterBase.prototype.GetExportedMaterialName=function(a){return this.GetExportedName(a,"Material")};
OV.ExporterBase.prototype.GetExportedMeshName=function(a){return this.GetExportedName(a,"Mesh")};OV.ExporterBase.prototype.GetExportedName=function(a,b){return 0===a.length?b:a};OV.ExporterObj=function(){OV.ExporterBase.call(this)};$jscomp.inherits(OV.ExporterObj,OV.ExporterBase);OV.ExporterObj.prototype.CanExport=function(a,b){return a===OV.FileFormat.Text&&"obj"===b};
OV.ExporterObj.prototype.ExportContent=function(a,b,c,d){function e(v,u,q,w){if(null!==q&&q.IsValid()){var x=OV.GetFileName(q.name);v.WriteArrayLine([u,x]);-1===w.findIndex(function(C){return C.GetName()===x})&&(v=new OV.ExportedFile(x),v.SetBufferContent(q.buffer),w.push(v))}}var g=this;b=new OV.ExportedFile("model.mtl");var f=new OV.ExportedFile("model.obj");c.push(b);c.push(f);var h=new OV.TextWriter;h.WriteLine(this.GetHeaderText());for(var k=0;k<a.MaterialCount();k++){var l=a.GetMaterial(k);
h.WriteArrayLine(["newmtl",this.GetExportedMaterialName(l.name)]);h.WriteArrayLine(["Ka",l.ambient.r/255,l.ambient.g/255,l.ambient.b/255]);h.WriteArrayLine(["Kd",l.color.r/255,l.color.g/255,l.color.b/255]);h.WriteArrayLine(["Ks",l.specular.r/255,l.specular.g/255,l.specular.b/255]);h.WriteArrayLine(["Ns",1E3*l.shininess]);h.WriteArrayLine(["d",l.opacity]);e(h,"map_Kd",l.diffuseMap,c);e(h,"map_Ks",l.specularMap,c);e(h,"bump",l.bumpMap,c)}b.SetTextContent(h.GetText());var m=new OV.TextWriter;m.WriteLine(this.GetHeaderText());
m.WriteArrayLine(["mtllib",b.GetName()]);var n=0,p=0,r=0,t=null;a.EnumerateTransformedMeshes(function(v){m.WriteArrayLine(["g",g.GetExportedMeshName(v.GetName())]);for(var u=0;u<v.VertexCount();u++){var q=v.GetVertex(u);m.WriteArrayLine(["v",q.x,q.y,q.z])}for(u=0;u<v.NormalCount();u++)q=v.GetNormal(u),m.WriteArrayLine(["vn",q.x,q.y,q.z]);for(u=0;u<v.TextureUVCount();u++)q=v.GetTextureUV(u),m.WriteArrayLine(["vt",q.x,q.y]);for(u=0;u<v.TriangleCount();u++){q=v.GetTriangle(u);var w=q.v0+n+1,x=q.v1+n+
1,C=q.v2+n+1,y=q.n0+p+1,z=q.n1+p+1,B=q.n2+p+1;if(null!==q.mat){var A=a.GetMaterial(q.mat);A=g.GetExportedMaterialName(A.name);A!==t&&(m.WriteArrayLine(["usemtl",A]),t=A)}var E=A="",F="";q.HasTextureUVs()&&(A=q.u0+r+1,E=q.u1+r+1,F=q.u2+r+1);m.WriteArrayLine(["f",[w,A,y].join("/"),[x,E,z].join("/"),[C,F,B].join("/")])}n+=v.VertexCount();p+=v.NormalCount();r+=v.TextureUVCount()});f.SetTextContent(m.GetText());d()};OV.ExporterObj.prototype.GetHeaderText=function(){return"# exported by https://3dviewer.net"};OV.ExporterStl=function(){OV.ExporterBase.call(this)};$jscomp.inherits(OV.ExporterStl,OV.ExporterBase);OV.ExporterStl.prototype.CanExport=function(a,b){return(a===OV.FileFormat.Text||a===OV.FileFormat.Binary)&&"stl"===b};OV.ExporterStl.prototype.ExportContent=function(a,b,c,d){b===OV.FileFormat.Text?this.ExportText(a,c):this.ExportBinary(a,c);d()};
OV.ExporterStl.prototype.ExportText=function(a,b){var c=new OV.ExportedFile("model.stl");b.push(c);var d=new OV.TextWriter;d.WriteLine("solid Model");OV.EnumerateTrianglesWithNormals(a,function(e,g,f,h){d.WriteArrayLine(["facet","normal",h.x,h.y,h.z]);d.Indent(1);d.WriteLine("outer loop");d.Indent(1);d.WriteArrayLine(["vertex",e.x,e.y,e.z]);d.WriteArrayLine(["vertex",g.x,g.y,g.z]);d.WriteArrayLine(["vertex",f.x,f.y,f.z]);d.Indent(-1);d.WriteLine("endloop");d.Indent(-1);d.WriteLine("endfacet")});d.WriteLine("endsolid Model");
c.SetTextContent(d.GetText())};
OV.ExporterStl.prototype.ExportBinary=function(a,b){var c=new OV.ExportedFile("model.stl");b.push(c);b=a.TriangleCount();for(var d=new OV.BinaryWriter(84+50*b,!0),e=0;80>e;e++)d.WriteUnsignedCharacter8(0);d.WriteUnsignedInteger32(b);OV.EnumerateTrianglesWithNormals(a,function(g,f,h,k){d.WriteFloat32(k.x);d.WriteFloat32(k.y);d.WriteFloat32(k.z);d.WriteFloat32(g.x);d.WriteFloat32(g.y);d.WriteFloat32(g.z);d.WriteFloat32(f.x);d.WriteFloat32(f.y);d.WriteFloat32(f.z);d.WriteFloat32(h.x);d.WriteFloat32(h.y);
d.WriteFloat32(h.z);d.WriteUnsignedInteger16(0)});c.SetBufferContent(d.GetBuffer())};OV.ExporterPly=function(){OV.ExporterBase.call(this)};$jscomp.inherits(OV.ExporterPly,OV.ExporterBase);OV.ExporterPly.prototype.CanExport=function(a,b){return(a===OV.FileFormat.Text||a===OV.FileFormat.Binary)&&"ply"===b};OV.ExporterPly.prototype.ExportContent=function(a,b,c,d){b===OV.FileFormat.Text?this.ExportText(a,c):this.ExportBinary(a,c);d()};
OV.ExporterPly.prototype.ExportText=function(a,b){var c=new OV.ExportedFile("model.ply");b.push(c);var d=new OV.TextWriter;b=a.VertexCount();var e=a.TriangleCount();b=this.GetHeaderText("ascii",b,e);d.Write(b);OV.EnumerateModelVerticesAndTriangles(a,{onVertex:function(g,f,h){d.WriteArrayLine([g,f,h])},onTriangle:function(g,f,h){d.WriteArrayLine([3,g,f,h])}});c.SetTextContent(d.GetText())};
OV.ExporterPly.prototype.ExportBinary=function(a,b){var c=new OV.ExportedFile("model.ply");b.push(c);var d=a.VertexCount(),e=a.TriangleCount();b=this.GetHeaderText("binary_little_endian",d,e);var g=new OV.BinaryWriter(b.length+12*d+13*e,!0);for(d=0;d<b.length;d++)g.WriteUnsignedCharacter8(b.charCodeAt(d));OV.EnumerateModelVerticesAndTriangles(a,{onVertex:function(f,h,k){g.WriteFloat32(f);g.WriteFloat32(h);g.WriteFloat32(k)},onTriangle:function(f,h,k){g.WriteUnsignedCharacter8(3);g.WriteInteger32(f);
g.WriteInteger32(h);g.WriteInteger32(k)}});c.SetBufferContent(g.GetBuffer())};OV.ExporterPly.prototype.GetHeaderText=function(a,b,c){var d=new OV.TextWriter;d.WriteLine("ply");d.WriteLine("format "+a+" 1.0");d.WriteLine("element vertex "+b);d.WriteLine("property float x");d.WriteLine("property float y");d.WriteLine("property float z");d.WriteLine("element face "+c);d.WriteLine("property list uchar int vertex_index");d.WriteLine("end_header");return d.GetText()};OV.ExporterOff=function(){OV.ExporterBase.call(this)};$jscomp.inherits(OV.ExporterOff,OV.ExporterBase);OV.ExporterOff.prototype.CanExport=function(a,b){return a===OV.FileFormat.Text&&"off"===b};
OV.ExporterOff.prototype.ExportContent=function(a,b,c,d){b=new OV.ExportedFile("model.off");c.push(b);var e=new OV.TextWriter;e.WriteLine("OFF");e.WriteArrayLine([a.VertexCount(),a.TriangleCount(),0]);OV.EnumerateModelVerticesAndTriangles(a,{onVertex:function(g,f,h){e.WriteArrayLine([g,f,h])},onTriangle:function(g,f,h){e.WriteArrayLine([3,g,f,h])}});b.SetTextContent(e.GetText());d()};OV.ExporterGltf=function(){OV.ExporterBase.call(this);this.components={index:{type:5125,size:4},number:{type:5126,size:4}}};$jscomp.inherits(OV.ExporterGltf,OV.ExporterBase);OV.ExporterGltf.prototype.CanExport=function(a,b){return a===OV.FileFormat.Text&&"gltf"===b||a===OV.FileFormat.Binary&&"glb"===b};OV.ExporterGltf.prototype.ExportContent=function(a,b,c,d){b===OV.FileFormat.Text?this.ExportAsciiContent(a,c):b===OV.FileFormat.Binary&&this.ExportBinaryContent(a,c);d()};
OV.ExporterGltf.prototype.ExportAsciiContent=function(a,b){var c=new OV.ExportedFile("model.gltf"),d=new OV.ExportedFile("model.bin");b.push(c);b.push(d);var e=this.GetMeshData(a),g=this.GetMainBuffer(e),f=this.GetMainJson(e);f.buffers.push({uri:d.GetName(),byteLength:g.byteLength});var h=new Map;this.ExportMaterials(a,f,function(k){var l=OV.GetFileName(k.name);if(h.has(l))return h.get(l);var m=new OV.ExportedFile(l);m.SetBufferContent(k.buffer);b.push(m);k=f.textures.length;h.set(l,k);f.images.push({uri:l});
f.textures.push({source:k});return k});c.SetTextContent(JSON.stringify(f,null,4));d.SetBufferContent(g)};
OV.ExporterGltf.prototype.ExportBinaryContent=function(a,b){function c(v){var u=v%4;return 0===u?v:v+(4-u)}function d(v,u,q){for(var w=0;w<q;w++)v.WriteUnsignedCharacter8(u)}var e=new OV.ExportedFile("model.glb");b.push(e);var g=this.GetMeshData(a);b=this.GetMainBuffer(g);var f=this.GetMainJson(g),h=[],k=b.byteLength,l=new Map;this.ExportMaterials(a,f,function(v){var u=OV.GetFileName(v.name),q=OV.GetFileExtension(v.name);if(l.has(u))return l.get(u);var w=f.bufferViews.length,x=f.textures.length;l.set(u,
x);v=v.buffer;h.push(v);f.bufferViews.push({buffer:0,byteOffset:k,byteLength:v.byteLength});k+=v.byteLength;f.images.push({bufferView:w,mimeType:"image/"+q});f.textures.push({source:x});return x});a=b.byteLength;for(g=0;g<h.length;g++)a+=h[g].byteLength;g=c(a);f.buffers.push({byteLength:g});var m=JSON.stringify(f),n=OV.Utf8StringToArrayBuffer(m),p=n.byteLength,r=c(p),t=20+r+8+g;m=new OV.BinaryWriter(t,!0);m.WriteUnsignedInteger32(1179937895);m.WriteUnsignedInteger32(2);m.WriteUnsignedInteger32(t);
m.WriteUnsignedInteger32(r);m.WriteUnsignedInteger32(1313821514);m.WriteArrayBuffer(n);d(m,32,r-p);m.WriteUnsignedInteger32(g);m.WriteUnsignedInteger32(5130562);m.WriteArrayBuffer(b);for(b=0;b<h.length;b++)m.WriteArrayBuffer(h[b]);d(m,0,g-a);e.SetBufferContent(m.GetBuffer())};OV.ExporterGltf.prototype.GetMeshData=function(a){var b=[];a.EnumerateTransformedMeshes(function(c){var d=OV.ConvertMeshToMeshBuffer(c);b.push({name:c.GetName(),buffer:d,offsets:[],sizes:[]})});return b};
OV.ExporterGltf.prototype.GetMainBuffer=function(a){for(var b=0,c=0;c<a.length;c++)b+=a[c].buffer.GetByteLength(this.components.index.size,this.components.number.size);b=new OV.BinaryWriter(b,!0);for(c=0;c<a.length;c++)for(var d=a[c],e=0;e<d.buffer.PrimitiveCount();e++){for(var g=d.buffer.GetPrimitive(e),f=b.GetPosition(),h=0;h<g.indices.length;h++)b.WriteUnsignedInteger32(g.indices[h]);for(h=0;h<g.vertices.length;h++)b.WriteFloat32(g.vertices[h]);for(h=0;h<g.normals.length;h++)b.WriteFloat32(g.normals[h]);
for(h=0;h<g.uvs.length;h++){var k=g.uvs[h];1===h%2&&(k*=-1);b.WriteFloat32(k)}d.offsets.push(f);d.sizes.push(b.GetPosition()-f)}return b.GetBuffer()};
OV.ExporterGltf.prototype.GetMainJson=function(a){var b=function(t,v){this.mainJson=t;this.byteOffset=v};b.prototype.AddBufferView=function(t){this.mainJson.bufferViews.push({buffer:0,byteOffset:this.byteOffset,byteLength:t});this.byteOffset+=t};for(var c={asset:{version:"2.0",generator:"https://3dviewer.net"},scene:0,scenes:[{nodes:[]}],nodes:[],materials:[],meshes:[],buffers:[],bufferViews:[],accessors:[]},d=0;d<a.length;d++){var e=a[d];c.scenes[0].nodes.push(d);c.nodes.push({mesh:d});for(var g=
{name:this.GetExportedMeshName(e.name),primitives:[]},f=e.buffer.primitives,h=0;h<f.length;h++){var k=f[h],l=c.bufferViews.length,m=new b(c,e.offsets[h]);m.AddBufferView(k.indices.length*this.components.index.size);m.AddBufferView(k.vertices.length*this.components.number.size);m.AddBufferView(k.normals.length*this.components.number.size);var n=c.accessors.length,p={attributes:{POSITION:n+1,NORMAL:n+2},indices:n,mode:4,material:k.material},r=k.GetBounds();c.accessors.push({bufferView:l,byteOffset:0,
componentType:this.components.index.type,count:k.indices.length,type:"SCALAR"});c.accessors.push({bufferView:l+1,byteOffset:0,componentType:this.components.number.type,count:k.vertices.length/3,min:r.min,max:r.max,type:"VEC3"});c.accessors.push({bufferView:l+2,byteOffset:0,componentType:this.components.number.type,count:k.normals.length/3,type:"VEC3"});0<k.uvs.length&&(m.AddBufferView(k.uvs.length*this.components.number.size),c.accessors.push({bufferView:l+3,byteOffset:0,componentType:this.components.number.type,
count:k.uvs.length/2,type:"VEC2"}),p.attributes.TEXCOORD_0=n+3);g.primitives.push(p)}c.meshes.push(g)}return c};
OV.ExporterGltf.prototype.ExportMaterials=function(a,b,c){function d(f,h,k,l){function m(r,t){return[OV.SRGBToLinear(r.r/255),OV.SRGBToLinear(r.g/255),OV.SRGBToLinear(r.b/255),t]}function n(r,t,v){if(null===t||!t.IsValid())return null;void 0===r.images&&(r.images=[]);void 0===r.textures&&(r.textures=[]);v={index:v(t)};t.HasTransformation()&&(void 0===r.extensionsUsed&&(r.extensionsUsed=[]),-1===r.extensionsUsed.indexOf("KHR_texture_transform")&&r.extensionsUsed.push("KHR_texture_transform"),v.extensions=
{KHR_texture_transform:{offset:[t.offset.x,-t.offset.y],scale:[t.scale.x,t.scale.y],rotation:-t.rotation}});return v}f={name:f.GetExportedMaterialName(k.name),pbrMetallicRoughness:{baseColorFactor:m(k.color,k.opacity)},emissiveFactor:function(r){return[OV.SRGBToLinear(r.r/255),OV.SRGBToLinear(r.g/255),OV.SRGBToLinear(r.b/255)]}(k.emissive),doubleSided:!0,alphaMode:"OPAQUE"};k.transparent&&(f.alphaMode="BLEND");var p=n(h,k.diffuseMap,l);null!==p&&(k.multiplyDiffuseMap||(f.pbrMetallicRoughness.baseColorFactor=
m(new OV.Color(255,255,255),k.opacity)),f.pbrMetallicRoughness.baseColorTexture=p);p=n(h,k.metalnessMap,l);null!==p?f.pbrMetallicRoughness.metallicRoughnessTexture=p:(f.pbrMetallicRoughness.metallicFactor=k.metalness,f.pbrMetallicRoughness.roughnessFactor=k.roughness);p=n(h,k.normalMap,l);null!==p&&(f.normalTexture=p);k=n(h,k.emissiveMap,l);null!==k&&(f.emissiveTexture=k);h.materials.push(f)}for(var e=0;e<a.MaterialCount();e++){var g=a.GetMaterial(e);d(this,b,g,c)}};OV.Exporter3dm=function(){OV.ExporterBase.call(this);this.rhino=null};$jscomp.inherits(OV.Exporter3dm,OV.ExporterBase);OV.Exporter3dm.prototype.CanExport=function(a,b){return a===OV.FileFormat.Binary&&"3dm"===b};OV.Exporter3dm.prototype.ExportContent=function(a,b,c,d){var e=this;null===this.rhino?OV.LoadExternalLibrary("loaders/rhino3dm.min.js").then(function(){rhino3dm().then(function(g){e.rhino=g;e.ExportRhinoContent(a,c,d)})}).catch(function(){d()}):this.ExportRhinoContent(a,c,d)};
OV.Exporter3dm.prototype.ExportRhinoContent=function(a,b,c){function d(h){return{r:h.r,g:h.g,b:h.b,a:255}}var e=this,g=new OV.ExportedFile("model.3dm");b.push(g);var f=new this.rhino.File3dm;a.EnumerateTransformedMeshes(function(h){for(var k=OV.ConvertMeshToMeshBuffer(h),l=0;l<k.PrimitiveCount();l++){var m=k.GetPrimitive(l),n={data:{attributes:{position:{itemSize:3,type:"Float32Array",array:m.vertices},normal:{itemSize:3,type:"Float32Array",array:m.normals}},index:{type:"Uint16Array",array:m.indices}}};
m=a.GetMaterial(m.material);var p=new e.rhino.Material;p.name=e.GetExportedMaterialName(m.name);p.ambientColor=d(m.ambient);p.diffuseColor=d(m.color);p.specularColor=d(m.specular);p.transparency=1-m.opacity;m=f.materials().count();f.materials().add(p);n=new e.rhino.Mesh.createFromThreejsJSON(n);p=new e.rhino.ObjectAttributes;p.name=e.GetExportedMeshName(h.GetName());p.materialSource=e.rhino.ObjectMaterialSource.MaterialFromObject;p.materialIndex=m;f.objects().add(n,p)}});b=new this.rhino.File3dmWriteOptions;
b.version=6;b=f.toByteArray(b);g.SetBufferContent(b);c()};OV.Exporter=function(){this.exporters=[new OV.ExporterObj,new OV.ExporterStl,new OV.ExporterPly,new OV.ExporterOff,new OV.ExporterGltf,new OV.Exporter3dm]};OV.Exporter.prototype.AddExporter=function(a){this.exporters.push(a)};OV.Exporter.prototype.Export=function(a,b,c,d){for(var e=null,g=0;g<this.exporters.length;g++){var f=this.exporters[g];if(f.CanExport(b,c)){e=f;break}}if(null===e)d.onError();else e.Export(a,b,function(h){if(0===h.length)d.onError();else d.onSuccess(h)})};OV.HasHighpDriverIssue=function(){var a=document.createElement("canvas");document.body.appendChild(a);var b=new THREE.WebGLRenderer({canvas:a,antialias:!0});b.setClearColor("#ffffff",1);b.setSize(10,10);var c=new THREE.Scene,d=new THREE.AmbientLight(8947848);c.add(d);d=new THREE.DirectionalLight(8947848);d.position.set(0,0,1);c.add(d);d=new THREE.PerspectiveCamera(45,1,.1,1E3);d.position.set(0,0,1);d.up.set(0,1,0);d.lookAt(new THREE.Vector3(0,0,0));c.add(d);var e=new THREE.PlaneGeometry(1,1);e=new THREE.Mesh(e,
new THREE.MeshPhongMaterial({color:13369344}));c.add(e);b.render(c,d);b=b.getContext();c=new Uint8Array(4);b.readPixels(5,5,1,1,b.RGBA,b.UNSIGNED_BYTE,c);document.body.removeChild(a);return 50>c[0]&&50>c[1]&&50>c[2]?!0:!1};
OV.ConvertThreeGeometryToMesh=function(a,b){for(var c=new OV.Mesh,d=a.attributes.position.array,e=0;e<d.length;e+=3)c.AddVertex(new OV.Coord3D(d[e],d[e+1],d[e+2]));if(e=void 0!==a.attributes.normal)for(var g=a.attributes.normal.array,f=0;f<g.length;f+=3)c.AddNormal(new OV.Coord3D(g[f],g[f+1],g[f+2]));if(g=void 0!==a.attributes.uv){f=a.attributes.uv.array;for(var h=0;h<f.length;h+=2)c.AddTextureUV(new OV.Coord2D(f[h],f[h+1]))}if(null!==a.index)a=a.index.array;else for(a=[],f=0;f<d.length/3;f++)a.push(f);
for(d=0;d<a.length;d+=3){f=a[d];h=a[d+1];var k=a[d+2],l=new OV.Triangle(f,h,k);e&&l.SetNormals(f,h,k);g&&l.SetTextureUVs(f,h,k);null!==b&&l.SetMaterial(b);c.AddTriangle(l)}return c};OV.ModelToThreeConversionParams=function(){this.forceMediumpForMaterials=!1};OV.ModelToThreeConversionOutput=function(){this.defaultMaterial=null};OV.ThreeConversionStateHandler=function(a){this.callbacks=a;this.texturesLoaded=this.texturesNeeded=0;this.threeObject=null};OV.ThreeConversionStateHandler.prototype.OnTextureNeeded=function(){this.texturesNeeded+=1};OV.ThreeConversionStateHandler.prototype.OnTextureLoaded=function(){this.texturesLoaded+=1;this.callbacks.onTextureLoaded();this.Finish()};
OV.ThreeConversionStateHandler.prototype.OnModelLoaded=function(a){this.threeObject=a;this.Finish()};OV.ThreeConversionStateHandler.prototype.Finish=function(){if(null!==this.threeObject&&this.texturesNeeded===this.texturesLoaded)this.callbacks.onModelLoaded(this.threeObject)};OV.ThreeNodeTree=function(a,b){this.meshInstances=[];this.AddNode(a,b)};
OV.ThreeNodeTree.prototype.AddNode=function(a,b){var c=a.GetTransformation().GetMatrix();c=(new THREE.Matrix4).fromArray(c.Get());b.applyMatrix4(c);c=$jscomp.makeIterator(a.GetChildNodes());for(var d=c.next();!d.done;d=c.next()){d=d.value;var e=new THREE.Object3D;b.add(e);this.AddNode(d,e)}c=$jscomp.makeIterator(a.GetMeshIndices());for(d=c.next();!d.done;d=c.next())this.meshInstances.push({node:a,threeNode:b,meshIndex:d.value})};OV.ThreeNodeTree.prototype.GetMeshInstances=function(){return this.meshInstances};
OV.ConvertModelToThreeObject=function(a,b,c,d){function e(m,n,p,r,t,v){function u(x,C,y,z){if(null!==y&&y.IsValid()){var B=new THREE.TextureLoader;x.OnTextureNeeded();B.load(y.url,function(A){A.wrapS=THREE.RepeatWrapping;A.wrapT=THREE.RepeatWrapping;A.rotation=y.rotation;A.offset.x=y.offset.x;A.offset.y=y.offset.y;A.repeat.x=y.scale.x;A.repeat.y=y.scale.y;C.needsUpdate=!0;z(A);x.OnTextureLoaded()},null,function(A){x.OnTextureLoaded()})}}var q=n.GetMaterial(p);n={color:new THREE.Color(q.color.r/255,
q.color.g/255,q.color.b/255),opacity:q.opacity,transparent:q.transparent,alphaTest:q.alphaTest,side:THREE.DoubleSide};t.forceMediumpForMaterials&&(n.precision="mediump");var w=null;r===OV.MaterialType.Phong?(w=new THREE.MeshPhongMaterial(n),r=new THREE.Color(q.specular.r/255,q.specular.g/255,q.specular.b/255),OV.IsEqual(q.shininess,0)&&r.setRGB(0,0,0),w.specular=r,w.shininess=100*q.shininess,u(m,w,q.specularMap,function(x){w.specularMap=x})):r===OV.MaterialType.Physical&&(w=new THREE.MeshStandardMaterial(n),
w.metalness=q.metalness,w.roughness=q.roughness,u(m,w,q.metalnessMap,function(x){w.metalness=1;w.roughness=1;w.metalnessMap=x;w.roughnessMap=x}));r=new THREE.Color(q.emissive.r/255,q.emissive.g/255,q.emissive.b/255);w.emissive=r;u(m,w,q.diffuseMap,function(x){q.multiplyDiffuseMap||w.color.setRGB(1,1,1);w.map=x});u(m,w,q.bumpMap,function(x){w.bumpMap=x});u(m,w,q.normalMap,function(x){w.normalMap=x});u(m,w,q.emissiveMap,function(x){w.emissiveMap=x});q.isDefault&&(v.defaultMaterial=w);return w}function g(m,
n,p){var r=m.GetMesh(n.meshIndex),t=r.TriangleCount();if(0===t)return null;var v=[];for(m=0;m<t;m++)v.push(m);v.sort(function(I,H){I=r.GetTriangle(I);H=r.GetTriangle(H);return I.mat-H.mat});var u=new THREE.BufferGeometry,q=[];m=[];var w={},x=[],C=[],y=[],z=[];z.push({start:0,end:-1});for(var B=0<r.TextureUVCount(),A=0;A<v.length;A++){var E=r.GetTriangle(v[A]),F=r.GetVertex(E.v0),G=r.GetVertex(E.v1),D=r.GetVertex(E.v2);x.push(F.x,F.y,F.z,G.x,G.y,G.z,D.x,D.y,D.z);F=r.GetNormal(E.n0);G=r.GetNormal(E.n1);
D=r.GetNormal(E.n2);C.push(F.x,F.y,F.z,G.x,G.y,G.z,D.x,D.y,D.z);E.HasTextureUVs()?(F=r.GetTextureUV(E.u0),G=r.GetTextureUV(E.u1),D=r.GetTextureUV(E.u2),y.push(F.x,F.y,G.x,G.y,D.x,D.y)):B&&y.push(0,0,0,0,0,0);E=E.mat;F=w[E];void 0===F&&(F=q.length,w[E]=F,q.push(p[E]),m.push(E),0<A&&(z[z.length-1].end=A-1,z.push({start:z[z.length-1].end+1,end:-1})))}z[z.length-1].end=t-1;u.setAttribute("position",new THREE.Float32BufferAttribute(x,3));u.setAttribute("normal",new THREE.Float32BufferAttribute(C,3));0!==
y.length&&u.setAttribute("uv",new THREE.Float32BufferAttribute(y,2));for(p=0;p<z.length;p++)t=z[p],u.addGroup(3*t.start,3*(t.end-t.start+1),p);p=new THREE.Mesh(u,q);p.userData={originalMeshId:n,originalMaterials:m,threeMaterials:null};return p}d=new OV.ThreeConversionStateHandler(d);for(var f=OV.GetRepresentativeMaterialType(a),h=[],k=0;k<a.MaterialCount();k++){var l=e(d,a,k,f,b,c);h.push(l)}(function(m,n,p,r){var t=n.GetRootNode(),v=(new OV.ThreeNodeTree(t,m)).GetMeshInstances();OV.RunTasksBatch(v.length,
100,{runTask:function(u,q,w){for(;u<=q;u++){var x=v[u],C=x.threeNode,y=new OV.MeshInstanceId(x.node.GetId(),x.meshIndex);x=n;var z=p;0<x.GetMesh(y.meshIndex).TriangleCount()&&(x=g(x,y,z),C.add(x))}w()},onReady:function(){r.OnModelLoaded(m)}})})(new THREE.Object3D,a,h,d)};OV.ThreeModelLoader=function(){this.importer=new OV.Importer;this.inProgress=!1;this.defaultMaterial=null;this.hasHighpDriverIssue=OV.HasHighpDriverIssue()};OV.ThreeModelLoader.prototype.InProgress=function(){return this.inProgress};
OV.ThreeModelLoader.prototype.LoadModel=function(a,b,c,d){var e=this;this.inProgress||(this.inProgress=!0,d.onLoadStart(),this.importer.ImportFiles(a,b,c,{onFilesLoaded:function(){d.onImportStart()},onSelectMainFile:function(g,f){if(d.onSelectMainFile)d.onSelectMainFile(g,f);else f(0)},onImportSuccess:function(g){d.onVisualizationStart();var f=new OV.ModelToThreeConversionParams;f.forceMediumpForMaterials=e.hasHighpDriverIssue;var h=new OV.ModelToThreeConversionOutput;OV.ConvertModelToThreeObject(g.model,
f,h,{onTextureLoaded:function(){d.onTextureLoaded()},onModelLoaded:function(k){e.defaultMaterial=h.defaultMaterial;d.onModelFinished(g,k);e.inProgress=!1}})},onImportError:function(g){d.onLoadError(g);e.inProgress=!1}}))};OV.ThreeModelLoader.prototype.GetImporter=function(){return this.importer};OV.ThreeModelLoader.prototype.GetDefaultMaterial=function(){return this.defaultMaterial};
OV.ThreeModelLoader.prototype.ReplaceDefaultMaterialColor=function(a){null!==this.defaultMaterial&&(this.defaultMaterial.color=new THREE.Color(a.r/255,a.g/255,a.b/255))};OV.ParameterConverter={IntegerToString:function(a){return a.toString()},StringToInteger:function(a){return parseInt(a,10)},NumberToString:function(a){return a.toPrecision(5)},StringToNumber:function(a){return parseFloat(a)},ModelUrlsToString:function(a){return null===a?null:a.join(",")},StringToModelUrls:function(a){return null===a||0===a.length?null:a.split(",")},CameraToString:function(a){return null===a?null:[this.NumberToString(a.eye.x),this.NumberToString(a.eye.y),this.NumberToString(a.eye.z),
this.NumberToString(a.center.x),this.NumberToString(a.center.y),this.NumberToString(a.center.z),this.NumberToString(a.up.x),this.NumberToString(a.up.y),this.NumberToString(a.up.z)].join()},StringToCamera:function(a){if(null===a||0===a.length)return null;a=a.split(",");return 9!==a.length?null:new OV.Camera(new OV.Coord3D(this.StringToNumber(a[0]),this.StringToNumber(a[1]),this.StringToNumber(a[2])),new OV.Coord3D(this.StringToNumber(a[3]),this.StringToNumber(a[4]),this.StringToNumber(a[5])),new OV.Coord3D(this.StringToNumber(a[6]),
this.StringToNumber(a[7]),this.StringToNumber(a[8])))},ColorToString:function(a){return null===a?null:[this.IntegerToString(a.r),this.IntegerToString(a.g),this.IntegerToString(a.b)].join()},StringToColor:function(a){if(null===a||0===a.length)return null;a=a.split(",");return 3!==a.length?null:new OV.Color(this.StringToInteger(a[0]),this.StringToInteger(a[1]),this.StringToInteger(a[2]))}};OV.ParameterListBuilder=function(a){this.separator=a;this.paramList=""};
OV.ParameterListBuilder.prototype.AddModelUrls=function(a){this.AddUrlPart("model",OV.ParameterConverter.ModelUrlsToString(a));return this};OV.ParameterListBuilder.prototype.AddCamera=function(a){this.AddUrlPart("camera",OV.ParameterConverter.CameraToString(a));return this};OV.ParameterListBuilder.prototype.AddBackground=function(a){this.AddUrlPart("backgroundcolor",OV.ParameterConverter.ColorToString(a));return this};
OV.ParameterListBuilder.prototype.AddColor=function(a){this.AddUrlPart("defaultcolor",OV.ParameterConverter.ColorToString(a));return this};OV.ParameterListBuilder.prototype.AddUrlPart=function(a,b){null!==a&&null!==b&&(0<this.paramList.length&&(this.paramList+=this.separator),this.paramList+=a+"="+b)};OV.ParameterListBuilder.prototype.GetParameterList=function(){return this.paramList};OV.ParameterListParser=function(a,b){this.separator=b;this.paramList=a};
OV.ParameterListParser.prototype.GetModelUrls=function(){if(-1===this.paramList.indexOf("="))return this.paramList.split(",");var a=this.GetKeywordParams("model");return OV.ParameterConverter.StringToModelUrls(a)};OV.ParameterListParser.prototype.GetCamera=function(){var a=this.GetKeywordParams("camera");return OV.ParameterConverter.StringToCamera(a)};OV.ParameterListParser.prototype.GetBackgroundColor=function(){var a=this.GetKeywordParams("backgroundcolor");return OV.ParameterConverter.StringToColor(a)};
OV.ParameterListParser.prototype.GetDefaultColor=function(){var a=this.GetKeywordParams("defaultcolor");return OV.ParameterConverter.StringToColor(a)};OV.ParameterListParser.prototype.GetKeywordParams=function(a){if(null===this.paramList||0===this.paramList.length)return null;a+="=";for(var b=this.paramList.split(this.separator),c=0;c<b.length;c++){var d=b[c];if(d.startsWith(a))return d.substr(a.length)}return null};OV.CreateUrlBuilder=function(){return new OV.ParameterListBuilder("$")};
OV.CreateUrlParser=function(a){return new OV.ParameterListParser(a,"$")};OV.CreateModelUrlParameters=function(a){var b=OV.CreateUrlBuilder();b.AddModelUrls(a);return b.GetParameterList()};OV.GetIntegerFromStyle=function(a){return Math.round(parseFloat(a))};OV.GetDomElementExternalWidth=function(a){var b=OV.GetIntegerFromStyle(a.paddingLeft)+OV.GetIntegerFromStyle(a.paddingRight),c=OV.GetIntegerFromStyle(a.borderLeftWidth)+OV.GetIntegerFromStyle(a.borderRightWidth);a=OV.GetIntegerFromStyle(a.marginLeft)+OV.GetIntegerFromStyle(a.marginRight);return b+c+a};
OV.GetDomElementExternalHeight=function(a){var b=OV.GetIntegerFromStyle(a.paddingTop)+OV.GetIntegerFromStyle(a.paddingBottom),c=OV.GetIntegerFromStyle(a.borderTopWidth)+OV.GetIntegerFromStyle(a.borderBottomWidth);a=OV.GetIntegerFromStyle(a.marginTop)+OV.GetIntegerFromStyle(a.marginBottom);return b+c+a};OV.GetDomElementInnerDimensions=function(a,b,c){a=getComputedStyle(a);b-=OV.GetDomElementExternalWidth(a);c-=OV.GetDomElementExternalHeight(a);return{width:b,height:c}};
OV.CreateDomElement=function(a,b,c){a=document.createElement(a);b&&(a.className=b);c&&(a.innerHTML=c);return a};OV.AddDomElement=function(a,b,c,d){b=OV.CreateDomElement(b,c,d);a.appendChild(b);return b};OV.ClearDomElement=function(a){for(;a.firstChild;)a.removeChild(a.firstChild)};OV.InsertDomElementBefore=function(a,b){b.parentNode.insertBefore(a,b)};OV.InsertDomElementAfter=function(a,b){b.parentNode.insertBefore(a,b.nextSibling)};OV.ShowDomElement=function(a){a.style.display="block"};
OV.HideDomElement=function(a){a.style.display="none"};OV.IsDomElementVisible=function(a){return null!==a.offsetParent};OV.SetDomElementWidth=function(a,b){a.style.width=b.toString()+"px"};OV.SetDomElementHeight=function(a,b){a.style.height=b.toString()+"px"};OV.GetDomElementOuterWidth=function(a){var b=getComputedStyle(a);return a.offsetWidth+OV.GetIntegerFromStyle(b.marginLeft)+OV.GetIntegerFromStyle(b.marginRight)};
OV.GetDomElementOuterHeight=function(a){var b=getComputedStyle(a);return a.offsetHeight+OV.GetIntegerFromStyle(b.marginTop)+OV.GetIntegerFromStyle(b.marginBottom)};OV.SetDomElementOuterWidth=function(a,b){var c=getComputedStyle(a);OV.SetDomElementWidth(a,b-OV.GetDomElementExternalWidth(c))};OV.SetDomElementOuterHeight=function(a,b){var c=getComputedStyle(a);OV.SetDomElementHeight(a,b-OV.GetDomElementExternalHeight(c))};OV.CreateDiv=function(a,b){return OV.CreateDomElement("div",a,b)};
OV.AddDiv=function(a,b,c){return OV.AddDomElement(a,"div",b,c)};OV.GetClientCoordinates=function(a,b,c){a.getBoundingClientRect&&(a=a.getBoundingClientRect(),b-=a.left,c-=a.top);window.pageXOffset&&window.pageYOffset&&(b+=window.pageXOffset,c+=window.pageYOffset);return new OV.Coord2D(b,c)};OV.Camera=function(a,b,c){this.eye=a;this.center=b;this.up=c};OV.Camera.prototype.Clone=function(){return new OV.Camera(this.eye.Clone(),this.center.Clone(),this.up.Clone())};
OV.MouseInteraction=function(){this.prev=new OV.Coord2D(0,0);this.curr=new OV.Coord2D(0,0);this.diff=new OV.Coord2D(0,0);this.buttons=[]};OV.MouseInteraction.prototype.Down=function(a,b){this.buttons.push(b.which);this.curr=this.GetCurrent(a,b);this.prev=this.curr.Clone()};OV.MouseInteraction.prototype.Move=function(a,b){this.curr=this.GetCurrent(a,b);this.diff=OV.SubCoord2D(this.curr,this.prev);this.prev=this.curr.Clone()};
OV.MouseInteraction.prototype.Up=function(a,b){var c=this.buttons.indexOf(b.which);-1!==c&&this.buttons.splice(c,1);this.curr=this.GetCurrent(a,b)};OV.MouseInteraction.prototype.Leave=function(a,b){this.buttons=[];this.curr=this.GetCurrent(a,b)};OV.MouseInteraction.prototype.IsButtonDown=function(){return 0<this.buttons.length};OV.MouseInteraction.prototype.GetButton=function(){var a=this.buttons.length;return 0===a?0:this.buttons[a-1]};OV.MouseInteraction.prototype.GetMoveDiff=function(){return this.diff};
OV.MouseInteraction.prototype.GetCurrent=function(a,b){return OV.GetClientCoordinates(a,b.clientX,b.clientY)};OV.TouchInteraction=function(){this.prevPos=new OV.Coord2D(0,0);this.currPos=new OV.Coord2D(0,0);this.diffPos=new OV.Coord2D(0,0);this.fingers=this.diffDist=this.currDist=this.prevDist=0};
OV.TouchInteraction.prototype.Start=function(a,b){0!==b.touches.length&&(this.fingers=b.touches.length,this.currPos=this.GetCurrent(a,b),this.prevPos=this.currPos.Clone(),this.prevDist=this.currDist=this.GetTouchDistance(a,b))};
OV.TouchInteraction.prototype.Move=function(a,b){0!==b.touches.length&&(this.currPos=this.GetCurrent(a,b),this.diffPos=OV.SubCoord2D(this.currPos,this.prevPos),this.prevPos=this.currPos.Clone(),this.currDist=this.GetTouchDistance(a,b),this.diffDist=this.currDist-this.prevDist,this.prevDist=this.currDist)};OV.TouchInteraction.prototype.End=function(a,b){0!==b.touches.length&&(this.fingers=0,this.currPos=this.GetCurrent(a,b),this.currDist=this.GetTouchDistance(a,b))};
OV.TouchInteraction.prototype.IsFingerDown=function(){return 0!==this.fingers};OV.TouchInteraction.prototype.GetFingerCount=function(){return this.fingers};OV.TouchInteraction.prototype.GetMoveDiff=function(){return this.diffPos};OV.TouchInteraction.prototype.GetDistanceDiff=function(){return this.diffDist};OV.TouchInteraction.prototype.GetCurrent=function(a,b){var c=null;0!==b.touches.length&&(b=b.touches[0],c=OV.GetClientCoordinates(a,b.pageX,b.pageY));return c};
OV.TouchInteraction.prototype.GetTouchDistance=function(a,b){if(2!==b.touches.length)return 0;var c=b.touches[0];b=b.touches[1];return OV.CoordDistance2D(OV.GetClientCoordinates(a,c.pageX,c.pageY),OV.GetClientCoordinates(a,b.pageX,b.pageY))};OV.ClickDetector=function(){this.isClick=!1;this.button=0};OV.ClickDetector.prototype.Down=function(a){this.isClick=!0;this.button=a.which};OV.ClickDetector.prototype.Move=function(){this.isClick=!1};
OV.ClickDetector.prototype.Up=function(a){this.isClick&&a.which!==this.button&&(this.isClick=!1)};OV.ClickDetector.prototype.Leave=function(){this.isClick=!1;this.button=0};OV.ClickDetector.prototype.IsClick=function(){return this.isClick};OV.NavigationType={None:0,Orbit:1,Pan:2,Zoom:3};
OV.Navigation=function(a,b){this.canvas=a;this.camera=b;this.orbitCenter=this.camera.center.Clone();this.fixUpVector=!0;this.mouse=new OV.MouseInteraction;this.touch=new OV.TouchInteraction;this.clickDetector=new OV.ClickDetector;this.onContext=this.onClick=this.onUpdate=null;this.canvas.addEventListener&&(this.canvas.addEventListener("mousedown",this.OnMouseDown.bind(this)),this.canvas.addEventListener("wheel",this.OnMouseWheel.bind(this)),this.canvas.addEventListener("touchstart",this.OnTouchStart.bind(this)),
this.canvas.addEventListener("touchmove",this.OnTouchMove.bind(this)),this.canvas.addEventListener("touchend",this.OnTouchEnd.bind(this)),this.canvas.addEventListener("contextmenu",this.OnContextMenu.bind(this)));document.addEventListener&&(document.addEventListener("mousemove",this.OnMouseMove.bind(this)),document.addEventListener("mouseup",this.OnMouseUp.bind(this)),document.addEventListener("mouseleave",this.OnMouseLeave.bind(this)))};
OV.Navigation.prototype.SetUpdateHandler=function(a){this.onUpdate=a};OV.Navigation.prototype.SetClickHandler=function(a){this.onClick=a};OV.Navigation.prototype.SetContextMenuHandler=function(a){this.onContext=a};OV.Navigation.prototype.IsFixUpVector=function(){return this.fixUpVector};OV.Navigation.prototype.SetFixUpVector=function(a){this.fixUpVector=a};OV.Navigation.prototype.GetCamera=function(){return this.camera};OV.Navigation.prototype.SetCamera=function(a){this.camera=a};
OV.Navigation.prototype.MoveCamera=function(a,b){function c(f,h,k,l){f.camera.eye=h.eye[l];f.camera.center=h.center[l];f.camera.up=h.up[l];f.Update();l<k-1&&requestAnimationFrame(function(){c(f,h,k,l+1)})}var d=this;if(null!==a)if(0===b)this.SetCamera(a);else if(!(OV.CoordIsEqual3D(this.camera.eye,a.eye)&&OV.CoordIsEqual3D(this.camera.center,a.center)&&OV.CoordIsEqual3D(this.camera.up,a.up))){var e=OV.ParabolicTweenFunction,g={eye:OV.TweenCoord3D(this.camera.eye,a.eye,b,e),center:OV.TweenCoord3D(this.camera.center,
a.center,b,e),up:OV.TweenCoord3D(this.camera.up,a.up,b,e)};requestAnimationFrame(function(){c(d,g,b,0)});this.Update()}};OV.Navigation.prototype.FitToSphere=function(a,b,c){OV.IsZero(b)||(this.camera=this.GetFitToSphereCamera(a,b,c),this.orbitCenter=this.camera.center.Clone(),this.Update())};
OV.Navigation.prototype.GetFitToSphereCamera=function(a,b,c){if(OV.IsZero(b))return null;var d=this.camera.Clone(),e=OV.SubCoord3D(d.center,a);d.eye=OV.SubCoord3D(d.eye,e);d.center=a.Clone();a=OV.SubCoord3D(d.eye,d.center).Normalize();c/=2;this.canvas.width<this.canvas.height&&(c=c*this.canvas.width/this.canvas.height);b/=Math.sin(c*OV.DegRad);d.eye=d.center.Clone().Offset(a,b);this.orbitCenter=d.center.Clone();return d};
OV.Navigation.prototype.OnMouseDown=function(a){a.preventDefault();this.mouse.Down(this.canvas,a);this.clickDetector.Down(a)};
OV.Navigation.prototype.OnMouseMove=function(a){this.mouse.Move(this.canvas,a);this.clickDetector.Move();if(this.mouse.IsButtonDown()){var b=this.mouse.GetMoveDiff(),c=this.mouse.GetButton(),d=OV.NavigationType.None;if(1===c)d=a.ctrlKey?OV.NavigationType.Zoom:a.shiftKey?OV.NavigationType.Pan:OV.NavigationType.Orbit;else if(2===c||3===c)d=OV.NavigationType.Pan;d===OV.NavigationType.Orbit?this.Orbit(.5*b.x,.5*b.y):d===OV.NavigationType.Pan?(a=.001*OV.CoordDistance3D(this.camera.eye,this.camera.center),
this.Pan(b.x*a,b.y*a)):d===OV.NavigationType.Zoom&&this.Zoom(.005*-b.y);this.Update()}};OV.Navigation.prototype.OnMouseUp=function(a){this.mouse.Up(this.canvas,a);this.clickDetector.Up(a);this.clickDetector.IsClick()&&this.Click(a.which,a.clientX,a.clientY)};OV.Navigation.prototype.OnMouseLeave=function(a){this.mouse.Leave(this.canvas,a);this.clickDetector.Leave()};OV.Navigation.prototype.OnTouchStart=function(a){a.preventDefault();this.touch.Start(this.canvas,a)};
OV.Navigation.prototype.OnTouchMove=function(a){a.preventDefault();this.touch.Move(this.canvas,a);if(this.touch.IsFingerDown()){a=this.touch.GetMoveDiff();var b=this.touch.GetDistanceDiff(),c=this.touch.GetFingerCount();1===c?this.Orbit(.5*a.x,.5*a.y):2===c&&(this.Zoom(.005*b),b=.001*OV.CoordDistance3D(this.camera.eye,this.camera.center),this.Pan(a.x*b,a.y*b));this.Update()}};OV.Navigation.prototype.OnTouchEnd=function(a){a.preventDefault();this.touch.End(this.canvas,a)};
OV.Navigation.prototype.OnMouseWheel=function(a){a.preventDefault();var b=.1;0>-(a||window.event).deltaY/40&&(b*=-1);this.Zoom(b);this.Update()};OV.Navigation.prototype.OnContextMenu=function(a){a.preventDefault();this.clickDetector.Up(a);this.clickDetector.IsClick()&&this.Context(a.clientX,a.clientY)};
OV.Navigation.prototype.Orbit=function(a,b){a*=OV.DegRad;b*=OV.DegRad;var c=OV.SubCoord3D(this.camera.center,this.camera.eye).Normalize(),d=OV.CrossVector3D(c,this.camera.up).Normalize(),e=!OV.CoordIsEqual3D(this.orbitCenter,this.camera.center);this.fixUpVector?(c=OV.VectorAngle3D(c,this.camera.up)+b,OV.IsGreater(c,0)&&OV.IsLower(c,Math.PI)&&(this.camera.eye.Rotate(d,-b,this.orbitCenter),e&&this.camera.center.Rotate(d,-b,this.orbitCenter)),this.camera.eye.Rotate(this.camera.up,-a,this.orbitCenter),
e&&this.camera.center.Rotate(this.camera.up,-a,this.orbitCenter)):(c=OV.CrossVector3D(d,c).Normalize(),this.camera.eye.Rotate(d,-b,this.orbitCenter),this.camera.eye.Rotate(c,-a,this.orbitCenter),e&&(this.camera.center.Rotate(d,-b,this.orbitCenter),this.camera.center.Rotate(c,-a,this.orbitCenter)),this.camera.up=c)};
OV.Navigation.prototype.Pan=function(a,b){var c=OV.SubCoord3D(this.camera.center,this.camera.eye).Normalize(),d=OV.CrossVector3D(c,this.camera.up).Normalize();c=OV.CrossVector3D(d,c).Normalize();this.camera.eye.Offset(d,-a);this.camera.center.Offset(d,-a);this.camera.eye.Offset(c,b);this.camera.center.Offset(c,b)};OV.Navigation.prototype.Zoom=function(a){var b=OV.SubCoord3D(this.camera.center,this.camera.eye),c=b.Length();this.camera.eye.Offset(b,c*a)};OV.Navigation.prototype.Update=function(){if(this.onUpdate)this.onUpdate()};
OV.Navigation.prototype.Click=function(a,b,c){this.onClick&&(b=OV.GetClientCoordinates(this.canvas,b,c),this.onClick(a,b))};OV.Navigation.prototype.Context=function(a,b){if(this.onContext){var c={x:a,y:b};a=OV.GetClientCoordinates(this.canvas,a,b);this.onContext(c,a)}};OV.ShadingModelType={Phong:1,Physical:2};OV.GetDefaultCamera=function(a){return a===OV.Direction.X?new OV.Camera(new OV.Coord3D(2,-3,1.5),new OV.Coord3D(0,0,0),new OV.Coord3D(1,0,0)):a===OV.Direction.Y?new OV.Camera(new OV.Coord3D(-1.5,2,3),new OV.Coord3D(0,0,0),new OV.Coord3D(0,1,0)):a===OV.Direction.Z?new OV.Camera(new OV.Coord3D(-1.5,-3,2),new OV.Coord3D(0,0,0),new OV.Coord3D(0,0,1)):null};
OV.TraverseThreeObject=function(a,b){if(!b(a))return!1;a=$jscomp.makeIterator(a.children);for(var c=a.next();!c.done;c=a.next())if(!OV.TraverseThreeObject(c.value,b))return!1;return!0};OV.GetShadingTypeOfObject=function(a){var b=null;OV.TraverseThreeObject(a,function(c){if(c.isMesh)for(c=$jscomp.makeIterator(c.material).next();!c.done;)return c=c.value,"MeshPhongMaterial"===c.type?b=OV.ShadingModelType.Phong:"MeshStandardMaterial"===c.type&&(b=OV.ShadingModelType.Physical),!1;return!0});return b};
OV.UpVector=function(){this.direction=OV.Direction.Z;this.isFixed=!0;this.isFlipped=!1};
OV.UpVector.prototype.SetDirection=function(a,b){this.direction=a;this.isFlipped=!1;a=OV.GetDefaultCamera(this.direction);a=OV.SubCoord3D(a.eye,a.center);var c=OV.CoordDistance3D(b.center,b.eye);a=b.center.Clone().Offset(a,c);b=b.Clone();this.direction===OV.Direction.X&&(b.up=new OV.Coord3D(1,0,0),b.eye=a);this.direction===OV.Direction.Y?(b.up=new OV.Coord3D(0,1,0),b.eye=a):this.direction===OV.Direction.Z&&(b.up=new OV.Coord3D(0,0,1),b.eye=a);return b};
OV.UpVector.prototype.SetFixed=function(a,b){return(this.isFixed=a)?this.SetDirection(this.direction,b):null};OV.UpVector.prototype.Flip=function(a){this.isFlipped=!this.isFlipped;a=a.Clone();a.up.MultiplyScalar(-1);return a};OV.ViewerGeometry=function(a){this.scene=a;this.mainObject=null};OV.ViewerGeometry.prototype.SetMainObject=function(a){this.mainObject=a;this.scene.add(this.mainObject)};
OV.ViewerGeometry.prototype.ClearMainObject=function(){null!==this.mainObject&&(this.EnumerateMeshes(function(a){a.geometry.dispose()}),this.scene.remove(this.mainObject),this.mainObject=null)};OV.ViewerGeometry.prototype.EnumerateMeshes=function(a){null!==this.mainObject&&this.mainObject.traverse(function(b){b.isMesh&&a(b)})};
OV.ViewerGeometry.prototype.GetModelMeshUnderMouse=function(a,b,c,d){if(null===this.mainObject)return null;var e=new THREE.Raycaster,g=new THREE.Vector2;g.x=a.x/c*2-1;g.y=2*-(a.y/d)+1;e.setFromCamera(g,b);a=e.intersectObject(this.mainObject,!0);for(b=0;b<a.length;b++)if(c=a[b],"Mesh"===c.object.type&&c.object.visible)return c.object;return null};
OV.ViewerGeometry.prototype.GetModelIntersectionUnderMouse=function(a,b,c,d){var e=new THREE.Raycaster,g=new THREE.Vector2;g.x=a.x/c*2-1;g.y=2*-(a.y/d)+1;e.setFromCamera(g,b);a=e.intersectObjects(this.modelMeshes);for(b=0;b<a.length;b++)if(c=a[b],"Mesh"===c.object.type&&c.object.visible)return c;return null};OV.ViewerAxis=function(a){this.scene=a;this.mainObject=null};
OV.ViewerAxis.prototype.AddAxisLines=function(a,b){function c(m,n,p){m=[m,n];m=(new THREE.BufferGeometry).setFromPoints(m);return new THREE.Line(m,p)}this.RemoveAxisLines();this.mainObject=new THREE.Object3D;var d=new THREE.LineBasicMaterial({color:13421772}),e=new THREE.Vector3;a.getSize(e);var g=.5*e.y;e=new THREE.Vector2(a.min.z-g,a.min.x-g);g=new THREE.Vector2(a.max.z+g,a.max.x+g);e=new THREE.Vector2(Math.floor(e.x/b)*b,Math.floor(e.y/b)*b);g=new THREE.Vector2(Math.ceil(g.x/b)*b,Math.ceil(g.y/
b)*b);a=a.min.y;for(var f=Math.ceil((g.x-e.x)/b),h=Math.ceil((g.y-e.y)/b),k=0;k<f+1;k++){var l=e.x+k*b;this.mainObject.add(c(new THREE.Vector3(e.y,a,l),new THREE.Vector3(g.y,a,l),d))}for(f=0;f<h+1;f++)k=e.y+f*b,this.mainObject.add(c(new THREE.Vector3(k,a,e.x),new THREE.Vector3(k,a,g.x),d));this.scene.add(this.mainObject)};OV.ViewerAxis.prototype.RemoveAxisLines=function(){null!==this.mainObject&&(this.scene.remove(this.mainObject),this.mainObject=null)};
OV.ShadingModel=function(a){this.scene=a;this.type=OV.ShadingModelType.Phong;this.ambientLight=new THREE.AmbientLight(8947848);this.directionalLight=new THREE.DirectionalLight(8947848);this.environment=null;this.scene.add(this.ambientLight);this.scene.add(this.directionalLight)};
OV.ShadingModel.prototype.SetType=function(a){this.type=a;this.type===OV.ShadingModelType.Phong?(this.ambientLight.color.set(8947848),this.directionalLight.color.set(8947848),this.scene.environment=null):this.type===OV.ShadingModelType.Physical&&(this.ambientLight.color.set(0),this.directionalLight.color.set(5592405),this.scene.environment=this.environment)};OV.ShadingModel.prototype.SetEnvironment=function(a,b){this.environment=(new THREE.CubeTextureLoader).load(a,function(){b()})};
OV.ShadingModel.prototype.UpdateByCamera=function(a){a=OV.SubCoord3D(a.eye,a.center);this.directionalLight.position.set(a.x,a.y,a.z)};OV.ShadingModel.prototype.CreateHighlightMaterial=function(a){return this.type===OV.ShadingModelType.Phong?new THREE.MeshPhongMaterial({color:a,side:THREE.DoubleSide}):this.type===OV.ShadingModelType.Physical?new THREE.MeshStandardMaterial({color:a,side:THREE.DoubleSide}):null};
OV.Viewer=function(){this.upVector=this.navigation=this.shading=this.camera=this.axis=this.geometry=this.scene=this.renderer=this.canvas=null;this.settings={animationSteps:40}};
OV.Viewer.prototype.Init=function(a){this.canvas=a;this.canvas.id="viewer";this.renderer=new THREE.WebGLRenderer({canvas:this.canvas,antialias:!0});window.devicePixelRatio&&this.renderer.setPixelRatio(window.devicePixelRatio);this.renderer.setClearColor("#ffffff",1);this.renderer.setSize(this.canvas.width,this.canvas.height);this.scene=new THREE.Scene;this.geometry=new OV.ViewerGeometry(this.scene);this.axis=new OV.ViewerAxis(this.scene);this.InitCamera();this.InitShading();this.Render()};
OV.Viewer.prototype.SetClickHandler=function(a){this.navigation.SetClickHandler(a)};OV.Viewer.prototype.SetContextMenuHandler=function(a){this.navigation.SetContextMenuHandler(a)};OV.Viewer.prototype.SetBackgroundColor=function(a){a="#"+OV.ColorToHexString(a);this.renderer.setClearColor(a,1);this.Render()};OV.Viewer.prototype.SetEnvironmentMap=function(a){var b=this;this.shading.SetEnvironment(a,function(){b.Render()})};OV.Viewer.prototype.GetCamera=function(){return this.navigation.GetCamera()};
OV.Viewer.prototype.SetCamera=function(a){this.navigation.SetCamera(a);this.Render()};OV.Viewer.prototype.Resize=function(a,b){a=OV.GetDomElementInnerDimensions(this.canvas,a,b);this.ResizeRenderer(a.width,a.height)};OV.Viewer.prototype.ResizeRenderer=function(a,b){window.devicePixelRatio&&this.renderer.setPixelRatio(window.devicePixelRatio);this.camera.aspect=a/b;this.camera.updateProjectionMatrix();this.renderer.setSize(a,b);this.Render()};
OV.Viewer.prototype.FitSphereToWindow=function(a,b){if(null!==a){var c=new OV.Coord3D(a.center.x,a.center.y,a.center.z);a=a.radius;var d=this.camera.fov;b?(b=this.navigation.GetFitToSphereCamera(c,a,d),this.navigation.MoveCamera(b,this.settings.animationSteps)):this.navigation.FitToSphere(c,a,d)}};
OV.Viewer.prototype.AdjustClippingPlanesToSphere=function(a){null!==a&&(10>a.radius?(this.camera.near=.01,this.camera.far=100):100>a.radius?(this.camera.near=.1,this.camera.far=1E3):1E3>a.radius?(this.camera.near=10,this.camera.far=1E4):(this.camera.near=100,this.camera.far=1E6),this.camera.updateProjectionMatrix(),this.Render())};OV.Viewer.prototype.IsFixUpVector=function(){return this.navigation.IsFixUpVector()};
OV.Viewer.prototype.SetFixUpVector=function(a){var b=this.navigation.GetCamera();b=this.upVector.SetFixed(a,b);this.navigation.SetFixUpVector(a);null!==b&&this.navigation.MoveCamera(b,this.settings.animationSteps);this.Render()};OV.Viewer.prototype.SetUpVector=function(a,b){var c=this.navigation.GetCamera();a=this.upVector.SetDirection(a,c);this.navigation.MoveCamera(a,b?this.settings.animationSteps:0);this.Render()};
OV.Viewer.prototype.FlipUpVector=function(){var a=this.navigation.GetCamera();a=this.upVector.Flip(a);this.navigation.MoveCamera(a,0);this.Render()};OV.Viewer.prototype.Render=function(){var a=this.navigation.GetCamera();this.camera.position.set(a.eye.x,a.eye.y,a.eye.z);this.camera.up.set(a.up.x,a.up.y,a.up.z);this.camera.lookAt(new THREE.Vector3(a.center.x,a.center.y,a.center.z));this.shading.UpdateByCamera(a);this.renderer.render(this.scene,this.camera)};
OV.Viewer.prototype.SetMainObject=function(a){var b=OV.GetShadingTypeOfObject(a);this.geometry.SetMainObject(a);this.shading.SetType(b);this.Render()};OV.Viewer.prototype.Clear=function(){this.geometry.ClearMainObject();this.Render()};OV.Viewer.prototype.SetMeshesVisibility=function(a){this.geometry.EnumerateMeshes(function(b){var c=a(b.userData);b.visible!==c&&(b.visible=c)});this.Render()};
OV.Viewer.prototype.SetMeshesHighlight=function(a,b){var c=this.shading.CreateHighlightMaterial(a);this.geometry.EnumerateMeshes(function(d){if(b(d.userData)){if(null===d.userData.threeMaterials){for(var e=d.userData.threeMaterials=d.material,g=[],f=0;f<e.length;f++)g.push(c);d.material=g}}else null!==d.userData.threeMaterials&&(d.material=d.userData.threeMaterials,d.userData.threeMaterials=null)});this.Render()};
OV.Viewer.prototype.GetMeshUserDataUnderMouse=function(a){var b=this.canvas.width,c=this.canvas.height;window.devicePixelRatio&&(b/=window.devicePixelRatio,c/=window.devicePixelRatio);a=this.geometry.GetModelMeshUnderMouse(a,this.camera,b,c);return null===a?null:a.userData};OV.Viewer.prototype.GetBoundingBox=function(a){var b=!1,c=new THREE.Box3;this.geometry.EnumerateMeshes(function(d){a(d.userData)&&(c.union((new THREE.Box3).setFromObject(d)),b=!0)});return b?c:null};
OV.Viewer.prototype.GetBoundingSphere=function(a){a=this.GetBoundingBox(a);if(null===a)return null;var b=new THREE.Sphere;a.getBoundingSphere(b);return b};OV.Viewer.prototype.EnumerateMeshesUserData=function(a){this.geometry.EnumerateMeshes(function(b){a(b.userData)})};
OV.Viewer.prototype.InitCamera=function(){var a=this;this.camera=new THREE.PerspectiveCamera(45,this.canvas.width/this.canvas.height,.1,1E3);this.scene.add(this.camera);var b=this.renderer.domElement,c=OV.GetDefaultCamera(OV.Direction.Z);this.navigation=new OV.Navigation(b,c);this.navigation.SetUpdateHandler(function(){a.Render()});this.upVector=new OV.UpVector};OV.Viewer.prototype.InitShading=function(){this.shading=new OV.ShadingModel(this.scene)};
OV.Viewer.prototype.GetImageSize=function(){var a=new THREE.Vector2;this.renderer.getSize(a);return{width:parseInt(a.x,10),height:parseInt(a.y,10)}};OV.Viewer.prototype.GetImageAsDataUrl=function(a,b){var c=this.GetImageSize();window.devicePixelRatio&&(a/=window.devicePixelRatio,b/=window.devicePixelRatio);this.ResizeRenderer(a,b);this.Render();b=this.renderer.domElement.toDataURL();this.ResizeRenderer(c.width,c.height);return b};OV.Init3DViewerElement=function(a,b,c){c||(c={});var d=document.createElement("canvas");a.appendChild(d);var e=new OV.Viewer;e.Init(d);e.Resize(a.clientWidth,a.clientHeight);var g=new OV.ThreeModelLoader;if(null===b||0===b.length)return null;c.backgroundColor&&e.SetBackgroundColor(c.backgroundColor);c.environmentMap&&e.SetEnvironmentMap(c.environmentMap);var f=new OV.ImportSettings;c.defaultColor&&(f.defaultColor=c.defaultColor);var h=null;g.LoadModel(b,OV.FileSource.Url,f,{onLoadStart:function(){d.style.display=
"none";h=document.createElement("div");h.innerHTML="Loading model...";a.appendChild(h)},onImportStart:function(){h.innerHTML="Importing model..."},onVisualizationStart:function(){h.innerHTML="Visualizing model..."},onModelFinished:function(k,l){a.removeChild(h);d.style.display="inherit";e.SetMainObject(l);l=e.GetBoundingSphere(function(m){return!0});e.AdjustClippingPlanesToSphere(l);c.camera?e.SetCamera(c.camera):e.SetUpVector(k.upVector,!1);e.FitSphereToWindow(l,!1)},onTextureLoaded:function(){e.Render()},
onLoadError:function(k){var l="Unknown error";k.code===OV.ImportErrorCode.NoImportableFile?l="No importable file found":k.code===OV.ImportErrorCode.ImportFailed&&(l="Failed to import model.");null!==k.message&&(l+=" ("+k.message+")");h.innerHTML=l}});return{element:a,viewer:e}};
OV.Init3DViewerElements=function(a){var b=[];window.addEventListener("load",function(){for(var c=document.getElementsByClassName("online_3d_viewer"),d=0;d<c.length;d++){var e=c[d];var g=null,f=e.getAttribute("camera");f&&(g=OV.ParameterConverter.StringToCamera(f));f=null;var h=e.getAttribute("backgroundcolor");h&&(f=OV.ParameterConverter.StringToColor(h));h=null;var k=e.getAttribute("defaultcolor");k&&(h=OV.ParameterConverter.StringToColor(k));k=null;var l=e.getAttribute("environmentmap");l&&(l=l.split(","),
6===l.length&&(k=l));l=null;var m=e.getAttribute("model");m&&(l=OV.ParameterConverter.StringToModelUrls(m));e=OV.Init3DViewerElement(e,l,{camera:g,backgroundColor:f,defaultColor:h,environmentMap:k});b.push(e)}void 0!==a&&null!==a&&a(b)});window.addEventListener("resize",function(){for(var c=0;c<b.length;c++){var d=b[c];d.viewer.Resize(d.element.clientWidth,d.element.clientHeight)}})};
